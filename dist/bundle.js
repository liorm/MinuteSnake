var xe=Object.create;var z=Object.defineProperty;var _e=Object.getOwnPropertyDescriptor;var be=Object.getOwnPropertyNames;var ye=Object.getPrototypeOf,Ie=Object.prototype.hasOwnProperty;var we=(d,e,n)=>e in d?z(d,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):d[e]=n;var D=(d,e)=>()=>(e||d((e={exports:{}}).exports,e),e.exports);var ke=(d,e,n,a)=>{if(e&&typeof e=="object"||typeof e=="function")for(let l of be(e))!Ie.call(d,l)&&l!==n&&z(d,l,{get:()=>e[l],enumerable:!(a=_e(e,l))||a.enumerable});return d};var Se=(d,e,n)=>(n=d!=null?xe(ye(d)):{},ke(e||!d||!d.__esModule?z(n,"default",{value:d,enumerable:!0}):n,d));var f=(d,e,n)=>we(d,typeof e!="symbol"?e+"":e,n);var te=D((ee,U)=>{(function(d,e,n){function a(t){var r=this,o=s();r.next=function(){var i=2091639*r.s0+r.c*23283064365386963e-26;return r.s0=r.s1,r.s1=r.s2,r.s2=i-(r.c=i|0)},r.c=1,r.s0=o(" "),r.s1=o(" "),r.s2=o(" "),r.s0-=o(t),r.s0<0&&(r.s0+=1),r.s1-=o(t),r.s1<0&&(r.s1+=1),r.s2-=o(t),r.s2<0&&(r.s2+=1),o=null}function l(t,r){return r.c=t.c,r.s0=t.s0,r.s1=t.s1,r.s2=t.s2,r}function c(t,r){var o=new a(t),i=r&&r.state,u=o.next;return u.int32=function(){return o.next()*4294967296|0},u.double=function(){return u()+(u()*2097152|0)*11102230246251565e-32},u.quick=u,i&&(typeof i=="object"&&l(i,o),u.state=function(){return l(o,{})}),u}function s(){var t=4022871197,r=function(o){o=String(o);for(var i=0;i<o.length;i++){t+=o.charCodeAt(i);var u=.02519603282416938*t;t=u>>>0,u-=t,u*=t,t=u>>>0,u-=t,t+=u*4294967296}return(t>>>0)*23283064365386963e-26};return r}e&&e.exports?e.exports=c:n&&n.amd?n(function(){return c}):this.alea=c})(ee,typeof U=="object"&&U,typeof define=="function"&&define)});var ie=D((ne,$)=>{(function(d,e,n){function a(s){var t=this,r="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var i=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^i^i>>>8},s===(s|0)?t.x=s:r+=s;for(var o=0;o<r.length+64;o++)t.x^=r.charCodeAt(o)|0,t.next()}function l(s,t){return t.x=s.x,t.y=s.y,t.z=s.z,t.w=s.w,t}function c(s,t){var r=new a(s),o=t&&t.state,i=function(){return(r.next()>>>0)/4294967296};return i.double=function(){do var u=r.next()>>>11,h=(r.next()>>>0)/4294967296,p=(u+h)/(1<<21);while(p===0);return p},i.int32=r.next,i.quick=i,o&&(typeof o=="object"&&l(o,r),i.state=function(){return l(r,{})}),i}e&&e.exports?e.exports=c:n&&n.amd?n(function(){return c}):this.xor128=c})(ne,typeof $=="object"&&$,typeof define=="function"&&define)});var ae=D((re,K)=>{(function(d,e,n){function a(s){var t=this,r="";t.next=function(){var i=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^(i^i<<1))|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,s===(s|0)?t.x=s:r+=s;for(var o=0;o<r.length+64;o++)t.x^=r.charCodeAt(o)|0,o==r.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function l(s,t){return t.x=s.x,t.y=s.y,t.z=s.z,t.w=s.w,t.v=s.v,t.d=s.d,t}function c(s,t){var r=new a(s),o=t&&t.state,i=function(){return(r.next()>>>0)/4294967296};return i.double=function(){do var u=r.next()>>>11,h=(r.next()>>>0)/4294967296,p=(u+h)/(1<<21);while(p===0);return p},i.int32=r.next,i.quick=i,o&&(typeof o=="object"&&l(o,r),i.state=function(){return l(r,{})}),i}e&&e.exports?e.exports=c:n&&n.amd?n(function(){return c}):this.xorwow=c})(re,typeof K=="object"&&K,typeof define=="function"&&define)});var oe=D((se,Y)=>{(function(d,e,n){function a(s){var t=this;t.next=function(){var o=t.x,i=t.i,u,h,p;return u=o[i],u^=u>>>7,h=u^u<<24,u=o[i+1&7],h^=u^u>>>10,u=o[i+3&7],h^=u^u>>>3,u=o[i+4&7],h^=u^u<<7,u=o[i+7&7],u=u^u<<13,h^=u^u<<9,o[i]=h,t.i=i+1&7,h};function r(o,i){var u,h,p=[];if(i===(i|0))h=p[0]=i;else for(i=""+i,u=0;u<i.length;++u)p[u&7]=p[u&7]<<15^i.charCodeAt(u)+p[u+1&7]<<13;for(;p.length<8;)p.push(0);for(u=0;u<8&&p[u]===0;++u);for(u==8?h=p[7]=-1:h=p[u],o.x=p,o.i=0,u=256;u>0;--u)o.next()}r(t,s)}function l(s,t){return t.x=s.x.slice(),t.i=s.i,t}function c(s,t){s==null&&(s=+new Date);var r=new a(s),o=t&&t.state,i=function(){return(r.next()>>>0)/4294967296};return i.double=function(){do var u=r.next()>>>11,h=(r.next()>>>0)/4294967296,p=(u+h)/(1<<21);while(p===0);return p},i.int32=r.next,i.quick=i,o&&(o.x&&l(o,r),i.state=function(){return l(r,{})}),i}e&&e.exports?e.exports=c:n&&n.amd?n(function(){return c}):this.xorshift7=c})(se,typeof Y=="object"&&Y,typeof define=="function"&&define)});var le=D((ue,B)=>{(function(d,e,n){function a(s){var t=this;t.next=function(){var o=t.w,i=t.X,u=t.i,h,p;return t.w=o=o+1640531527|0,p=i[u+34&127],h=i[u=u+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,p=i[u]=p^h,t.i=u,p+(o^o>>>16)|0};function r(o,i){var u,h,p,y,E,S=[],P=128;for(i===(i|0)?(h=i,i=null):(i=i+"\0",h=0,P=Math.max(P,i.length)),p=0,y=-32;y<P;++y)i&&(h^=i.charCodeAt((y+32)%i.length)),y===0&&(E=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,y>=0&&(E=E+1640531527|0,u=S[y&127]^=h+E,p=u==0?p+1:0);for(p>=128&&(S[(i&&i.length||0)&127]=-1),p=127,y=4*128;y>0;--y)h=S[p+34&127],u=S[p=p+1&127],h^=h<<13,u^=u<<17,h^=h>>>15,u^=u>>>12,S[p]=h^u;o.w=E,o.X=S,o.i=p}r(t,s)}function l(s,t){return t.i=s.i,t.w=s.w,t.X=s.X.slice(),t}function c(s,t){s==null&&(s=+new Date);var r=new a(s),o=t&&t.state,i=function(){return(r.next()>>>0)/4294967296};return i.double=function(){do var u=r.next()>>>11,h=(r.next()>>>0)/4294967296,p=(u+h)/(1<<21);while(p===0);return p},i.int32=r.next,i.quick=i,o&&(o.X&&l(o,r),i.state=function(){return l(r,{})}),i}e&&e.exports?e.exports=c:n&&n.amd?n(function(){return c}):this.xor4096=c})(ue,typeof B=="object"&&B,typeof define=="function"&&define)});var he=D((ce,J)=>{(function(d,e,n){function a(s){var t=this,r="";t.next=function(){var i=t.b,u=t.c,h=t.d,p=t.a;return i=i<<25^i>>>7^u,u=u-h|0,h=h<<24^h>>>8^p,p=p-i|0,t.b=i=i<<20^i>>>12^u,t.c=u=u-h|0,t.d=h<<16^u>>>16^p,t.a=p-i|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,s===Math.floor(s)?(t.a=s/4294967296|0,t.b=s|0):r+=s;for(var o=0;o<r.length+20;o++)t.b^=r.charCodeAt(o)|0,t.next()}function l(s,t){return t.a=s.a,t.b=s.b,t.c=s.c,t.d=s.d,t}function c(s,t){var r=new a(s),o=t&&t.state,i=function(){return(r.next()>>>0)/4294967296};return i.double=function(){do var u=r.next()>>>11,h=(r.next()>>>0)/4294967296,p=(u+h)/(1<<21);while(p===0);return p},i.int32=r.next,i.quick=i,o&&(typeof o=="object"&&l(o,r),i.state=function(){return l(r,{})}),i}e&&e.exports?e.exports=c:n&&n.amd?n(function(){return c}):this.tychei=c})(ce,typeof J=="object"&&J,typeof define=="function"&&define)});var pe=D(()=>{});var fe=D((de,W)=>{(function(d,e,n){var a=256,l=6,c=52,s="random",t=n.pow(a,l),r=n.pow(2,c),o=r*2,i=a-1,u;function h(m,g,b){var _=[];g=g==!0?{entropy:!0}:g||{};var x=S(E(g.entropy?[m,V(e)]:m??P(),3),_),I=new p(_),k=function(){for(var w=I.g(l),G=t,T=0;w<r;)w=(w+T)*a,G*=a,T=I.g(1);for(;w>=o;)w/=2,G/=2,T>>>=1;return(w+T)/G};return k.int32=function(){return I.g(4)|0},k.quick=function(){return I.g(4)/4294967296},k.double=k,S(V(I.S),e),(g.pass||b||function(w,G,T,L){return L&&(L.S&&y(L,I),w.state=function(){return y(I,{})}),T?(n[s]=w,G):w})(k,x,"global"in g?g.global:this==n,g.state)}function p(m){var g,b=m.length,_=this,x=0,I=_.i=_.j=0,k=_.S=[];for(b||(m=[b++]);x<a;)k[x]=x++;for(x=0;x<a;x++)k[x]=k[I=i&I+m[x%b]+(g=k[x])],k[I]=g;(_.g=function(w){for(var G,T=0,L=_.i,R=_.j,H=_.S;w--;)G=H[L=i&L+1],T=T*a+H[i&(H[L]=H[R=i&R+G])+(H[R]=G)];return _.i=L,_.j=R,T})(a)}function y(m,g){return g.i=m.i,g.j=m.j,g.S=m.S.slice(),g}function E(m,g){var b=[],_=typeof m,x;if(g&&_=="object")for(x in m)try{b.push(E(m[x],g-1))}catch{}return b.length?b:_=="string"?m:m+"\0"}function S(m,g){for(var b=m+"",_,x=0;x<b.length;)g[i&x]=i&(_^=g[i&x]*19)+b.charCodeAt(x++);return V(g)}function P(){try{var m;return u&&(m=u.randomBytes)?m=m(a):(m=new Uint8Array(a),(d.crypto||d.msCrypto).getRandomValues(m)),V(m)}catch{var g=d.navigator,b=g&&g.plugins;return[+new Date,d,b,d.screen,V(e)]}}function V(m){return String.fromCharCode.apply(0,m)}if(S(n.random(),e),typeof W=="object"&&W.exports){W.exports=h;try{u=pe()}catch{}}else typeof define=="function"&&define.amd?define(function(){return h}):n["seed"+s]=h})(typeof self<"u"?self:de,[],Math)});var ge=D((Re,me)=>{var Te=te(),Ge=ie(),De=ae(),Ee=oe(),Le=le(),Ce=he(),C=fe();C.alea=Te;C.xor128=Ge;C.xorwow=De;C.xorshift7=Ee;C.xor4096=Le;C.tychei=Ce;me.exports=C});var v=class d{constructor(e,n){f(this,"x");f(this,"y");e instanceof d?(this.x=e.x,this.y=e.y):(this.x=e||0,this.y=n||0)}equals(e,n){return e==null?!1:e instanceof d?this.x===e.x&&this.y===e.y:this.x===e&&this.y===n}clone(){return new d(this)}add(e,n){return e instanceof d?new d(this.x+e.x,this.y+e.y):new d(this.x+e,this.y+(n||0))}sub(e,n){return e instanceof d?this.add(new d(-e.x,-e.y)):this.add(-e,-(n||0))}mul(e){return new d(this.x*e,this.y*e)}invert(){return this.mul(-1)}};var Q=Se(ge(),1);function ve(d){throw new Error("Unexpected object: "+d)}var O=class{constructor(e){this._stage=e;f(this,"_prng");f(this,"_state");f(this,"_pendingDuration",0);f(this,"_totalDuration",0);f(this,"onInputCallback");this._prng=(0,Q.default)(`${e.seed}\0`),this._state=this._createInitialState()}get options(){return this._stage}get state(){return this._state}get totalDuration(){return this._totalDuration}_createInitialState(){let e=[];for(let n=0;n<this._stage.xTiles;++n)e.push(new v(n,0),new v(n,this._stage.yTiles-1));for(let n=1;n<this._stage.yTiles-1;++n)e.push(new v(0,n),new v(this._stage.xTiles-1,n));return e=e.filter(n=>!this._stage.wallHoles.find(a=>a.equals(n))),e.push(...this._stage.blocks),{blocks:e,speed:12,applePos:null,snakes:this._stage.snakes.map(n=>({position:n.position,length:4,tiles:[],dir:n.direction,pendingDirs:[]})),gameOver:!1}}_resetState(){this._pendingDuration=0,this._totalDuration=0,this._prng=(0,Q.default)(`${this.options.seed}\0`),this._state=this._createInitialState()}_actionStep(){let e=this._state;if(e.gameOver)return!1;for(let n=0;n<e.snakes.length;n++){let a=e.snakes[n];a.pendingDirs.length>0&&(a.dir=a.pendingDirs[0],a.pendingDirs.splice(0,1));let l;switch(a.dir){case 1:l=new v(0,1);break;case-1:l=new v(0,-1);break;case-2:l=new v(-1,0);break;case 2:l=new v(1,0);break;default:return ve(a.dir)}let c=a.position.add(l);for(let s=0;s<e.snakes.length;s++)if(n!==s&&e.snakes[s].tiles.find(r=>r.equals(c)))return e.gameOver=!0,!1;if(e.blocks.find(s=>s.equals(c))||a.tiles.find(s=>s.equals(c)))return e.gameOver=!0,!1;for(c.x<0&&(c.x=this.options.xTiles-1),c.y<0&&(c.y=this.options.yTiles-1),c.x>this.options.xTiles-1&&(c.x=0),c.y>this.options.yTiles-1&&(c.y=0),a.position=c,a.tiles.push(c),a.position.equals(e.applePos)&&(e.applePos=null,a.length+=2);a.tiles.length>a.length;)a.tiles.splice(0,1);for(let s=0;s<e.snakes.length;s++)if(n!==s&&e.snakes[s].tiles.find(r=>r.equals(c)))return e.gameOver=!0,!1;a.position=c,a.tiles.push(c)}return e.applePos||this._actionNewApple(),!0}_actionNewApple(){let e;for(;e=new v(Math.floor(this._prng()*this.options.xTiles),Math.floor(this._prng()*this.options.yTiles)),!(!this._state.blocks.find(n=>n.equals(e))&&!this._state.snakes.find(n=>!!n.tiles.find(a=>a.equals(e)))););this._state.applePos=e}_actionNewDir(e,n){let a=this._state.snakes[e];if(a.pendingDirs.length>=2)return!1;let l=a.dir;return a.pendingDirs.length>0&&(l=a.pendingDirs[a.pendingDirs.length-1]),l===n||l+n===0?!1:(a.pendingDirs.push(n),!0)}_actionSpeedChange(e){let n=this._state.speed+e;return n=Math.max(1,Math.min(1e3,n)),this._state.speed=n,!0}input(e){let n=!1;switch(e.inputType){case"direction":n=this._actionNewDir(e.snakeIdx,e.dir);break;case"speed":n=this._actionSpeedChange(e.speedIncrement);break;default:ve(e)}this.onInputCallback&&n&&this.onInputCallback({eventTime:this._totalDuration,gameInput:e})}advanceTime(e){this._totalDuration+=e,this._pendingDuration+=e;let n=1e3/this._state.speed,a=Math.floor(this._pendingDuration/n);for(let l=0;l<a;++l)this._actionStep();this._pendingDuration-=a*n}};var M=class{constructor(e,n){this.snakeIdx=e;this.keyMap=n;f(this,"pendingInput",null)}handleKeyInput(e){let n;switch(e.key.toLowerCase()){case this.keyMap.down:n=-1;break;case this.keyMap.up:n=1;break;case this.keyMap.left:n=-2;break;case this.keyMap.right:n=2;break;default:return}this.pendingInput={inputType:"direction",dir:n,snakeIdx:this.snakeIdx}}onStateUpdate(e){let n=this.pendingInput;return this.pendingInput=null,n}},F=class{constructor(e,n=3){this.snakeIdx=e;this.safetyRadius=n}isNearOtherSnake(e,n,a){let l=n.snakes.filter((c,s)=>s!==this.snakeIdx);for(let c of l)for(let s of c.tiles){let t=Math.abs(e.x-s.x),r=Math.abs(e.y-s.y);if(t<=a&&r<=a)return!0}return!1}wouldCollideWithSelf(e,n){return n.snakes[this.snakeIdx].tiles.slice(1).some(c=>c.x===e.x&&c.y===e.y)}onStateUpdate(e){let n=e.snakes[this.snakeIdx],a=e.applePos;if(!a||e.gameOver)return null;let l=new Set;e.blocks.forEach(o=>l.add(`${o.x},${o.y}`)),e.snakes.forEach(o=>{o.tiles.forEach(i=>l.add(`${i.x},${i.y}`))});let c=a.x-n.position.x,s=a.y-n.position.y,t=[];Math.abs(c)>Math.abs(s)?(c>0?t.push(2):t.push(-2),s>0?t.push(1):t.push(-1)):(s>0?t.push(1):t.push(-1),c>0?t.push(2):t.push(-2));for(let o of t){let i=this.getNextPosition(n.position,o,e);if(!l.has(`${i.x},${i.y}`)&&!this.isNearOtherSnake(i,e,this.safetyRadius)&&!this.wouldCollideWithSelf(i,e))return{inputType:"direction",dir:o,snakeIdx:this.snakeIdx}}let r=[1,2,-1,-2];for(let o of r){let i=this.getNextPosition(n.position,o,e);if(!l.has(`${i.x},${i.y}`)&&!this.isNearOtherSnake(i,e,2)&&!this.wouldCollideWithSelf(i,e))return{inputType:"direction",dir:o,snakeIdx:this.snakeIdx}}return null}getNextPosition(e,n,a){let l=e.x,c=e.y;switch(n){case 1:c+=1;break;case-1:c-=1;break;case-2:l-=1;break;case 2:l+=1;break}return l<0&&(l=a.blocks.length-2),c<0&&(c=a.blocks.length-2),l>a.blocks.length-2&&(l=0),c>a.blocks.length-2&&(c=0),new v(l,c)}};var A=class{constructor(){f(this,"_paddingX",0);f(this,"_paddingY",0);f(this,"_tileWidth",0);f(this,"_tileHeight",0);f(this,"_boardHeight",0);f(this,"_boardWidth",0);f(this,"_canvasHeight",0);f(this,"_canvasWidth",0);f(this,"_gameOptions")}initRenderer(e){this._gameOptions=e}onCanvasSizeChanged(e,n){let a=Math.min(e/this._gameOptions.xTiles,n/this._gameOptions.yTiles);this._tileWidth=a,this._tileHeight=a,this._boardWidth=this._gameOptions.xTiles*this._tileWidth,this._boardHeight=this._gameOptions.yTiles*this._tileHeight,this._paddingX=(e-this._boardWidth)/2,this._paddingY=(n-this._boardHeight)/2,this._canvasWidth=e,this._canvasHeight=n}_drawTile(e,n,a){let{fillStyle:l,strokeStyle:c}=typeof a=="string"?{fillStyle:a,strokeStyle:a}:a;e.fillStyle=l,e.fillRect(this._paddingX+n.x*this._tileWidth,this._paddingY+this._boardHeight-n.y*this._tileHeight-this._tileHeight,this._tileWidth,this._tileHeight),c&&(e.strokeStyle=c,e.strokeRect(this._paddingX+n.x*this._tileWidth,this._paddingY+this._boardHeight-n.y*this._tileHeight-this._tileHeight,this._tileWidth,this._tileHeight))}render(e,n,a){e.fillStyle="green",e.fillRect(this._paddingX,this._paddingY,this._boardWidth,this._boardHeight),n.blocks.forEach(s=>{this._drawTile(e,s,"black")}),n.applePos&&this._drawTile(e,n.applePos,"red");let l=["#4040FF","#FF4040","#40FF40","#FFFF40","#FF40FF","#40FFFF"],c=l.map(s=>{let t=parseInt(s.slice(1),16),r=Math.max((t>>16)-40,0),o=Math.max((t>>8&255)-40,0),i=Math.max((t&255)-40,0);return`#${(r<<16|o<<8|i).toString(16).padStart(6,"0")}`});if(n.snakes.forEach((s,t)=>{let r=l[t%l.length],o=c[t%c.length];s.tiles.forEach(i=>{this._drawTile(e,i,r)}),this._drawTile(e,s.position,o)}),a&&(e.beginPath(),e.moveTo(10,10),e.lineTo(10,60),e.lineTo(60,35),e.closePath(),e.fillStyle="#50FF50",e.fill()),n.gameOver){let s=this._boardHeight/10;e.font=`Bold ${s}px Georgia`;let t="Game Over!",r=e.measureText(t),o=(this._canvasWidth-r.width)/2,i=(this._canvasHeight-s)/2;e.fillStyle="black",e.fillText(t,o,i),e.strokeStyle="white",e.strokeText(t,o,i)}}};var N=class{},j=class extends N{constructor(n,a){super();this._gameStage=n;this.savedInputs=a;f(this,"_gameLogic");f(this,"_inputIndex");this._gameLogic=new O(this._gameStage),this._inputIndex=0}get gameStage(){return this._gameStage}get isDone(){return this._inputIndex>=this.savedInputs.length}advanceTime(n){if(!(this._inputIndex>=this.savedInputs.length))for(;n>0;){let a=this._gameLogic.totalDuration+n,l=this.savedInputs[this._inputIndex];a>=l.eventTime&&(a=l.eventTime),this._gameLogic.advanceTime(a-this._gameLogic.totalDuration),this._gameLogic.totalDuration>=l.eventTime&&(this._gameLogic.input(l.gameInput),++this._inputIndex),n=a-this._gameLogic.totalDuration}}get state(){return this._gameLogic.state}performInput(n){}},q=class extends N{constructor(n,a){super();this._gameStage=n;f(this,"_gameLogic");f(this,"savedInputs");if(this.savedInputs=a||[],this._gameLogic=new O(this._gameStage),this.savedInputs.length>0)for(let l of this.savedInputs)this._gameLogic.advanceTime(l.eventTime-this._gameLogic.totalDuration),this._gameLogic.input(l.gameInput);this._gameLogic.onInputCallback=l=>this._onGameInput(l)}get gameStage(){return this._gameStage}advanceTime(n){this._gameLogic.advanceTime(n)}get isDone(){return!1}get state(){return this._gameLogic.state}_onGameInput(n){this.savedInputs.push(n)}performInput(n){this._gameLogic.input(n)}};var Pe=10,X=class{constructor(e,n,a){this.window=e;this.canvas=n;this.ctx=a;f(this,"_gameRenderer");f(this,"_handler");f(this,"_lastEngineTime");f(this,"_isPlaybackMode",!1);f(this,"_actors",[])}start(){this._gameRenderer=new A,this._restartLiveMode(),this._initListeners(),this._updateCanvasDimensions(),this._timeout()}_initListeners(){this.window.addEventListener("resize",()=>this._updateCanvasDimensions()),this.window.addEventListener("keydown",e=>this._onKeyDown(e))}_onKeyDown(e){if(!e.defaultPrevented){if(e.key.toLowerCase()==="p")this._isPlaybackMode?this._resumeLiveMode():this._enterPlaybackMode();else if(e.key.toLowerCase()==="n")this._restartLiveMode();else if(e.key==="+")this._performInput({inputType:"speed",speedIncrement:1});else if(e.key==="-")this._performInput({inputType:"speed",speedIncrement:-1});else for(let n of this._actors)n instanceof M&&n.handleKeyInput(e);e.preventDefault()}}_updateCanvasDimensions(){this.canvas.height=this.window.innerHeight,this.canvas.width=this.window.innerWidth,this._gameRenderer.onCanvasSizeChanged(this.canvas.width,this.canvas.height),this._draw()}_timeout(){this._update(),this._draw(),requestAnimationFrame(()=>this._timeout())}_update(){this._advanceTimeToNow();let e=!1,n=0;do{for(let a of this._actors){let l=a.onStateUpdate(this._handler.state);l&&(this._performInput(l),e=!0)}n++}while(e&&n<Pe)}_performInput(e){this._advanceTimeToNow(),this._handler.performInput(e)}_advanceTimeToNow(){let e=performance.now(),n=e-this._lastEngineTime;this._handler.advanceTime(n),this._lastEngineTime=e,this._isPlaybackMode&&this._handler.isDone&&this._resumeLiveMode()}_restartLiveMode(){let a={xTiles:60,yTiles:40,seed:Date.now(),wallHoles:[new v(0,20),new v(0,21),new v(59,20),new v(59,21)],blocks:[new v(30,20),new v(29,19),new v(30,19),new v(29,20)],snakes:[{position:new v(4,4),direction:2},{position:new v(56,36),direction:-2},{position:new v(50,30),direction:-2}]};this._isPlaybackMode=!1,this._handler=new q(a),this._lastEngineTime=performance.now(),this._gameRenderer.initRenderer(this._handler.gameStage)}_resumeLiveMode(){this._isPlaybackMode=!1,this._handler=new q(this._handler.gameStage,this._handler.savedInputs)}_enterPlaybackMode(){this._isPlaybackMode=!0,this._handler=new j(this._handler.gameStage,this._handler.savedInputs),this._lastEngineTime=performance.now()}_draw(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this._gameRenderer.render(this.ctx,this._handler.state,this._isPlaybackMode)}addActor(e){this._actors.push(e)}};var Z=class{constructor(){f(this,"gameEngine",null);window.addEventListener("DOMContentLoaded",()=>this.initialize())}initialize(){let e=document.querySelector("#canvas");if(!e){console.error("Canvas element not found");return}let n=e.getContext("2d");if(!n){console.error("Could not get 2D context");return}this.gameEngine=new X(window,e,n);let a=new M(0,{up:"arrowup",down:"arrowdown",left:"arrowleft",right:"arrowright"});this.gameEngine.addActor(a),this.gameEngine.addActor(new F(1)),this.gameEngine.addActor(new F(2)),this.gameEngine.start()}};new Z;
//# sourceMappingURL=bundle.js.map
