var xe=Object.create;var Y=Object.defineProperty;var Ie=Object.getOwnPropertyDescriptor;var be=Object.getOwnPropertyNames;var we=Object.getPrototypeOf,Se=Object.prototype.hasOwnProperty;var ke=(f,e,t)=>e in f?Y(f,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):f[e]=t;var M=(f,e)=>()=>(e||f((e={exports:{}}).exports,e),e.exports);var Te=(f,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let l of be(e))!Se.call(f,l)&&l!==t&&Y(f,l,{get:()=>e[l],enumerable:!(i=Ie(e,l))||i.enumerable});return f};var Ge=(f,e,t)=>(t=f!=null?xe(we(f)):{},Te(e||!f||!f.__esModule?Y(t,"default",{value:f,enumerable:!0}):t,f));var m=(f,e,t)=>ke(f,typeof e!="symbol"?e+"":e,t);var ne=M((te,U)=>{(function(f,e,t){function i(n){var o=this,c=a();o.next=function(){var r=2091639*o.s0+o.c*23283064365386963e-26;return o.s0=o.s1,o.s1=o.s2,o.s2=r-(o.c=r|0)},o.c=1,o.s0=c(" "),o.s1=c(" "),o.s2=c(" "),o.s0-=c(n),o.s0<0&&(o.s0+=1),o.s1-=c(n),o.s1<0&&(o.s1+=1),o.s2-=c(n),o.s2<0&&(o.s2+=1),c=null}function l(n,o){return o.c=n.c,o.s0=n.s0,o.s1=n.s1,o.s2=n.s2,o}function u(n,o){var c=new i(n),r=o&&o.state,s=c.next;return s.int32=function(){return c.next()*4294967296|0},s.double=function(){return s()+(s()*2097152|0)*11102230246251565e-32},s.quick=s,r&&(typeof r=="object"&&l(r,c),s.state=function(){return l(c,{})}),s}function a(){var n=4022871197,o=function(c){c=String(c);for(var r=0;r<c.length;r++){n+=c.charCodeAt(r);var s=.02519603282416938*n;n=s>>>0,s-=n,s*=n,n=s>>>0,s-=n,n+=s*4294967296}return(n>>>0)*23283064365386963e-26};return o}e&&e.exports?e.exports=u:t&&t.amd?t(function(){return u}):this.alea=u})(te,typeof U=="object"&&U,typeof define=="function"&&define)});var re=M((ie,$)=>{(function(f,e,t){function i(a){var n=this,o="";n.x=0,n.y=0,n.z=0,n.w=0,n.next=function(){var r=n.x^n.x<<11;return n.x=n.y,n.y=n.z,n.z=n.w,n.w^=n.w>>>19^r^r>>>8},a===(a|0)?n.x=a:o+=a;for(var c=0;c<o.length+64;c++)n.x^=o.charCodeAt(c)|0,n.next()}function l(a,n){return n.x=a.x,n.y=a.y,n.z=a.z,n.w=a.w,n}function u(a,n){var o=new i(a),c=n&&n.state,r=function(){return(o.next()>>>0)/4294967296};return r.double=function(){do var s=o.next()>>>11,h=(o.next()>>>0)/4294967296,p=(s+h)/(1<<21);while(p===0);return p},r.int32=o.next,r.quick=r,c&&(typeof c=="object"&&l(c,o),r.state=function(){return l(o,{})}),r}e&&e.exports?e.exports=u:t&&t.amd?t(function(){return u}):this.xor128=u})(ie,typeof $=="object"&&$,typeof define=="function"&&define)});var se=M((ae,K)=>{(function(f,e,t){function i(a){var n=this,o="";n.next=function(){var r=n.x^n.x>>>2;return n.x=n.y,n.y=n.z,n.z=n.w,n.w=n.v,(n.d=n.d+362437|0)+(n.v=n.v^n.v<<4^(r^r<<1))|0},n.x=0,n.y=0,n.z=0,n.w=0,n.v=0,a===(a|0)?n.x=a:o+=a;for(var c=0;c<o.length+64;c++)n.x^=o.charCodeAt(c)|0,c==o.length&&(n.d=n.x<<10^n.x>>>4),n.next()}function l(a,n){return n.x=a.x,n.y=a.y,n.z=a.z,n.w=a.w,n.v=a.v,n.d=a.d,n}function u(a,n){var o=new i(a),c=n&&n.state,r=function(){return(o.next()>>>0)/4294967296};return r.double=function(){do var s=o.next()>>>11,h=(o.next()>>>0)/4294967296,p=(s+h)/(1<<21);while(p===0);return p},r.int32=o.next,r.quick=r,c&&(typeof c=="object"&&l(c,o),r.state=function(){return l(o,{})}),r}e&&e.exports?e.exports=u:t&&t.amd?t(function(){return u}):this.xorwow=u})(ae,typeof K=="object"&&K,typeof define=="function"&&define)});var le=M((oe,B)=>{(function(f,e,t){function i(a){var n=this;n.next=function(){var c=n.x,r=n.i,s,h,p;return s=c[r],s^=s>>>7,h=s^s<<24,s=c[r+1&7],h^=s^s>>>10,s=c[r+3&7],h^=s^s>>>3,s=c[r+4&7],h^=s^s<<7,s=c[r+7&7],s=s^s<<13,h^=s^s<<9,c[r]=h,n.i=r+1&7,h};function o(c,r){var s,h,p=[];if(r===(r|0))h=p[0]=r;else for(r=""+r,s=0;s<r.length;++s)p[s&7]=p[s&7]<<15^r.charCodeAt(s)+p[s+1&7]<<13;for(;p.length<8;)p.push(0);for(s=0;s<8&&p[s]===0;++s);for(s==8?h=p[7]=-1:h=p[s],c.x=p,c.i=0,s=256;s>0;--s)c.next()}o(n,a)}function l(a,n){return n.x=a.x.slice(),n.i=a.i,n}function u(a,n){a==null&&(a=+new Date);var o=new i(a),c=n&&n.state,r=function(){return(o.next()>>>0)/4294967296};return r.double=function(){do var s=o.next()>>>11,h=(o.next()>>>0)/4294967296,p=(s+h)/(1<<21);while(p===0);return p},r.int32=o.next,r.quick=r,c&&(c.x&&l(c,o),r.state=function(){return l(o,{})}),r}e&&e.exports?e.exports=u:t&&t.amd?t(function(){return u}):this.xorshift7=u})(oe,typeof B=="object"&&B,typeof define=="function"&&define)});var ue=M((ce,J)=>{(function(f,e,t){function i(a){var n=this;n.next=function(){var c=n.w,r=n.X,s=n.i,h,p;return n.w=c=c+1640531527|0,p=r[s+34&127],h=r[s=s+1&127],p^=p<<13,h^=h<<17,p^=p>>>15,h^=h>>>12,p=r[s]=p^h,n.i=s,p+(c^c>>>16)|0};function o(c,r){var s,h,p,v,w,I=[],C=128;for(r===(r|0)?(h=r,r=null):(r=r+"\0",h=0,C=Math.max(C,r.length)),p=0,v=-32;v<C;++v)r&&(h^=r.charCodeAt((v+32)%r.length)),v===0&&(w=h),h^=h<<10,h^=h>>>15,h^=h<<4,h^=h>>>13,v>=0&&(w=w+1640531527|0,s=I[v&127]^=h+w,p=s==0?p+1:0);for(p>=128&&(I[(r&&r.length||0)&127]=-1),p=127,v=4*128;v>0;--v)h=I[p+34&127],s=I[p=p+1&127],h^=h<<13,s^=s<<17,h^=h>>>15,s^=s>>>12,I[p]=h^s;c.w=w,c.X=I,c.i=p}o(n,a)}function l(a,n){return n.i=a.i,n.w=a.w,n.X=a.X.slice(),n}function u(a,n){a==null&&(a=+new Date);var o=new i(a),c=n&&n.state,r=function(){return(o.next()>>>0)/4294967296};return r.double=function(){do var s=o.next()>>>11,h=(o.next()>>>0)/4294967296,p=(s+h)/(1<<21);while(p===0);return p},r.int32=o.next,r.quick=r,c&&(c.X&&l(c,o),r.state=function(){return l(o,{})}),r}e&&e.exports?e.exports=u:t&&t.amd?t(function(){return u}):this.xor4096=u})(ce,typeof J=="object"&&J,typeof define=="function"&&define)});var pe=M((he,Q)=>{(function(f,e,t){function i(a){var n=this,o="";n.next=function(){var r=n.b,s=n.c,h=n.d,p=n.a;return r=r<<25^r>>>7^s,s=s-h|0,h=h<<24^h>>>8^p,p=p-r|0,n.b=r=r<<20^r>>>12^s,n.c=s=s-h|0,n.d=h<<16^s>>>16^p,n.a=p-r|0},n.a=0,n.b=0,n.c=-1640531527,n.d=1367130551,a===Math.floor(a)?(n.a=a/4294967296|0,n.b=a|0):o+=a;for(var c=0;c<o.length+20;c++)n.b^=o.charCodeAt(c)|0,n.next()}function l(a,n){return n.a=a.a,n.b=a.b,n.c=a.c,n.d=a.d,n}function u(a,n){var o=new i(a),c=n&&n.state,r=function(){return(o.next()>>>0)/4294967296};return r.double=function(){do var s=o.next()>>>11,h=(o.next()>>>0)/4294967296,p=(s+h)/(1<<21);while(p===0);return p},r.int32=o.next,r.quick=r,c&&(typeof c=="object"&&l(c,o),r.state=function(){return l(o,{})}),r}e&&e.exports?e.exports=u:t&&t.amd?t(function(){return u}):this.tychei=u})(he,typeof Q=="object"&&Q,typeof define=="function"&&define)});var fe=M(()=>{});var de=M((me,N)=>{(function(f,e,t){var i=256,l=6,u=52,a="random",n=t.pow(i,l),o=t.pow(2,u),c=o*2,r=i-1,s;function h(d,_,b){var x=[];_=_==!0?{entropy:!0}:_||{};var y=I(w(_.entropy?[d,E(e)]:d??C(),3),x),S=new p(x),T=function(){for(var k=S.g(l),P=n,G=0;k<o;)k=(k+G)*i,P*=i,G=S.g(1);for(;k>=c;)k/=2,P/=2,G>>>=1;return(k+G)/P};return T.int32=function(){return S.g(4)|0},T.quick=function(){return S.g(4)/4294967296},T.double=T,I(E(S.S),e),(_.pass||b||function(k,P,G,A){return A&&(A.S&&v(A,S),k.state=function(){return v(S,{})}),G?(t[a]=k,P):k})(T,y,"global"in _?_.global:this==t,_.state)}function p(d){var _,b=d.length,x=this,y=0,S=x.i=x.j=0,T=x.S=[];for(b||(d=[b++]);y<i;)T[y]=y++;for(y=0;y<i;y++)T[y]=T[S=r&S+d[y%b]+(_=T[y])],T[S]=_;(x.g=function(k){for(var P,G=0,A=x.i,V=x.j,W=x.S;k--;)P=W[A=r&A+1],G=G*i+W[r&(W[A]=W[V=r&V+P])+(W[V]=P)];return x.i=A,x.j=V,G})(i)}function v(d,_){return _.i=d.i,_.j=d.j,_.S=d.S.slice(),_}function w(d,_){var b=[],x=typeof d,y;if(_&&x=="object")for(y in d)try{b.push(w(d[y],_-1))}catch{}return b.length?b:x=="string"?d:d+"\0"}function I(d,_){for(var b=d+"",x,y=0;y<b.length;)_[r&y]=r&(x^=_[r&y]*19)+b.charCodeAt(y++);return E(_)}function C(){try{var d;return s&&(d=s.randomBytes)?d=d(i):(d=new Uint8Array(i),(f.crypto||f.msCrypto).getRandomValues(d)),E(d)}catch{var _=f.navigator,b=_&&_.plugins;return[+new Date,f,b,f.screen,E(e)]}}function E(d){return String.fromCharCode.apply(0,d)}if(I(t.random(),e),typeof N=="object"&&N.exports){N.exports=h;try{s=fe()}catch{}}else typeof define=="function"&&define.amd?define(function(){return h}):t["seed"+a]=h})(typeof self<"u"?self:me,[],Math)});var _e=M((Ne,ge)=>{var Ce=ne(),Pe=re(),Me=se(),Ee=le(),Ae=ue(),Le=pe(),L=de();L.alea=Ce;L.xor128=Pe;L.xorwow=Me;L.xorshift7=Ee;L.xor4096=Ae;L.tychei=Le;ge.exports=L});var g=class f{constructor(e,t){m(this,"x");m(this,"y");e instanceof f?(this.x=e.x,this.y=e.y):(this.x=e||0,this.y=t||0)}equals(e,t){return e==null?!1:e instanceof f?this.x===e.x&&this.y===e.y:this.x===e&&this.y===t}clone(){return new f(this)}add(e,t){return e instanceof f?new f(this.x+e.x,this.y+e.y):new f(this.x+e,this.y+(t||0))}sub(e,t){return e instanceof f?this.add(new f(-e.x,-e.y)):this.add(-e,-(t||0))}mul(e){return new f(this.x*e,this.y*e)}invert(){return this.mul(-1)}};var Z=Ge(_e(),1);function ve(f){throw new Error("Unexpected object: "+f)}var R=class{constructor(e){this._stage=e;m(this,"_prng");m(this,"_state");m(this,"_pendingDuration",0);m(this,"_totalDuration",0);m(this,"onInputCallback");this._prng=(0,Z.default)(`${e.seed}\0`),this._state=this._createInitialState()}get options(){return this._stage}get state(){return this._state}get totalDuration(){return this._totalDuration}_createInitialState(){let e=[];for(let t=0;t<this._stage.xTiles;++t)e.push(new g(t,0),new g(t,this._stage.yTiles-1));for(let t=1;t<this._stage.yTiles-1;++t)e.push(new g(0,t),new g(this._stage.xTiles-1,t));return e=e.filter(t=>!this._stage.wallHoles.find(i=>i.equals(t))),e.push(...this._stage.blocks),{blocks:e,speed:12,applePos:null,snakes:this._stage.snakes.map(t=>({position:t.position,length:4,tiles:[],dir:t.direction,pendingDirs:[]})),gameOver:!1}}_resetState(){this._pendingDuration=0,this._totalDuration=0,this._prng=(0,Z.default)(`${this.options.seed}\0`),this._state=this._createInitialState()}_actionStep(){let e=this._state;if(e.gameOver)return!1;for(let t=0;t<e.snakes.length;t++){let i=e.snakes[t];i.pendingDirs.length>0&&(i.dir=i.pendingDirs[0],i.pendingDirs.splice(0,1));let l;switch(i.dir){case 1:l=new g(0,1);break;case-1:l=new g(0,-1);break;case-2:l=new g(-1,0);break;case 2:l=new g(1,0);break;default:return ve(i.dir)}let u=i.position.add(l);for(let a=0;a<e.snakes.length;a++)if(t!==a&&e.snakes[a].tiles.find(o=>o.equals(u)))return e.gameOver=!0,!1;if(e.blocks.find(a=>a.equals(u))||i.tiles.find(a=>a.equals(u)))return e.gameOver=!0,!1;for(u.x<0&&(u.x=this.options.xTiles-1),u.y<0&&(u.y=this.options.yTiles-1),u.x>this.options.xTiles-1&&(u.x=0),u.y>this.options.yTiles-1&&(u.y=0),i.position=u,i.tiles.push(u),i.position.equals(e.applePos)&&(e.applePos=null,i.length+=2);i.tiles.length>i.length;)i.tiles.splice(0,1);for(let a=0;a<e.snakes.length;a++)if(t!==a&&e.snakes[a].tiles.find(o=>o.equals(u)))return e.gameOver=!0,!1;i.position=u,i.tiles.push(u)}return e.applePos||this._actionNewApple(),!0}_actionNewApple(){let e;for(;e=new g(Math.floor(this._prng()*this.options.xTiles),Math.floor(this._prng()*this.options.yTiles)),!(!this._state.blocks.find(t=>t.equals(e))&&!this._state.snakes.find(t=>!!t.tiles.find(i=>i.equals(e)))););this._state.applePos=e}_actionNewDir(e,t){let i=this._state.snakes[e];if(i.pendingDirs.length>=2)return!1;let l=i.dir;return i.pendingDirs.length>0&&(l=i.pendingDirs[i.pendingDirs.length-1]),l===t||l+t===0?!1:(i.pendingDirs.push(t),!0)}_actionSpeedChange(e){let t=this._state.speed+e;return t=Math.max(1,Math.min(1e3,t)),this._state.speed=t,!0}input(e){let t=!1;switch(e.inputType){case"direction":t=this._actionNewDir(e.snakeIdx,e.dir);break;case"speed":t=this._actionSpeedChange(e.speedIncrement);break;default:ve(e)}this.onInputCallback&&t&&this.onInputCallback({eventTime:this._totalDuration,gameInput:e})}advanceTime(e){this._totalDuration+=e,this._pendingDuration+=e;let t=1e3/this._state.speed,i=Math.floor(this._pendingDuration/t);for(let l=0;l<i;++l)this._actionStep();this._pendingDuration-=i*t}};var D=class{constructor(e,t){this.snakeIdx=e;this.keyMap=t;m(this,"pendingInput",null)}handleKeyInput(e){let t;switch(e.key.toLowerCase()){case this.keyMap.down:t=-1;break;case this.keyMap.up:t=1;break;case this.keyMap.left:t=-2;break;case this.keyMap.right:t=2;break;default:return}this.pendingInput={inputType:"direction",dir:t,snakeIdx:this.snakeIdx}}onStateUpdate(e){let t=this.pendingInput;return this.pendingInput=null,t}};var O=class{constructor(e,t=3){this.snakeIdx=e;this.safetyRadius=t}isNearOtherSnake(e,t,i){let l=t.snakes.filter((u,a)=>a!==this.snakeIdx);for(let u of l)for(let a of u.tiles){let n=Math.abs(e.x-a.x),o=Math.abs(e.y-a.y);if(n<=i&&o<=i)return!0}return!1}wouldCollideWithSelf(e,t){return t.snakes[this.snakeIdx].tiles.slice(1).some(u=>u.x===e.x&&u.y===e.y)}isTooCloseToWalls(e,t,i){let l=t.blocks.length-1;return e.x<i||e.y<i||e.x>l-i-1||e.y>l-i-1}isAppleNearWalls(e,t,i){let l=t.blocks.length-1;return e.x<i||e.y<i||e.x>l-i-1||e.y>l-i-1}onStateUpdate(e){let t=e.snakes[this.snakeIdx],i=e.applePos;if(!i||e.gameOver)return null;let l=new Set;e.blocks.forEach(r=>l.add(`${r.x},${r.y}`)),e.snakes.forEach(r=>{r.tiles.forEach(s=>l.add(`${s.x},${s.y}`))});let u=i.x-t.position.x,a=i.y-t.position.y,n=[];Math.abs(u)>Math.abs(a)?(u>0?n.push(2):n.push(-2),a>0?n.push(1):n.push(-1)):(a>0?n.push(1):n.push(-1),u>0?n.push(2):n.push(-2));let o=this.isAppleNearWalls(i,e,2);for(let r of n){let s=this.getNextPosition(t.position,r,e);if(!l.has(`${s.x},${s.y}`)&&!this.isNearOtherSnake(s,e,this.safetyRadius)&&(o||!this.isTooCloseToWalls(s,e,2))&&!this.wouldCollideWithSelf(s,e))return{inputType:"direction",dir:r,snakeIdx:this.snakeIdx}}let c=[1,2,-1,-2];for(let r of c){let s=this.getNextPosition(t.position,r,e);if(!l.has(`${s.x},${s.y}`)&&!this.isNearOtherSnake(s,e,2)&&(o||!this.isTooCloseToWalls(s,e,2))&&!this.wouldCollideWithSelf(s,e))return{inputType:"direction",dir:r,snakeIdx:this.snakeIdx}}return null}getNextPosition(e,t,i){let l=e.x,u=e.y;switch(t){case 1:u+=1;break;case-1:u-=1;break;case-2:l-=1;break;case 2:l+=1;break}return l<0&&(l=i.blocks.length-2),u<0&&(u=i.blocks.length-2),l>i.blocks.length-2&&(l=0),u>i.blocks.length-2&&(u=0),new g(l,u)}};var F=class{constructor(){m(this,"_paddingX",0);m(this,"_paddingY",0);m(this,"_tileWidth",0);m(this,"_tileHeight",0);m(this,"_boardHeight",0);m(this,"_boardWidth",0);m(this,"_canvasHeight",0);m(this,"_canvasWidth",0);m(this,"_gameOptions")}initRenderer(e){this._gameOptions=e}onCanvasSizeChanged(e,t){let i=Math.min(e/this._gameOptions.xTiles,t/this._gameOptions.yTiles);this._tileWidth=i,this._tileHeight=i,this._boardWidth=this._gameOptions.xTiles*this._tileWidth,this._boardHeight=this._gameOptions.yTiles*this._tileHeight,this._paddingX=(e-this._boardWidth)/2,this._paddingY=(t-this._boardHeight)/2,this._canvasWidth=e,this._canvasHeight=t}_drawTile(e,t,i){let{fillStyle:l,strokeStyle:u}=typeof i=="string"?{fillStyle:i,strokeStyle:i}:i;e.fillStyle=l,e.fillRect(this._paddingX+t.x*this._tileWidth,this._paddingY+this._boardHeight-t.y*this._tileHeight-this._tileHeight,this._tileWidth,this._tileHeight),u&&(e.strokeStyle=u,e.strokeRect(this._paddingX+t.x*this._tileWidth,this._paddingY+this._boardHeight-t.y*this._tileHeight-this._tileHeight,this._tileWidth,this._tileHeight))}render(e,t,i){e.fillStyle="green",e.fillRect(this._paddingX,this._paddingY,this._boardWidth,this._boardHeight),t.blocks.forEach(a=>{this._drawTile(e,a,"black")}),t.applePos&&this._drawTile(e,t.applePos,"red");let l=["#4040FF","#FF4040","#40FF40","#FFFF40","#FF40FF","#40FFFF"],u=l.map(a=>{let n=parseInt(a.slice(1),16),o=Math.max((n>>16)-40,0),c=Math.max((n>>8&255)-40,0),r=Math.max((n&255)-40,0);return`#${(o<<16|c<<8|r).toString(16).padStart(6,"0")}`});if(t.snakes.forEach((a,n)=>{let o=l[n%l.length],c=u[n%u.length];a.tiles.forEach(r=>{this._drawTile(e,r,o)}),this._drawTile(e,a.position,c)}),i&&(e.beginPath(),e.moveTo(10,10),e.lineTo(10,60),e.lineTo(60,35),e.closePath(),e.fillStyle="#50FF50",e.fill()),t.gameOver){let a=this._boardHeight/10;e.font=`Bold ${a}px Georgia`;let n="Game Over!",o=e.measureText(n),c=(this._canvasWidth-o.width)/2,r=this._canvasHeight/2+a/4;e.fillStyle="black",e.fillText(n,c,r),e.strokeStyle="white",e.strokeText(n,c,r)}}};var q=class{constructor(){m(this,"_canvasWidth",0);m(this,"_canvasHeight",0);m(this,"_playerConfig",{humanPlayers:1,aiPlayers:2});m(this,"_selectedMenuItem",0)}onCanvasSizeChanged(e,t){this._canvasWidth=e,this._canvasHeight=t}handleKeyInput(e,t){switch(e.key.toLowerCase()){case"arrowup":this._selectedMenuItem=Math.max(0,this._selectedMenuItem-1);break;case"arrowdown":this._selectedMenuItem=Math.min(2,this._selectedMenuItem+1);break;case"arrowleft":this._adjustPlayerCount(-1);break;case"arrowright":this._adjustPlayerCount(1);break;case"enter":this._selectedMenuItem===2&&this._startGame(t);break}}handleClickInput(e,t){this._selectedMenuItem===2&&this._startGame(t)}_adjustPlayerCount(e){this._selectedMenuItem===0?this._playerConfig.humanPlayers=Math.max(0,Math.min(2,this._playerConfig.humanPlayers+e)):this._selectedMenuItem===1&&(this._playerConfig.aiPlayers=Math.max(0,Math.min(6,this._playerConfig.aiPlayers+e)))}_startGame(e){this._playerConfig.humanPlayers+this._playerConfig.aiPlayers!==0&&e.onStartGame(this._playerConfig)}render(e){let t=this._canvasWidth||e.canvas.width,i=this._canvasHeight||e.canvas.height;e.fillStyle="#2c3e50",e.fillRect(0,0,t,i);let l=Math.min(t,i)/10,u=Math.min(t,i)/20,a=Math.min(t,i)/25;e.textAlign="center",e.textBaseline="middle",e.font=`Bold ${l}px Arial`,e.fillStyle="#ecf0f1",e.fillText("MinuteSnake",t/2,i/6),e.font=`${u}px Arial`,e.fillStyle="#95a5a6",e.fillText("Configure Players",t/2,i/6+l*.8);let n=i*.4,o=a*2;e.font=`${a}px Arial`;let c=[{text:`Human players: ${this._playerConfig.humanPlayers}`,menuItem:0},{text:`AI players: ${this._playerConfig.aiPlayers}`,menuItem:1},{text:"Start",menuItem:2}];c.forEach((v,w)=>{let I=n+w*o,C=this._selectedMenuItem===v.menuItem;if(C&&(e.fillStyle="#3498db",e.fillRect(t/2-200,I-a*.7,400,a*1.4)),e.fillStyle=C?"#ffffff":"#ecf0f1",e.fillText(v.text,t/2,I),v.menuItem===0||v.menuItem===1){e.fillStyle=C?"#ffffff":"#95a5a6";let E=e.measureText(v.text).width,d=a*.8,_=t/2-E/2-d,b=t/2+E/2+d;e.fillText("\u25C0",_,I),e.fillText("\u25B6",b,I)}});let r=n+c.length*o+a*2,s=Math.min(t,i)/35;e.font=`${s}px Arial`,e.fillStyle="#bdc3c7",["\u2191\u2193 Navigate menu \u2022 \u25C0\u25B6 Adjust players \u2022 ENTER Start game","","Game Controls: Arrow keys (Player 1) \u2022 WASD (Player 2)","P: Playback \u2022 N: New game \u2022 ESC: Menu \u2022 +/-: Speed"].forEach((v,w)=>{let I=r+w*s*1.5;e.fillText(v,t/2,I)}),this._playerConfig.humanPlayers+this._playerConfig.aiPlayers===0&&(e.font=`Bold ${a*.8}px Arial`,e.fillStyle="#e74c3c",e.fillText("\u26A0 Select at least one player to start",t/2,r-a))}};var z=class{},j=class extends z{constructor(t,i){super();this._gameStage=t;this.savedInputs=i;m(this,"_gameLogic");m(this,"_inputIndex");this._gameLogic=new R(this._gameStage),this._inputIndex=0}get gameStage(){return this._gameStage}get isDone(){return this._inputIndex>=this.savedInputs.length}advanceTime(t){if(!(this._inputIndex>=this.savedInputs.length))for(;t>0;){let i=this._gameLogic.totalDuration+t,l=this.savedInputs[this._inputIndex];i>=l.eventTime&&(i=l.eventTime),this._gameLogic.advanceTime(i-this._gameLogic.totalDuration),this._gameLogic.totalDuration>=l.eventTime&&(this._gameLogic.input(l.gameInput),++this._inputIndex),t=i-this._gameLogic.totalDuration}}get state(){return this._gameLogic.state}performInput(t){}},H=class extends z{constructor(t,i){super();this._gameStage=t;m(this,"_gameLogic");m(this,"savedInputs");if(this.savedInputs=i||[],this._gameLogic=new R(this._gameStage),this.savedInputs.length>0)for(let l of this.savedInputs)this._gameLogic.advanceTime(l.eventTime-this._gameLogic.totalDuration),this._gameLogic.input(l.gameInput);this._gameLogic.onInputCallback=l=>this._onGameInput(l)}get gameStage(){return this._gameStage}advanceTime(t){this._gameLogic.advanceTime(t)}get isDone(){return!1}get state(){return this._gameLogic.state}_onGameInput(t){this.savedInputs.push(t)}performInput(t){this._gameLogic.input(t)}};var De=10,X=class{constructor(e,t,i){this.window=e;this.canvas=t;this.ctx=i;m(this,"_gameRenderer");m(this,"_welcomeRenderer");m(this,"_handler");m(this,"_lastEngineTime");m(this,"_isPlaybackMode",!1);m(this,"_actors",[]);m(this,"_currentState","welcome");m(this,"_welcomeCallbacks");this._welcomeCallbacks={onStartGame:l=>this._startGame(l)}}start(){this._gameRenderer=new F,this._welcomeRenderer=new q,this._initListeners(),this._updateCanvasDimensions(),this._timeout()}_initListeners(){this.window.addEventListener("resize",()=>this._updateCanvasDimensions()),this.window.addEventListener("keydown",e=>this._onKeyDown(e)),this.canvas.addEventListener("click",e=>this._onCanvasClick(e))}_onKeyDown(e){if(!e.defaultPrevented){if(this._currentState==="welcome"){this._welcomeRenderer.handleKeyInput(e,this._welcomeCallbacks),e.preventDefault();return}if(this._currentState==="game_over"){e.key.toLowerCase()==="enter"||e.key.toLowerCase()==="n"?this._showWelcomeScreen():e.key.toLowerCase()==="escape"&&this._showWelcomeScreen(),e.preventDefault();return}if(this._currentState==="playing")if(e.key.toLowerCase()==="p")this._isPlaybackMode?this._resumeLiveMode():this._enterPlaybackMode();else if(e.key.toLowerCase()==="n")this._restartLiveMode();else if(e.key.toLowerCase()==="escape")this._showWelcomeScreen();else if(e.key==="+")this._performInput({inputType:"speed",speedIncrement:1});else if(e.key==="-")this._performInput({inputType:"speed",speedIncrement:-1});else for(let t of this._actors)t instanceof D&&t.handleKeyInput(e);e.preventDefault()}}_onCanvasClick(e){e.defaultPrevented||(this._currentState==="welcome"&&this._welcomeRenderer.handleClickInput(e,this._welcomeCallbacks),this._currentState==="game_over"&&this._showWelcomeScreen(),e.preventDefault())}_updateCanvasDimensions(){this.canvas.height=this.window.innerHeight,this.canvas.width=this.window.innerWidth,this._currentState==="playing"&&this._handler&&this._gameRenderer.onCanvasSizeChanged(this.canvas.width,this.canvas.height),this._welcomeRenderer.onCanvasSizeChanged(this.canvas.width,this.canvas.height),this._draw()}_timeout(){this._update(),this._draw(),requestAnimationFrame(()=>this._timeout())}_update(){if(this._currentState==="playing"){this._advanceTimeToNow();let e=!1,t=0;do{for(let i of this._actors){let l=i.onStateUpdate(this._handler.state);l&&(this._performInput(l),e=!0)}t++}while(e&&t<De)}}_performInput(e){this._advanceTimeToNow(),this._handler.performInput(e)}_advanceTimeToNow(){let e=performance.now(),t=e-this._lastEngineTime;this._handler.advanceTime(t),this._lastEngineTime=e,this._isPlaybackMode&&this._handler.isDone&&this._resumeLiveMode()}_restartLiveMode(e){let l=e?e.humanPlayers+e.aiPlayers:this._actors.length,u=this._generateSnakeStartPositions(l,60,40),a={xTiles:60,yTiles:40,seed:Date.now(),wallHoles:[new g(0,40/2),new g(0,40/2+1),new g(59,40/2),new g(59,40/2+1)],blocks:[new g(60/2,40/2),new g(60/2-1,40/2-1),new g(60/2,40/2-1),new g(60/2-1,40/2)],snakes:u};this._isPlaybackMode=!1,this._handler=new H(a),this._lastEngineTime=performance.now(),this._gameRenderer.initRenderer(this._handler.gameStage)}_generateSnakeStartPositions(e,t,i){let l=[],a=[{position:new g(4,4),direction:2},{position:new g(t-4,i-4),direction:-2},{position:new g(t-4,4),direction:-1},{position:new g(4,i-4),direction:1},{position:new g(t/2,4),direction:-1},{position:new g(t/2,i-4),direction:1}];for(let n=0;n<Math.min(e,a.length);n++)l.push(a[n]);return l}_resumeLiveMode(){this._isPlaybackMode=!1,this._handler=new H(this._handler.gameStage,this._handler.savedInputs)}_enterPlaybackMode(){this._isPlaybackMode=!0,this._handler=new j(this._handler.gameStage,this._handler.savedInputs),this._lastEngineTime=performance.now()}_draw(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this._currentState==="welcome"?this._welcomeRenderer.render(this.ctx):(this._currentState==="playing"||this._currentState==="game_over")&&this._gameRenderer.render(this.ctx,this._handler.state,this._isPlaybackMode)}addActor(e){this._actors.push(e)}_startGame(e){this._currentState="playing",this._actors=[];let t=0;for(let i=0;i<e.humanPlayers;i++){let l=this._getKeyMapForPlayer(i);this._actors.push(new D(t,l)),t++}for(let i=0;i<e.aiPlayers;i++)this._actors.push(new O(t)),t++;this._restartLiveMode(e),this._gameRenderer.onCanvasSizeChanged(this.canvas.width,this.canvas.height)}_getKeyMapForPlayer(e){return e===0?{up:"arrowup",down:"arrowdown",left:"arrowleft",right:"arrowright"}:{up:"w",down:"s",left:"a",right:"d"}}_showWelcomeScreen(){this._currentState="welcome",this._actors=[],this._isPlaybackMode=!1}_showGameOver(){this._currentState="game_over"}get currentState(){return this._currentState}};var ee=class{constructor(){m(this,"gameEngine",null);window.addEventListener("DOMContentLoaded",()=>this.initialize())}initialize(){let e=document.querySelector("#canvas");if(!e){console.error("Canvas element not found");return}let t=e.getContext("2d");if(!t){console.error("Could not get 2D context");return}this.gameEngine=new X(window,e,t),this.gameEngine.start()}};new ee;
//# sourceMappingURL=bundle.js.map
