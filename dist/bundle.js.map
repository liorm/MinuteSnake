{
  "version": 3,
  "sources": ["../node_modules/seedrandom/lib/alea.js", "../node_modules/seedrandom/lib/xor128.js", "../node_modules/seedrandom/lib/xorwow.js", "../node_modules/seedrandom/lib/xorshift7.js", "../node_modules/seedrandom/lib/xor4096.js", "../node_modules/seedrandom/lib/tychei.js", "../node_modules/seedrandom/seedrandom.js", "../node_modules/seedrandom/index.js", "../src/backend/utils.ts", "../src/backend/game-logic.ts", "../src/actors/human-actor.ts", "../src/actors/ai-actor.ts", "../src/game-renderer.ts", "../src/welcome-renderer.ts", "../src/backend/state-handlers.ts", "../src/game-engine.ts", "../src/app.ts"],
  "sourcesContent": ["// A port of an algorithm by Johannes Baag\u00F8e <baagoe@baagoe.com>, 2010\n// http://baagoe.com/en/RandomMusings/javascript/\n// https://github.com/nquinlan/better-random-numbers-for-javascript-mirror\n// Original work is under MIT license -\n\n// Copyright (C) 2010 by Johannes Baag\u00F8e <baagoe@baagoe.org>\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n\n\n(function(global, module, define) {\n\nfunction Alea(seed) {\n  var me = this, mash = Mash();\n\n  me.next = function() {\n    var t = 2091639 * me.s0 + me.c * 2.3283064365386963e-10; // 2^-32\n    me.s0 = me.s1;\n    me.s1 = me.s2;\n    return me.s2 = t - (me.c = t | 0);\n  };\n\n  // Apply the seeding algorithm from Baagoe.\n  me.c = 1;\n  me.s0 = mash(' ');\n  me.s1 = mash(' ');\n  me.s2 = mash(' ');\n  me.s0 -= mash(seed);\n  if (me.s0 < 0) { me.s0 += 1; }\n  me.s1 -= mash(seed);\n  if (me.s1 < 0) { me.s1 += 1; }\n  me.s2 -= mash(seed);\n  if (me.s2 < 0) { me.s2 += 1; }\n  mash = null;\n}\n\nfunction copy(f, t) {\n  t.c = f.c;\n  t.s0 = f.s0;\n  t.s1 = f.s1;\n  t.s2 = f.s2;\n  return t;\n}\n\nfunction impl(seed, opts) {\n  var xg = new Alea(seed),\n      state = opts && opts.state,\n      prng = xg.next;\n  prng.int32 = function() { return (xg.next() * 0x100000000) | 0; }\n  prng.double = function() {\n    return prng() + (prng() * 0x200000 | 0) * 1.1102230246251565e-16; // 2^-53\n  };\n  prng.quick = prng;\n  if (state) {\n    if (typeof(state) == 'object') copy(state, xg);\n    prng.state = function() { return copy(xg, {}); }\n  }\n  return prng;\n}\n\nfunction Mash() {\n  var n = 0xefc8249d;\n\n  var mash = function(data) {\n    data = String(data);\n    for (var i = 0; i < data.length; i++) {\n      n += data.charCodeAt(i);\n      var h = 0.02519603282416938 * n;\n      n = h >>> 0;\n      h -= n;\n      h *= n;\n      n = h >>> 0;\n      h -= n;\n      n += h * 0x100000000; // 2^32\n    }\n    return (n >>> 0) * 2.3283064365386963e-10; // 2^-32\n  };\n\n  return mash;\n}\n\n\nif (module && module.exports) {\n  module.exports = impl;\n} else if (define && define.amd) {\n  define(function() { return impl; });\n} else {\n  this.alea = impl;\n}\n\n})(\n  this,\n  (typeof module) == 'object' && module,    // present in node.js\n  (typeof define) == 'function' && define   // present with an AMD loader\n);\n\n\n", "// A Javascript implementaion of the \"xor128\" prng algorithm by\n// George Marsaglia.  See http://www.jstatsoft.org/v08/i14/paper\n\n(function(global, module, define) {\n\nfunction XorGen(seed) {\n  var me = this, strseed = '';\n\n  me.x = 0;\n  me.y = 0;\n  me.z = 0;\n  me.w = 0;\n\n  // Set up generator function.\n  me.next = function() {\n    var t = me.x ^ (me.x << 11);\n    me.x = me.y;\n    me.y = me.z;\n    me.z = me.w;\n    return me.w ^= (me.w >>> 19) ^ t ^ (t >>> 8);\n  };\n\n  if (seed === (seed | 0)) {\n    // Integer seed.\n    me.x = seed;\n  } else {\n    // String seed.\n    strseed += seed;\n  }\n\n  // Mix in string seed, then discard an initial batch of 64 values.\n  for (var k = 0; k < strseed.length + 64; k++) {\n    me.x ^= strseed.charCodeAt(k) | 0;\n    me.next();\n  }\n}\n\nfunction copy(f, t) {\n  t.x = f.x;\n  t.y = f.y;\n  t.z = f.z;\n  t.w = f.w;\n  return t;\n}\n\nfunction impl(seed, opts) {\n  var xg = new XorGen(seed),\n      state = opts && opts.state,\n      prng = function() { return (xg.next() >>> 0) / 0x100000000; };\n  prng.double = function() {\n    do {\n      var top = xg.next() >>> 11,\n          bot = (xg.next() >>> 0) / 0x100000000,\n          result = (top + bot) / (1 << 21);\n    } while (result === 0);\n    return result;\n  };\n  prng.int32 = xg.next;\n  prng.quick = prng;\n  if (state) {\n    if (typeof(state) == 'object') copy(state, xg);\n    prng.state = function() { return copy(xg, {}); }\n  }\n  return prng;\n}\n\nif (module && module.exports) {\n  module.exports = impl;\n} else if (define && define.amd) {\n  define(function() { return impl; });\n} else {\n  this.xor128 = impl;\n}\n\n})(\n  this,\n  (typeof module) == 'object' && module,    // present in node.js\n  (typeof define) == 'function' && define   // present with an AMD loader\n);\n\n\n", "// A Javascript implementaion of the \"xorwow\" prng algorithm by\n// George Marsaglia.  See http://www.jstatsoft.org/v08/i14/paper\n\n(function(global, module, define) {\n\nfunction XorGen(seed) {\n  var me = this, strseed = '';\n\n  // Set up generator function.\n  me.next = function() {\n    var t = (me.x ^ (me.x >>> 2));\n    me.x = me.y; me.y = me.z; me.z = me.w; me.w = me.v;\n    return (me.d = (me.d + 362437 | 0)) +\n       (me.v = (me.v ^ (me.v << 4)) ^ (t ^ (t << 1))) | 0;\n  };\n\n  me.x = 0;\n  me.y = 0;\n  me.z = 0;\n  me.w = 0;\n  me.v = 0;\n\n  if (seed === (seed | 0)) {\n    // Integer seed.\n    me.x = seed;\n  } else {\n    // String seed.\n    strseed += seed;\n  }\n\n  // Mix in string seed, then discard an initial batch of 64 values.\n  for (var k = 0; k < strseed.length + 64; k++) {\n    me.x ^= strseed.charCodeAt(k) | 0;\n    if (k == strseed.length) {\n      me.d = me.x << 10 ^ me.x >>> 4;\n    }\n    me.next();\n  }\n}\n\nfunction copy(f, t) {\n  t.x = f.x;\n  t.y = f.y;\n  t.z = f.z;\n  t.w = f.w;\n  t.v = f.v;\n  t.d = f.d;\n  return t;\n}\n\nfunction impl(seed, opts) {\n  var xg = new XorGen(seed),\n      state = opts && opts.state,\n      prng = function() { return (xg.next() >>> 0) / 0x100000000; };\n  prng.double = function() {\n    do {\n      var top = xg.next() >>> 11,\n          bot = (xg.next() >>> 0) / 0x100000000,\n          result = (top + bot) / (1 << 21);\n    } while (result === 0);\n    return result;\n  };\n  prng.int32 = xg.next;\n  prng.quick = prng;\n  if (state) {\n    if (typeof(state) == 'object') copy(state, xg);\n    prng.state = function() { return copy(xg, {}); }\n  }\n  return prng;\n}\n\nif (module && module.exports) {\n  module.exports = impl;\n} else if (define && define.amd) {\n  define(function() { return impl; });\n} else {\n  this.xorwow = impl;\n}\n\n})(\n  this,\n  (typeof module) == 'object' && module,    // present in node.js\n  (typeof define) == 'function' && define   // present with an AMD loader\n);\n\n\n", "// A Javascript implementaion of the \"xorshift7\" algorithm by\n// Fran\u00E7ois Panneton and Pierre L'ecuyer:\n// \"On the Xorgshift Random Number Generators\"\n// http://saluc.engr.uconn.edu/refs/crypto/rng/panneton05onthexorshift.pdf\n\n(function(global, module, define) {\n\nfunction XorGen(seed) {\n  var me = this;\n\n  // Set up generator function.\n  me.next = function() {\n    // Update xor generator.\n    var X = me.x, i = me.i, t, v, w;\n    t = X[i]; t ^= (t >>> 7); v = t ^ (t << 24);\n    t = X[(i + 1) & 7]; v ^= t ^ (t >>> 10);\n    t = X[(i + 3) & 7]; v ^= t ^ (t >>> 3);\n    t = X[(i + 4) & 7]; v ^= t ^ (t << 7);\n    t = X[(i + 7) & 7]; t = t ^ (t << 13); v ^= t ^ (t << 9);\n    X[i] = v;\n    me.i = (i + 1) & 7;\n    return v;\n  };\n\n  function init(me, seed) {\n    var j, w, X = [];\n\n    if (seed === (seed | 0)) {\n      // Seed state array using a 32-bit integer.\n      w = X[0] = seed;\n    } else {\n      // Seed state using a string.\n      seed = '' + seed;\n      for (j = 0; j < seed.length; ++j) {\n        X[j & 7] = (X[j & 7] << 15) ^\n            (seed.charCodeAt(j) + X[(j + 1) & 7] << 13);\n      }\n    }\n    // Enforce an array length of 8, not all zeroes.\n    while (X.length < 8) X.push(0);\n    for (j = 0; j < 8 && X[j] === 0; ++j);\n    if (j == 8) w = X[7] = -1; else w = X[j];\n\n    me.x = X;\n    me.i = 0;\n\n    // Discard an initial 256 values.\n    for (j = 256; j > 0; --j) {\n      me.next();\n    }\n  }\n\n  init(me, seed);\n}\n\nfunction copy(f, t) {\n  t.x = f.x.slice();\n  t.i = f.i;\n  return t;\n}\n\nfunction impl(seed, opts) {\n  if (seed == null) seed = +(new Date);\n  var xg = new XorGen(seed),\n      state = opts && opts.state,\n      prng = function() { return (xg.next() >>> 0) / 0x100000000; };\n  prng.double = function() {\n    do {\n      var top = xg.next() >>> 11,\n          bot = (xg.next() >>> 0) / 0x100000000,\n          result = (top + bot) / (1 << 21);\n    } while (result === 0);\n    return result;\n  };\n  prng.int32 = xg.next;\n  prng.quick = prng;\n  if (state) {\n    if (state.x) copy(state, xg);\n    prng.state = function() { return copy(xg, {}); }\n  }\n  return prng;\n}\n\nif (module && module.exports) {\n  module.exports = impl;\n} else if (define && define.amd) {\n  define(function() { return impl; });\n} else {\n  this.xorshift7 = impl;\n}\n\n})(\n  this,\n  (typeof module) == 'object' && module,    // present in node.js\n  (typeof define) == 'function' && define   // present with an AMD loader\n);\n\n", "// A Javascript implementaion of Richard Brent's Xorgens xor4096 algorithm.\n//\n// This fast non-cryptographic random number generator is designed for\n// use in Monte-Carlo algorithms. It combines a long-period xorshift\n// generator with a Weyl generator, and it passes all common batteries\n// of stasticial tests for randomness while consuming only a few nanoseconds\n// for each prng generated.  For background on the generator, see Brent's\n// paper: \"Some long-period random number generators using shifts and xors.\"\n// http://arxiv.org/pdf/1004.3115v1.pdf\n//\n// Usage:\n//\n// var xor4096 = require('xor4096');\n// random = xor4096(1);                        // Seed with int32 or string.\n// assert.equal(random(), 0.1520436450538547); // (0, 1) range, 53 bits.\n// assert.equal(random.int32(), 1806534897);   // signed int32, 32 bits.\n//\n// For nonzero numeric keys, this impelementation provides a sequence\n// identical to that by Brent's xorgens 3 implementaion in C.  This\n// implementation also provides for initalizing the generator with\n// string seeds, or for saving and restoring the state of the generator.\n//\n// On Chrome, this prng benchmarks about 2.1 times slower than\n// Javascript's built-in Math.random().\n\n(function(global, module, define) {\n\nfunction XorGen(seed) {\n  var me = this;\n\n  // Set up generator function.\n  me.next = function() {\n    var w = me.w,\n        X = me.X, i = me.i, t, v;\n    // Update Weyl generator.\n    me.w = w = (w + 0x61c88647) | 0;\n    // Update xor generator.\n    v = X[(i + 34) & 127];\n    t = X[i = ((i + 1) & 127)];\n    v ^= v << 13;\n    t ^= t << 17;\n    v ^= v >>> 15;\n    t ^= t >>> 12;\n    // Update Xor generator array state.\n    v = X[i] = v ^ t;\n    me.i = i;\n    // Result is the combination.\n    return (v + (w ^ (w >>> 16))) | 0;\n  };\n\n  function init(me, seed) {\n    var t, v, i, j, w, X = [], limit = 128;\n    if (seed === (seed | 0)) {\n      // Numeric seeds initialize v, which is used to generates X.\n      v = seed;\n      seed = null;\n    } else {\n      // String seeds are mixed into v and X one character at a time.\n      seed = seed + '\\0';\n      v = 0;\n      limit = Math.max(limit, seed.length);\n    }\n    // Initialize circular array and weyl value.\n    for (i = 0, j = -32; j < limit; ++j) {\n      // Put the unicode characters into the array, and shuffle them.\n      if (seed) v ^= seed.charCodeAt((j + 32) % seed.length);\n      // After 32 shuffles, take v as the starting w value.\n      if (j === 0) w = v;\n      v ^= v << 10;\n      v ^= v >>> 15;\n      v ^= v << 4;\n      v ^= v >>> 13;\n      if (j >= 0) {\n        w = (w + 0x61c88647) | 0;     // Weyl.\n        t = (X[j & 127] ^= (v + w));  // Combine xor and weyl to init array.\n        i = (0 == t) ? i + 1 : 0;     // Count zeroes.\n      }\n    }\n    // We have detected all zeroes; make the key nonzero.\n    if (i >= 128) {\n      X[(seed && seed.length || 0) & 127] = -1;\n    }\n    // Run the generator 512 times to further mix the state before using it.\n    // Factoring this as a function slows the main generator, so it is just\n    // unrolled here.  The weyl generator is not advanced while warming up.\n    i = 127;\n    for (j = 4 * 128; j > 0; --j) {\n      v = X[(i + 34) & 127];\n      t = X[i = ((i + 1) & 127)];\n      v ^= v << 13;\n      t ^= t << 17;\n      v ^= v >>> 15;\n      t ^= t >>> 12;\n      X[i] = v ^ t;\n    }\n    // Storing state as object members is faster than using closure variables.\n    me.w = w;\n    me.X = X;\n    me.i = i;\n  }\n\n  init(me, seed);\n}\n\nfunction copy(f, t) {\n  t.i = f.i;\n  t.w = f.w;\n  t.X = f.X.slice();\n  return t;\n};\n\nfunction impl(seed, opts) {\n  if (seed == null) seed = +(new Date);\n  var xg = new XorGen(seed),\n      state = opts && opts.state,\n      prng = function() { return (xg.next() >>> 0) / 0x100000000; };\n  prng.double = function() {\n    do {\n      var top = xg.next() >>> 11,\n          bot = (xg.next() >>> 0) / 0x100000000,\n          result = (top + bot) / (1 << 21);\n    } while (result === 0);\n    return result;\n  };\n  prng.int32 = xg.next;\n  prng.quick = prng;\n  if (state) {\n    if (state.X) copy(state, xg);\n    prng.state = function() { return copy(xg, {}); }\n  }\n  return prng;\n}\n\nif (module && module.exports) {\n  module.exports = impl;\n} else if (define && define.amd) {\n  define(function() { return impl; });\n} else {\n  this.xor4096 = impl;\n}\n\n})(\n  this,                                     // window object or global\n  (typeof module) == 'object' && module,    // present in node.js\n  (typeof define) == 'function' && define   // present with an AMD loader\n);\n", "// A Javascript implementaion of the \"Tyche-i\" prng algorithm by\n// Samuel Neves and Filipe Araujo.\n// See https://eden.dei.uc.pt/~sneves/pubs/2011-snfa2.pdf\n\n(function(global, module, define) {\n\nfunction XorGen(seed) {\n  var me = this, strseed = '';\n\n  // Set up generator function.\n  me.next = function() {\n    var b = me.b, c = me.c, d = me.d, a = me.a;\n    b = (b << 25) ^ (b >>> 7) ^ c;\n    c = (c - d) | 0;\n    d = (d << 24) ^ (d >>> 8) ^ a;\n    a = (a - b) | 0;\n    me.b = b = (b << 20) ^ (b >>> 12) ^ c;\n    me.c = c = (c - d) | 0;\n    me.d = (d << 16) ^ (c >>> 16) ^ a;\n    return me.a = (a - b) | 0;\n  };\n\n  /* The following is non-inverted tyche, which has better internal\n   * bit diffusion, but which is about 25% slower than tyche-i in JS.\n  me.next = function() {\n    var a = me.a, b = me.b, c = me.c, d = me.d;\n    a = (me.a + me.b | 0) >>> 0;\n    d = me.d ^ a; d = d << 16 ^ d >>> 16;\n    c = me.c + d | 0;\n    b = me.b ^ c; b = b << 12 ^ d >>> 20;\n    me.a = a = a + b | 0;\n    d = d ^ a; me.d = d = d << 8 ^ d >>> 24;\n    me.c = c = c + d | 0;\n    b = b ^ c;\n    return me.b = (b << 7 ^ b >>> 25);\n  }\n  */\n\n  me.a = 0;\n  me.b = 0;\n  me.c = 2654435769 | 0;\n  me.d = 1367130551;\n\n  if (seed === Math.floor(seed)) {\n    // Integer seed.\n    me.a = (seed / 0x100000000) | 0;\n    me.b = seed | 0;\n  } else {\n    // String seed.\n    strseed += seed;\n  }\n\n  // Mix in string seed, then discard an initial batch of 64 values.\n  for (var k = 0; k < strseed.length + 20; k++) {\n    me.b ^= strseed.charCodeAt(k) | 0;\n    me.next();\n  }\n}\n\nfunction copy(f, t) {\n  t.a = f.a;\n  t.b = f.b;\n  t.c = f.c;\n  t.d = f.d;\n  return t;\n};\n\nfunction impl(seed, opts) {\n  var xg = new XorGen(seed),\n      state = opts && opts.state,\n      prng = function() { return (xg.next() >>> 0) / 0x100000000; };\n  prng.double = function() {\n    do {\n      var top = xg.next() >>> 11,\n          bot = (xg.next() >>> 0) / 0x100000000,\n          result = (top + bot) / (1 << 21);\n    } while (result === 0);\n    return result;\n  };\n  prng.int32 = xg.next;\n  prng.quick = prng;\n  if (state) {\n    if (typeof(state) == 'object') copy(state, xg);\n    prng.state = function() { return copy(xg, {}); }\n  }\n  return prng;\n}\n\nif (module && module.exports) {\n  module.exports = impl;\n} else if (define && define.amd) {\n  define(function() { return impl; });\n} else {\n  this.tychei = impl;\n}\n\n})(\n  this,\n  (typeof module) == 'object' && module,    // present in node.js\n  (typeof define) == 'function' && define   // present with an AMD loader\n);\n\n\n", "/*\nCopyright 2019 David Bau.\n\nPermission is hereby granted, free of charge, to any person obtaining\na copy of this software and associated documentation files (the\n\"Software\"), to deal in the Software without restriction, including\nwithout limitation the rights to use, copy, modify, merge, publish,\ndistribute, sublicense, and/or sell copies of the Software, and to\npermit persons to whom the Software is furnished to do so, subject to\nthe following conditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\nMERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.\nIN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY\nCLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,\nTORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\nSOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n*/\n\n(function (global, pool, math) {\n//\n// The following constants are related to IEEE 754 limits.\n//\n\nvar width = 256,        // each RC4 output is 0 <= x < 256\n    chunks = 6,         // at least six RC4 outputs for each double\n    digits = 52,        // there are 52 significant digits in a double\n    rngname = 'random', // rngname: name for Math.random and Math.seedrandom\n    startdenom = math.pow(width, chunks),\n    significance = math.pow(2, digits),\n    overflow = significance * 2,\n    mask = width - 1,\n    nodecrypto;         // node.js crypto module, initialized at the bottom.\n\n//\n// seedrandom()\n// This is the seedrandom function described above.\n//\nfunction seedrandom(seed, options, callback) {\n  var key = [];\n  options = (options == true) ? { entropy: true } : (options || {});\n\n  // Flatten the seed string or build one from local entropy if needed.\n  var shortseed = mixkey(flatten(\n    options.entropy ? [seed, tostring(pool)] :\n    (seed == null) ? autoseed() : seed, 3), key);\n\n  // Use the seed to initialize an ARC4 generator.\n  var arc4 = new ARC4(key);\n\n  // This function returns a random double in [0, 1) that contains\n  // randomness in every bit of the mantissa of the IEEE 754 value.\n  var prng = function() {\n    var n = arc4.g(chunks),             // Start with a numerator n < 2 ^ 48\n        d = startdenom,                 //   and denominator d = 2 ^ 48.\n        x = 0;                          //   and no 'extra last byte'.\n    while (n < significance) {          // Fill up all significant digits by\n      n = (n + x) * width;              //   shifting numerator and\n      d *= width;                       //   denominator and generating a\n      x = arc4.g(1);                    //   new least-significant-byte.\n    }\n    while (n >= overflow) {             // To avoid rounding up, before adding\n      n /= 2;                           //   last byte, shift everything\n      d /= 2;                           //   right using integer math until\n      x >>>= 1;                         //   we have exactly the desired bits.\n    }\n    return (n + x) / d;                 // Form the number within [0, 1).\n  };\n\n  prng.int32 = function() { return arc4.g(4) | 0; }\n  prng.quick = function() { return arc4.g(4) / 0x100000000; }\n  prng.double = prng;\n\n  // Mix the randomness into accumulated entropy.\n  mixkey(tostring(arc4.S), pool);\n\n  // Calling convention: what to return as a function of prng, seed, is_math.\n  return (options.pass || callback ||\n      function(prng, seed, is_math_call, state) {\n        if (state) {\n          // Load the arc4 state from the given state if it has an S array.\n          if (state.S) { copy(state, arc4); }\n          // Only provide the .state method if requested via options.state.\n          prng.state = function() { return copy(arc4, {}); }\n        }\n\n        // If called as a method of Math (Math.seedrandom()), mutate\n        // Math.random because that is how seedrandom.js has worked since v1.0.\n        if (is_math_call) { math[rngname] = prng; return seed; }\n\n        // Otherwise, it is a newer calling convention, so return the\n        // prng directly.\n        else return prng;\n      })(\n  prng,\n  shortseed,\n  'global' in options ? options.global : (this == math),\n  options.state);\n}\n\n//\n// ARC4\n//\n// An ARC4 implementation.  The constructor takes a key in the form of\n// an array of at most (width) integers that should be 0 <= x < (width).\n//\n// The g(count) method returns a pseudorandom integer that concatenates\n// the next (count) outputs from ARC4.  Its return value is a number x\n// that is in the range 0 <= x < (width ^ count).\n//\nfunction ARC4(key) {\n  var t, keylen = key.length,\n      me = this, i = 0, j = me.i = me.j = 0, s = me.S = [];\n\n  // The empty key [] is treated as [0].\n  if (!keylen) { key = [keylen++]; }\n\n  // Set up S using the standard key scheduling algorithm.\n  while (i < width) {\n    s[i] = i++;\n  }\n  for (i = 0; i < width; i++) {\n    s[i] = s[j = mask & (j + key[i % keylen] + (t = s[i]))];\n    s[j] = t;\n  }\n\n  // The \"g\" method returns the next (count) outputs as one number.\n  (me.g = function(count) {\n    // Using instance members instead of closure state nearly doubles speed.\n    var t, r = 0,\n        i = me.i, j = me.j, s = me.S;\n    while (count--) {\n      t = s[i = mask & (i + 1)];\n      r = r * width + s[mask & ((s[i] = s[j = mask & (j + t)]) + (s[j] = t))];\n    }\n    me.i = i; me.j = j;\n    return r;\n    // For robust unpredictability, the function call below automatically\n    // discards an initial batch of values.  This is called RC4-drop[256].\n    // See http://google.com/search?q=rsa+fluhrer+response&btnI\n  })(width);\n}\n\n//\n// copy()\n// Copies internal state of ARC4 to or from a plain object.\n//\nfunction copy(f, t) {\n  t.i = f.i;\n  t.j = f.j;\n  t.S = f.S.slice();\n  return t;\n};\n\n//\n// flatten()\n// Converts an object tree to nested arrays of strings.\n//\nfunction flatten(obj, depth) {\n  var result = [], typ = (typeof obj), prop;\n  if (depth && typ == 'object') {\n    for (prop in obj) {\n      try { result.push(flatten(obj[prop], depth - 1)); } catch (e) {}\n    }\n  }\n  return (result.length ? result : typ == 'string' ? obj : obj + '\\0');\n}\n\n//\n// mixkey()\n// Mixes a string seed into a key that is an array of integers, and\n// returns a shortened string seed that is equivalent to the result key.\n//\nfunction mixkey(seed, key) {\n  var stringseed = seed + '', smear, j = 0;\n  while (j < stringseed.length) {\n    key[mask & j] =\n      mask & ((smear ^= key[mask & j] * 19) + stringseed.charCodeAt(j++));\n  }\n  return tostring(key);\n}\n\n//\n// autoseed()\n// Returns an object for autoseeding, using window.crypto and Node crypto\n// module if available.\n//\nfunction autoseed() {\n  try {\n    var out;\n    if (nodecrypto && (out = nodecrypto.randomBytes)) {\n      // The use of 'out' to remember randomBytes makes tight minified code.\n      out = out(width);\n    } else {\n      out = new Uint8Array(width);\n      (global.crypto || global.msCrypto).getRandomValues(out);\n    }\n    return tostring(out);\n  } catch (e) {\n    var browser = global.navigator,\n        plugins = browser && browser.plugins;\n    return [+new Date, global, plugins, global.screen, tostring(pool)];\n  }\n}\n\n//\n// tostring()\n// Converts an array of charcodes to a string\n//\nfunction tostring(a) {\n  return String.fromCharCode.apply(0, a);\n}\n\n//\n// When seedrandom.js is loaded, we immediately mix a few bits\n// from the built-in RNG into the entropy pool.  Because we do\n// not want to interfere with deterministic PRNG state later,\n// seedrandom will not call math.random on its own again after\n// initialization.\n//\nmixkey(math.random(), pool);\n\n//\n// Nodejs and AMD support: export the implementation as a module using\n// either convention.\n//\nif ((typeof module) == 'object' && module.exports) {\n  module.exports = seedrandom;\n  // When in node.js, try using crypto package for autoseeding.\n  try {\n    nodecrypto = require('crypto');\n  } catch (ex) {}\n} else if ((typeof define) == 'function' && define.amd) {\n  define(function() { return seedrandom; });\n} else {\n  // When included as a plain script, set up Math.seedrandom global.\n  math['seed' + rngname] = seedrandom;\n}\n\n\n// End anonymous scope, and pass initial values.\n})(\n  // global: `self` in browsers (including strict mode and web workers),\n  // otherwise `this` in Node and other environments\n  (typeof self !== 'undefined') ? self : this,\n  [],     // pool: entropy pool starts empty\n  Math    // math: package containing random, pow, and seedrandom\n);\n", "// A library of seedable RNGs implemented in Javascript.\n//\n// Usage:\n//\n// var seedrandom = require('seedrandom');\n// var random = seedrandom(1); // or any seed.\n// var x = random();       // 0 <= x < 1.  Every bit is random.\n// var x = random.quick(); // 0 <= x < 1.  32 bits of randomness.\n\n// alea, a 53-bit multiply-with-carry generator by Johannes Baag\u00F8e.\n// Period: ~2^116\n// Reported to pass all BigCrush tests.\nvar alea = require('./lib/alea');\n\n// xor128, a pure xor-shift generator by George Marsaglia.\n// Period: 2^128-1.\n// Reported to fail: MatrixRank and LinearComp.\nvar xor128 = require('./lib/xor128');\n\n// xorwow, George Marsaglia's 160-bit xor-shift combined plus weyl.\n// Period: 2^192-2^32\n// Reported to fail: CollisionOver, SimpPoker, and LinearComp.\nvar xorwow = require('./lib/xorwow');\n\n// xorshift7, by Fran\u00E7ois Panneton and Pierre L'ecuyer, takes\n// a different approach: it adds robustness by allowing more shifts\n// than Marsaglia's original three.  It is a 7-shift generator\n// with 256 bits, that passes BigCrush with no systmatic failures.\n// Period 2^256-1.\n// No systematic BigCrush failures reported.\nvar xorshift7 = require('./lib/xorshift7');\n\n// xor4096, by Richard Brent, is a 4096-bit xor-shift with a\n// very long period that also adds a Weyl generator. It also passes\n// BigCrush with no systematic failures.  Its long period may\n// be useful if you have many generators and need to avoid\n// collisions.\n// Period: 2^4128-2^32.\n// No systematic BigCrush failures reported.\nvar xor4096 = require('./lib/xor4096');\n\n// Tyche-i, by Samuel Neves and Filipe Araujo, is a bit-shifting random\n// number generator derived from ChaCha, a modern stream cipher.\n// https://eden.dei.uc.pt/~sneves/pubs/2011-snfa2.pdf\n// Period: ~2^127\n// No systematic BigCrush failures reported.\nvar tychei = require('./lib/tychei');\n\n// The original ARC4-based prng included in this library.\n// Period: ~2^1600\nvar sr = require('./seedrandom');\n\nsr.alea = alea;\nsr.xor128 = xor128;\nsr.xorwow = xorwow;\nsr.xorshift7 = xorshift7;\nsr.xor4096 = xor4096;\nsr.tychei = tychei;\n\nmodule.exports = sr;\n", "/**\n * A 2D vector class providing essential operations for game position calculations.\n * Used throughout the game for snake positions, apple placement, and collision detection.\n * Supports vector arithmetic, comparison, and transformation operations.\n *\n * Example:\n * ```typescript\n * const pos = new Vector(10, 20);\n * const newPos = pos.add(new Vector(5, 0)); // Move right by 5\n * ```\n */\nexport class Vector {\n  x: number;\n  y: number;\n\n  constructor(v: Vector);\n  constructor(x: number, y: number);\n  constructor(vx: Vector | number, y?: number) {\n    if (vx instanceof Vector) {\n      this.x = vx.x;\n      this.y = vx.y;\n    } else {\n      this.x = vx || 0;\n      this.y = y || 0;\n    }\n  }\n\n  /**\n   * Checks if this vector equals another vector or coordinate pair.\n   * Used for collision detection and position comparison.\n   */\n  equals(v: Vector | null | undefined): boolean;\n  equals(x: number, y: number): boolean;\n  equals(vx: Vector | number | null | undefined, y?: number): boolean {\n    if (vx === undefined || vx === null) {\n      return false;\n    }\n\n    if (vx instanceof Vector) {\n      return this.x === vx.x && this.y === vx.y;\n    } else {\n      return this.x === vx && this.y === y;\n    }\n  }\n\n  /**\n   * Creates a new Vector with the same coordinates.\n   * Useful when you need a copy that won't be modified by reference.\n   */\n  clone(): Vector {\n    return new Vector(this);\n  }\n\n  /**\n   * Adds another vector or coordinate pair to this vector.\n   * Returns a new Vector without modifying the original.\n   * Used for calculating new positions and offsets.\n   */\n  add(v: Vector): Vector;\n  add(x: number, y: number): Vector;\n  add(vx: Vector | number, y?: number): Vector {\n    if (vx instanceof Vector) {\n      return new Vector(this.x + vx.x, this.y + vx.y);\n    } else {\n      return new Vector(this.x + vx, this.y + (y || 0));\n    }\n  }\n\n  /**\n   * Subtracts another vector or coordinate pair from this vector.\n   * Returns a new Vector without modifying the original.\n   * Used for calculating distances and relative positions.\n   */\n  sub(v: Vector): Vector;\n  sub(x: number, y: number): Vector;\n  sub(vx: Vector | number, y?: number): Vector {\n    if (vx instanceof Vector) {\n      return this.add(new Vector(-vx.x, -vx.y));\n    } else {\n      return this.add(-vx, -(y || 0));\n    }\n  }\n\n  /**\n   * Multiplies the vector by a scalar value.\n   * Used for scaling positions and directions.\n   */\n  mul(scalar: number): Vector {\n    return new Vector(this.x * scalar, this.y * scalar);\n  }\n\n  /**\n   * Returns a new Vector with negated coordinates.\n   * Shorthand for multiplying by -1.\n   */\n  invert(): Vector {\n    return this.mul(-1);\n  }\n}\n", "import { Vector } from './utils';\nimport seedrandom from 'seedrandom';\n\nfunction assertNever(x: never): never {\n  throw new Error('Unexpected object: ' + x);\n}\n\n/**\n * Represents a timestamped game input event used for replay functionality.\n * Captures both the type of input and when it occurred during gameplay.\n */\nexport interface IGameEventInput {\n  eventTime: number;\n  gameInput: GameInput;\n}\n\n/**\n * Represents cardinal directions for snake movement.\n * Opposing directions have values that sum to 0, which is used\n * to prevent 180-degree turns.\n */\nexport enum EDirection {\n  UP = 1,\n  RIGHT = 2,\n  LEFT = -2,\n  DOWN = -1,\n}\n\n/**\n * Basic game configuration options defining the playing field size\n * and random number generation seed for deterministic gameplay.\n */\nexport interface IGameOptions {\n  xTiles: number;\n  yTiles: number;\n  seed: number;\n}\n\n/**\n * Complete game stage configuration including wall holes (portals),\n * obstacle blocks, and initial snake positions/directions.\n * Extends IGameOptions to include all elements needed for stage setup.\n */\nexport interface IGameStage extends IGameOptions {\n  wallHoles: Vector[];\n  blocks: Vector[];\n\n  /// Starting positions for the snake.\n  snakes: {\n    position: Vector;\n    direction: EDirection;\n  }[];\n}\n\n/**\n * Represents the current state of a snake in the game.\n * Tracks position, length, occupied tiles, current direction\n * and queued direction changes.\n */\nexport interface IGameStateSnake {\n  position: Vector;\n  length: number;\n  tiles: Vector[];\n  dir: EDirection;\n  pendingDirs: EDirection[];\n}\n\n/**\n * Complete game state including all snakes, obstacles,\n * apple position, game speed and win/loss condition.\n * Used by both the game logic and renderer.\n */\nexport interface IGameState {\n  blocks: Vector[];\n  speed: number;\n  applePos: Vector | null;\n  snakes: IGameStateSnake[];\n  gameOver: boolean;\n}\n\n/**\n * Direction change input for a specific snake.\n * Used to queue new movement directions that will be applied\n * on the next game step.\n */\nexport interface IGameInputDirection {\n  inputType: 'direction';\n  dir: EDirection;\n  snakeIdx: number;\n}\n\n/**\n * Speed adjustment input that modifies the game's\n * update rate. Controls how frequently the game state advances.\n */\nexport interface IGameInputSpeed {\n  inputType: 'speed';\n  speedIncrement: number;\n}\n\nexport type GameInput = IGameInputDirection | IGameInputSpeed;\n\n/**\n * Core game logic implementation handling snake movement, collisions,\n * apple placement, and game state management. Uses seeded random number\n * generation for deterministic apple placement, enabling replay functionality.\n *\n * Maintains game state including snake positions, apple location, blocks,\n * and handles input processing for direction changes and speed adjustments.\n *\n * Example:\n * ```typescript\n * const gameLogic = new GameLogic(gameStage);\n * gameLogic.input({ inputType: 'direction', dir: EDirection.RIGHT, snakeIdx: 0 });\n * gameLogic.advanceTime(16); // Advance game by 16ms\n * ```\n */\nexport class GameLogic {\n  private _prng: () => number;\n  private _state: IGameState;\n  private _pendingDuration: number = 0;\n  private _totalDuration: number = 0;\n  onInputCallback: ((event: IGameEventInput) => void) | undefined;\n\n  get options(): IGameOptions {\n    return this._stage;\n  }\n  get state(): IGameState {\n    return this._state;\n  }\n  get totalDuration(): number {\n    return this._totalDuration;\n  }\n\n  constructor(private _stage: IGameStage) {\n    this._prng = seedrandom(`${_stage.seed}\\0`);\n    this._state = this._createInitialState();\n  }\n\n  private _createInitialState(): IGameState {\n    let blocks: Vector[] = [];\n    for (let x = 0; x < this._stage.xTiles; ++x) {\n      blocks.push(new Vector(x, 0), new Vector(x, this._stage.yTiles - 1));\n    }\n    // Add vertical walls (left and right) excluding corners\n    for (let y = 1; y < this._stage.yTiles - 1; ++y) {\n      blocks.push(new Vector(0, y), new Vector(this._stage.xTiles - 1, y));\n    }\n    blocks = blocks.filter(block => {\n      return !this._stage.wallHoles.find(hole => hole.equals(block));\n    });\n    blocks.push(...this._stage.blocks);\n\n    return {\n      blocks,\n      speed: 12,\n      applePos: null,\n      snakes: this._stage.snakes.map(snake => ({\n        position: snake.position,\n        length: 4,\n        tiles: [],\n        dir: snake.direction,\n        pendingDirs: [],\n      })),\n      gameOver: false,\n    };\n  }\n\n  private _resetState(): void {\n    this._pendingDuration = 0;\n    this._totalDuration = 0;\n    this._prng = seedrandom(`${this.options.seed}\\0`);\n    this._state = this._createInitialState();\n  }\n\n  private _actionStep(): boolean {\n    const state = this._state;\n\n    if (state.gameOver) {\n      return false;\n    }\n\n    for (let i = 0; i < state.snakes.length; i++) {\n      const snake = state.snakes[i];\n      if (snake.pendingDirs.length > 0) {\n        snake.dir = snake.pendingDirs[0];\n        snake.pendingDirs.splice(0, 1);\n      }\n\n      let direction: Vector;\n      switch (snake.dir) {\n        case EDirection.UP:\n          direction = new Vector(0, 1);\n          break;\n        case EDirection.DOWN:\n          direction = new Vector(0, -1);\n          break;\n        case EDirection.LEFT:\n          direction = new Vector(-1, 0);\n          break;\n        case EDirection.RIGHT:\n          direction = new Vector(1, 0);\n          break;\n        default:\n          return assertNever(snake.dir);\n      }\n\n      const newPosition = snake.position.add(direction);\n\n      // Check collision with other snakes before updating position\n      for (let j = 0; j < state.snakes.length; j++) {\n        if (i !== j) {\n          const otherSnake = state.snakes[j];\n          if (otherSnake.tiles.find(v => v.equals(newPosition))) {\n            state.gameOver = true;\n            return false;\n          }\n        }\n      }\n\n      // Hit the wall?\n      if (state.blocks.find(v => v.equals(newPosition))) {\n        state.gameOver = true;\n        return false;\n      }\n\n      // Hit self?\n      if (snake.tiles.find(v => v.equals(newPosition))) {\n        state.gameOver = true;\n        return false;\n      }\n\n      if (newPosition.x < 0) {\n        newPosition.x = this.options.xTiles - 1;\n      }\n      if (newPosition.y < 0) {\n        newPosition.y = this.options.yTiles - 1;\n      }\n      if (newPosition.x > this.options.xTiles - 1) {\n        newPosition.x = 0;\n      }\n      if (newPosition.y > this.options.yTiles - 1) {\n        newPosition.y = 0;\n      }\n\n      snake.position = newPosition;\n      snake.tiles.push(newPosition);\n\n      // Ate an apple?\n      if (snake.position.equals(state.applePos)) {\n        state.applePos = null;\n        snake.length += 2;\n      }\n\n      while (snake.tiles.length > snake.length) {\n        snake.tiles.splice(0, 1);\n      }\n      // Check collision with other snakes before updating position\n      for (let j = 0; j < state.snakes.length; j++) {\n        if (i !== j) {\n          const otherSnake = state.snakes[j];\n          if (otherSnake.tiles.find(v => v.equals(newPosition))) {\n            state.gameOver = true;\n            return false;\n          }\n        }\n      }\n\n      snake.position = newPosition;\n      snake.tiles.push(newPosition);\n    }\n\n    if (!state.applePos) {\n      this._actionNewApple();\n    }\n\n    return true;\n  }\n\n  private _actionNewApple(): void {\n    let newPos: Vector;\n    while (true) {\n      newPos = new Vector(\n        Math.floor(this._prng() * this.options.xTiles),\n        Math.floor(this._prng() * this.options.yTiles)\n      );\n\n      if (this._state.blocks.find(v => v.equals(newPos))) {\n        continue;\n      }\n\n      if (\n        this._state.snakes.find(\n          snake => !!snake.tiles.find(v => v.equals(newPos))\n        )\n      ) {\n        continue;\n      }\n\n      break;\n    }\n    this._state.applePos = newPos;\n  }\n\n  private _actionNewDir(snakeIdx: number, newDir: EDirection): boolean {\n    const snakeState = this._state.snakes[snakeIdx];\n    if (snakeState.pendingDirs.length >= 2) {\n      return false;\n    }\n\n    let curDir = snakeState.dir;\n    if (snakeState.pendingDirs.length > 0) {\n      curDir = snakeState.pendingDirs[snakeState.pendingDirs.length - 1];\n    }\n\n    if (curDir === newDir || curDir + newDir === 0) {\n      return false;\n    }\n\n    snakeState.pendingDirs.push(newDir);\n    return true;\n  }\n\n  private _actionSpeedChange(speedIncrement: number): boolean {\n    let newSpeed = this._state.speed + speedIncrement;\n    newSpeed = Math.max(1, Math.min(1000, newSpeed));\n    this._state.speed = newSpeed;\n    return true;\n  }\n\n  input(input: GameInput): void {\n    let handled = false;\n    switch (input.inputType) {\n      case 'direction':\n        handled = this._actionNewDir(input.snakeIdx, input.dir);\n        break;\n      case 'speed':\n        handled = this._actionSpeedChange(input.speedIncrement);\n        break;\n      default:\n        assertNever(input);\n    }\n\n    if (this.onInputCallback && handled) {\n      this.onInputCallback({\n        eventTime: this._totalDuration,\n        gameInput: input,\n      });\n    }\n  }\n\n  advanceTime(duration: number): void {\n    this._totalDuration += duration;\n    this._pendingDuration += duration;\n\n    const stepSize = 1000 / this._state.speed;\n    const totalSteps = Math.floor(this._pendingDuration / stepSize);\n    for (let i = 0; i < totalSteps; ++i) {\n      this._actionStep();\n    }\n    this._pendingDuration -= totalSteps * stepSize;\n  }\n}\n", "import { EDirection, GameInput, IGameState } from '../backend/game-logic';\nimport { IActor } from './actor';\n\n/**\n * Human-controlled actor that accepts keyboard input to control\n * a snake in the game. Maps keyboard events to game input commands.\n */\nexport class HumanActor implements IActor {\n  private pendingInput: GameInput | null = null;\n\n  constructor(\n    private snakeIdx: number,\n    private keyMap: {\n      up: string;\n      down: string;\n      left: string;\n      right: string;\n    }\n  ) {}\n\n  /**\n   * Handles keyboard input for the human player's snake.\n   * Stores the input to be returned on next state update.\n   *\n   * @param event Keyboard event from user input\n   */\n  handleKeyInput(event: KeyboardEvent): void {\n    let direction: EDirection | undefined;\n\n    switch (event.key.toLowerCase()) {\n      case this.keyMap.down:\n        direction = EDirection.DOWN;\n        break;\n      case this.keyMap.up:\n        direction = EDirection.UP;\n        break;\n      case this.keyMap.left:\n        direction = EDirection.LEFT;\n        break;\n      case this.keyMap.right:\n        direction = EDirection.RIGHT;\n        break;\n      default:\n        return;\n    }\n\n    this.pendingInput = {\n      inputType: 'direction',\n      dir: direction,\n      snakeIdx: this.snakeIdx,\n    };\n  }\n\n  onStateUpdate(_state: IGameState): GameInput | null {\n    // Return and clear any pending input\n    const input = this.pendingInput;\n    this.pendingInput = null;\n    return input;\n  }\n}\n", "import { EDirection, GameInput, IGameState } from '../backend/game-logic';\nimport { Vector } from '../backend/utils';\nimport { IActor } from './actor';\n\n/**\n * AI-controlled actor that moves the snake toward the apple while avoiding\n * obstacles like walls, its own body, and other snakes.\n */\nexport class AIActor implements IActor {\n  constructor(\n    private snakeIdx: number,\n    private readonly safetyRadius: number = 3\n  ) {}\n\n  private isNearOtherSnake(\n    pos: Vector,\n    state: IGameState,\n    radius: number\n  ): boolean {\n    const otherSnakes = state.snakes.filter((_, idx) => idx !== this.snakeIdx);\n    for (const snake of otherSnakes) {\n      for (const tile of snake.tiles) {\n        const dx = Math.abs(pos.x - tile.x);\n        const dy = Math.abs(pos.y - tile.y);\n        if (dx <= radius && dy <= radius) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  private wouldCollideWithSelf(pos: Vector, state: IGameState): boolean {\n    const currentSnake = state.snakes[this.snakeIdx];\n    const bodyTiles = currentSnake.tiles.slice(1); // Exclude head\n    return bodyTiles.some(tile => tile.x === pos.x && tile.y === pos.y);\n  }\n\n  private isTooCloseToWalls(\n    pos: Vector,\n    state: IGameState,\n    radius: number\n  ): boolean {\n    const boardSize = state.blocks.length - 1; // Assuming square board with walls at edges\n    return (\n      pos.x < radius ||\n      pos.y < radius ||\n      pos.x > boardSize - radius - 1 ||\n      pos.y > boardSize - radius - 1\n    );\n  }\n\n  private isAppleNearWalls(\n    apple: Vector,\n    state: IGameState,\n    radius: number\n  ): boolean {\n    const boardSize = state.blocks.length - 1;\n    return (\n      apple.x < radius ||\n      apple.y < radius ||\n      apple.x > boardSize - radius - 1 ||\n      apple.y > boardSize - radius - 1\n    );\n  }\n\n  onStateUpdate(state: IGameState): GameInput | null {\n    const snake = state.snakes[this.snakeIdx];\n    const apple = state.applePos;\n\n    // If no apple or game is over, do nothing\n    if (!apple || state.gameOver) {\n      return null;\n    }\n\n    // Get all obstacles to avoid (walls, snake bodies)\n    const obstacles = new Set<string>();\n    state.blocks.forEach(block => obstacles.add(`${block.x},${block.y}`));\n    state.snakes.forEach(s => {\n      s.tiles.forEach(tile => obstacles.add(`${tile.x},${tile.y}`));\n    });\n\n    // Calculate direction to apple considering board wrapping\n    const dx = apple.x - snake.position.x;\n    const dy = apple.y - snake.position.y;\n\n    // Possible moves in order of priority based on apple direction\n    const moves: EDirection[] = [];\n\n    // Prioritize horizontal or vertical movement based on distance\n    if (Math.abs(dx) > Math.abs(dy)) {\n      // Prioritize horizontal movement\n      if (dx > 0) moves.push(EDirection.RIGHT);\n      else moves.push(EDirection.LEFT);\n      if (dy > 0) moves.push(EDirection.UP);\n      else moves.push(EDirection.DOWN);\n    } else {\n      // Prioritize vertical movement\n      if (dy > 0) moves.push(EDirection.UP);\n      else moves.push(EDirection.DOWN);\n      if (dx > 0) moves.push(EDirection.RIGHT);\n      else moves.push(EDirection.LEFT);\n    }\n\n    // Check if apple is near walls - if so, we should ignore wall safety to reach it\n    const appleNearWalls = this.isAppleNearWalls(apple, state, 2);\n\n    // Try each move in priority order\n    for (const dir of moves) {\n      const nextPos = this.getNextPosition(snake.position, dir, state);\n\n      // Check if move is safe (no obstacles, not too close to other snakes, and won't hit own body)\n      // Only check wall safety if apple is NOT near walls\n      if (\n        !obstacles.has(`${nextPos.x},${nextPos.y}`) &&\n        !this.isNearOtherSnake(nextPos, state, this.safetyRadius) &&\n        (appleNearWalls || !this.isTooCloseToWalls(nextPos, state, 2)) &&\n        !this.wouldCollideWithSelf(nextPos, state)\n      ) {\n        return {\n          inputType: 'direction',\n          dir,\n          snakeIdx: this.snakeIdx,\n        };\n      }\n    }\n\n    // If no good moves found, try to find any safe move that avoids other snakes\n    const allDirections = [\n      EDirection.UP,\n      EDirection.RIGHT,\n      EDirection.DOWN,\n      EDirection.LEFT,\n    ];\n    for (const dir of allDirections) {\n      const nextPos = this.getNextPosition(snake.position, dir, state);\n      if (\n        !obstacles.has(`${nextPos.x},${nextPos.y}`) &&\n        !this.isNearOtherSnake(nextPos, state, 2) &&\n        (appleNearWalls || !this.isTooCloseToWalls(nextPos, state, 2)) &&\n        !this.wouldCollideWithSelf(nextPos, state)\n      ) {\n        return {\n          inputType: 'direction',\n          dir,\n          snakeIdx: this.snakeIdx,\n        };\n      }\n    }\n\n    // If still no safe moves found, just continue in current direction\n    return null;\n  }\n\n  private getNextPosition(\n    pos: Vector,\n    dir: EDirection,\n    state: IGameState\n  ): Vector {\n    let x = pos.x;\n    let y = pos.y;\n\n    switch (dir) {\n      case EDirection.UP:\n        y += 1;\n        break;\n      case EDirection.DOWN:\n        y -= 1;\n        break;\n      case EDirection.LEFT:\n        x -= 1;\n        break;\n      case EDirection.RIGHT:\n        x += 1;\n        break;\n    }\n\n    // Handle wrapping\n    if (x < 0) x = state.blocks.length - 2;\n    if (y < 0) y = state.blocks.length - 2;\n    if (x > state.blocks.length - 2) x = 0;\n    if (y > state.blocks.length - 2) y = 0;\n\n    return new Vector(x, y);\n  }\n}\n", "import { IGameOptions, IGameState } from './backend/game-logic';\nimport { Vector } from './backend/utils';\n\n/**\n * Defines the visual style for a game tile, supporting both\n * fill and optional stroke colors for various game elements\n * like snakes, apples, and walls.\n */\nexport interface ITileStyle {\n  fillStyle: string;\n  strokeStyle?: string;\n}\n\n/**\n * Handles all visual rendering aspects of the game using the HTML5 Canvas API.\n * Manages responsive sizing of the game board, draws all game elements\n * (snakes, apples, walls), and displays UI elements like the game over screen\n * and playback indicator.\n *\n * Example:\n * ```typescript\n * const renderer = new GameRenderer();\n * renderer.initRenderer(gameOptions);\n * renderer.onCanvasSizeChanged(canvas.width, canvas.height);\n * renderer.render(ctx, gameState, false);\n * ```\n */\nexport class GameRenderer {\n  private _paddingX: number = 0;\n  private _paddingY: number = 0;\n  private _tileWidth: number = 0;\n  private _tileHeight: number = 0;\n  private _boardHeight: number = 0;\n  private _boardWidth: number = 0;\n  private _canvasHeight: number = 0;\n  private _canvasWidth: number = 0;\n  private _gameOptions!: IGameOptions;\n\n  initRenderer(gameOptions: IGameOptions): void {\n    this._gameOptions = gameOptions;\n  }\n\n  onCanvasSizeChanged(w: number, h: number): void {\n    const tileLength = Math.min(\n      w / this._gameOptions.xTiles,\n      h / this._gameOptions.yTiles\n    );\n\n    this._tileWidth = tileLength;\n    this._tileHeight = tileLength;\n    this._boardWidth = this._gameOptions.xTiles * this._tileWidth;\n    this._boardHeight = this._gameOptions.yTiles * this._tileHeight;\n    this._paddingX = (w - this._boardWidth) / 2;\n    this._paddingY = (h - this._boardHeight) / 2;\n    this._canvasWidth = w;\n    this._canvasHeight = h;\n  }\n\n  private _drawTile(\n    ctx: CanvasRenderingContext2D,\n    v: Vector,\n    style: string | ITileStyle\n  ): void {\n    const { fillStyle, strokeStyle } =\n      typeof style === 'string'\n        ? { fillStyle: style, strokeStyle: style }\n        : style;\n\n    ctx.fillStyle = fillStyle;\n    ctx.fillRect(\n      this._paddingX + v.x * this._tileWidth,\n      this._paddingY +\n        this._boardHeight -\n        v.y * this._tileHeight -\n        this._tileHeight,\n      this._tileWidth,\n      this._tileHeight\n    );\n\n    if (strokeStyle) {\n      ctx.strokeStyle = strokeStyle;\n      ctx.strokeRect(\n        this._paddingX + v.x * this._tileWidth,\n        this._paddingY +\n          this._boardHeight -\n          v.y * this._tileHeight -\n          this._tileHeight,\n        this._tileWidth,\n        this._tileHeight\n      );\n    }\n  }\n\n  render(\n    ctx: CanvasRenderingContext2D,\n    gameState: IGameState,\n    playbackMode: boolean\n  ): void {\n    // Draw background\n    ctx.fillStyle = 'green';\n    ctx.fillRect(\n      this._paddingX,\n      this._paddingY,\n      this._boardWidth,\n      this._boardHeight\n    );\n\n    // Draw blocks\n    gameState.blocks.forEach(block => {\n      this._drawTile(ctx, block, 'black');\n    });\n\n    // Draw apple\n    if (gameState.applePos) {\n      this._drawTile(ctx, gameState.applePos, 'red');\n    }\n\n    // Draw snakes\n    const snakeColors = [\n      '#4040FF',\n      '#FF4040',\n      '#40FF40',\n      '#FFFF40',\n      '#FF40FF',\n      '#40FFFF',\n    ];\n    const darkenedSnakeColors = snakeColors.map(color => {\n      const num = parseInt(color.slice(1), 16);\n      const r = Math.max((num >> 16) - 40, 0);\n      const g = Math.max(((num >> 8) & 0x00ff) - 40, 0);\n      const b = Math.max((num & 0x0000ff) - 40, 0);\n      return `#${((r << 16) | (g << 8) | b).toString(16).padStart(6, '0')}`;\n    });\n\n    gameState.snakes.forEach((snake, index) => {\n      const bodyColor = snakeColors[index % snakeColors.length];\n      const headColor = darkenedSnakeColors[index % darkenedSnakeColors.length];\n      snake.tiles.forEach(tile => {\n        this._drawTile(ctx, tile, bodyColor);\n      });\n      this._drawTile(ctx, snake.position, headColor);\n    });\n\n    // Draw playback indicator\n    if (playbackMode) {\n      ctx.beginPath();\n      ctx.moveTo(10, 10);\n      ctx.lineTo(10, 60);\n      ctx.lineTo(60, 35);\n      ctx.closePath();\n      ctx.fillStyle = '#50FF50';\n      ctx.fill();\n    }\n\n    // Draw game over\n    if (gameState.gameOver) {\n      const fontSize = this._boardHeight / 10;\n      ctx.font = `Bold ${fontSize}px Georgia`;\n      const text = 'Game Over!';\n      const measurement = ctx.measureText(text);\n      const x = (this._canvasWidth - measurement.width) / 2;\n      const y = this._canvasHeight / 2 + fontSize / 4;\n\n      ctx.fillStyle = 'black';\n      ctx.fillText(text, x, y);\n      ctx.strokeStyle = 'white';\n      ctx.strokeText(text, x, y);\n    }\n  }\n}\n", "/**\n * Player configuration interface for welcome screen menu\n */\nexport interface PlayerConfiguration {\n  humanPlayers: number;\n  aiPlayers: number;\n}\n\n/**\n * Welcome screen menu items\n */\nexport enum WelcomeMenuItem {\n  HUMAN_PLAYERS = 0,\n  AI_PLAYERS = 1,\n  START = 2,\n}\n\n/**\n * Callback interface for welcome screen completion\n */\nexport interface WelcomeScreenCallbacks {\n  onStartGame: (config: PlayerConfiguration) => void;\n}\n\n/**\n * Handles rendering and input for the welcome screen using HTML5 Canvas API.\n * Displays the game title, instructions, and interactive player selection menu\n * with responsive sizing that adapts to different screen dimensions.\n * Manages its own state and input handling.\n */\nexport class WelcomeRenderer {\n  private _canvasWidth: number = 0;\n  private _canvasHeight: number = 0;\n  private _playerConfig: PlayerConfiguration = {\n    humanPlayers: 1,\n    aiPlayers: 2,\n  };\n  private _selectedMenuItem: WelcomeMenuItem = WelcomeMenuItem.HUMAN_PLAYERS;\n\n  /**\n   * Updates the renderer's understanding of canvas dimensions.\n   * Should be called whenever the canvas size changes.\n   */\n  onCanvasSizeChanged(width: number, height: number): void {\n    this._canvasWidth = width;\n    this._canvasHeight = height;\n  }\n\n  /**\n   * Handles keyboard input for the welcome screen.\n   * @param event Keyboard event\n   * @param callbacks Callback functions for screen completion\n   */\n  handleKeyInput(\n    event: KeyboardEvent,\n    callbacks: WelcomeScreenCallbacks\n  ): void {\n    const key = event.key.toLowerCase();\n\n    switch (key) {\n      case 'arrowup':\n        this._selectedMenuItem = Math.max(0, this._selectedMenuItem - 1);\n        break;\n      case 'arrowdown':\n        this._selectedMenuItem = Math.min(\n          WelcomeMenuItem.START,\n          this._selectedMenuItem + 1\n        );\n        break;\n      case 'arrowleft':\n        this._adjustPlayerCount(-1);\n        break;\n      case 'arrowright':\n        this._adjustPlayerCount(1);\n        break;\n      case 'enter':\n        if (this._selectedMenuItem === WelcomeMenuItem.START) {\n          this._startGame(callbacks);\n        }\n        break;\n    }\n  }\n\n  /**\n   * Handles mouse click input for the welcome screen.\n   * @param event Mouse event\n   * @param callbacks Callback functions for screen completion\n   */\n  handleClickInput(\n    _event: MouseEvent,\n    callbacks: WelcomeScreenCallbacks\n  ): void {\n    // For now, clicking just starts the game if we're on the start option\n    if (this._selectedMenuItem === WelcomeMenuItem.START) {\n      this._startGame(callbacks);\n    }\n  }\n\n  private _adjustPlayerCount(delta: number): void {\n    if (this._selectedMenuItem === WelcomeMenuItem.HUMAN_PLAYERS) {\n      this._playerConfig.humanPlayers = Math.max(\n        0,\n        Math.min(2, this._playerConfig.humanPlayers + delta)\n      );\n    } else if (this._selectedMenuItem === WelcomeMenuItem.AI_PLAYERS) {\n      this._playerConfig.aiPlayers = Math.max(\n        0,\n        Math.min(6, this._playerConfig.aiPlayers + delta)\n      );\n    }\n  }\n\n  private _startGame(callbacks: WelcomeScreenCallbacks): void {\n    // Validate that at least one player is selected\n    if (this._playerConfig.humanPlayers + this._playerConfig.aiPlayers === 0) {\n      return; // Don't start game if no players selected\n    }\n\n    callbacks.onStartGame(this._playerConfig);\n  }\n\n  /**\n   * Renders the welcome screen to the provided canvas context.\n   * Displays title, player selection menu, and navigation instructions.\n   */\n  render(ctx: CanvasRenderingContext2D): void {\n    // Use canvas dimensions if our stored dimensions are zero\n    const canvasWidth = this._canvasWidth || ctx.canvas.width;\n    const canvasHeight = this._canvasHeight || ctx.canvas.height;\n\n    // Draw background\n    ctx.fillStyle = '#2c3e50';\n    ctx.fillRect(0, 0, canvasWidth, canvasHeight);\n\n    // Calculate responsive font sizes\n    const titleFontSize = Math.min(canvasWidth, canvasHeight) / 10;\n    const subtitleFontSize = Math.min(canvasWidth, canvasHeight) / 20;\n    const menuFontSize = Math.min(canvasWidth, canvasHeight) / 25;\n\n    // Set text properties\n    ctx.textAlign = 'center';\n    ctx.textBaseline = 'middle';\n\n    // Draw title\n    ctx.font = `Bold ${titleFontSize}px Arial`;\n    ctx.fillStyle = '#ecf0f1';\n    ctx.fillText('MinuteSnake', canvasWidth / 2, canvasHeight / 6);\n\n    // Draw subtitle\n    ctx.font = `${subtitleFontSize}px Arial`;\n    ctx.fillStyle = '#95a5a6';\n    ctx.fillText(\n      'Configure Players',\n      canvasWidth / 2,\n      canvasHeight / 6 + titleFontSize * 0.8\n    );\n\n    // Menu setup\n    const menuStartY = canvasHeight * 0.4;\n    const menuItemHeight = menuFontSize * 2;\n    ctx.font = `${menuFontSize}px Arial`;\n\n    // Menu items\n    const menuItems = [\n      {\n        text: `Human players: ${this._playerConfig.humanPlayers}`,\n        menuItem: WelcomeMenuItem.HUMAN_PLAYERS,\n      },\n      {\n        text: `AI players: ${this._playerConfig.aiPlayers}`,\n        menuItem: WelcomeMenuItem.AI_PLAYERS,\n      },\n      { text: 'Start', menuItem: WelcomeMenuItem.START },\n    ];\n\n    // Draw menu items\n    menuItems.forEach((item, index) => {\n      const y = menuStartY + index * menuItemHeight;\n      const isSelected = this._selectedMenuItem === item.menuItem;\n\n      // Draw selection indicator\n      if (isSelected) {\n        ctx.fillStyle = '#3498db';\n        ctx.fillRect(\n          canvasWidth / 2 - 200,\n          y - menuFontSize * 0.7,\n          400,\n          menuFontSize * 1.4\n        );\n      }\n\n      // Draw menu item text\n      ctx.fillStyle = isSelected ? '#ffffff' : '#ecf0f1';\n      ctx.fillText(item.text, canvasWidth / 2, y);\n\n      // Draw arrows for player count items\n      if (\n        item.menuItem === WelcomeMenuItem.HUMAN_PLAYERS ||\n        item.menuItem === WelcomeMenuItem.AI_PLAYERS\n      ) {\n        ctx.fillStyle = isSelected ? '#ffffff' : '#95a5a6';\n\n        // Calculate text width and position arrows outside the text\n        const textWidth = ctx.measureText(item.text).width;\n        const arrowMargin = menuFontSize * 0.8; // Space between text and arrows\n        const leftArrowX = canvasWidth / 2 - textWidth / 2 - arrowMargin;\n        const rightArrowX = canvasWidth / 2 + textWidth / 2 + arrowMargin;\n\n        ctx.fillText('\u25C0', leftArrowX, y);\n        ctx.fillText('\u25B6', rightArrowX, y);\n      }\n    });\n\n    // Draw instructions\n    const instructionY =\n      menuStartY + menuItems.length * menuItemHeight + menuFontSize * 2;\n    const instructionFontSize = Math.min(canvasWidth, canvasHeight) / 35;\n    ctx.font = `${instructionFontSize}px Arial`;\n    ctx.fillStyle = '#bdc3c7';\n\n    const instructions = [\n      '\u2191\u2193 Navigate menu \u2022 \u25C0\u25B6 Adjust players \u2022 ENTER Start game',\n      '',\n      'Game Controls: Arrow keys (Player 1) \u2022 WASD (Player 2)',\n      'P: Playback \u2022 N: New game \u2022 ESC: Menu \u2022 +/-: Speed',\n    ];\n\n    instructions.forEach((instruction, index) => {\n      const y = instructionY + index * instructionFontSize * 1.5;\n      ctx.fillText(instruction, canvasWidth / 2, y);\n    });\n\n    // Draw total players validation\n    const totalPlayers =\n      this._playerConfig.humanPlayers + this._playerConfig.aiPlayers;\n    if (totalPlayers === 0) {\n      ctx.font = `Bold ${menuFontSize * 0.8}px Arial`;\n      ctx.fillStyle = '#e74c3c';\n      ctx.fillText(\n        '\u26A0 Select at least one player to start',\n        canvasWidth / 2,\n        instructionY - menuFontSize\n      );\n    }\n  }\n}\n", "import {\n  GameLogic,\n  IGameStage,\n  IGameEventInput,\n  IGameState,\n  GameInput,\n} from './game-logic';\n\n/**\n * Abstract base class defining the core game state management interface.\n * Provides the foundation for both live gameplay and replay functionality\n * through the LiveHandler and PlaybackHandler implementations.\n */\n\nexport abstract class GameHandlerBase {\n  /**\n   * Gets the current game stage containing level configuration and settings\n   * @returns {IGameStage} The current game stage\n   */\n  abstract get gameStage(): IGameStage;\n\n  /**\n   * Gets the current state of the game including player position, score, etc.\n   * @returns {IGameState} The current game state\n   */\n  abstract get state(): IGameState;\n\n  /**\n   * Gets the list of recorded game inputs for replay functionality\n   * @returns {IGameEventInput[]} Array of saved game inputs with timestamps\n   */\n  abstract get savedInputs(): IGameEventInput[];\n\n  /**\n   * Indicates if the current game session is complete\n   * @returns {boolean} True if game is finished, false otherwise\n   */\n  abstract get isDone(): boolean;\n\n  /**\n   * Advances the game time by the specified duration\n   * @param {number} duration - The time in milliseconds to advance\n   */\n  abstract advanceTime(duration: number): void;\n\n  /**\n   * Processes a game input event like player movement\n   * @param {GameInput} input - The input event to process\n   */\n  abstract performInput(input: GameInput): void;\n}\n\n/**\n * Handles replay functionality by playing back recorded game inputs.\n * Processes saved inputs in sequence to recreate previous gameplay,\n * ignoring new player inputs during playback.\n *\n * Example: Activated when player presses 'P' to review previous gameplay\n */\nexport class PlaybackHandler extends GameHandlerBase {\n  private _gameLogic: GameLogic;\n  private _inputIndex: number;\n\n  get gameStage(): IGameStage {\n    return this._gameStage;\n  }\n\n  constructor(\n    private _gameStage: IGameStage,\n    public savedInputs: IGameEventInput[]\n  ) {\n    super();\n\n    this._gameLogic = new GameLogic(this._gameStage);\n    this._inputIndex = 0;\n  }\n\n  get isDone(): boolean {\n    return this._inputIndex >= this.savedInputs.length;\n  }\n\n  advanceTime(duration: number): void {\n    if (this._inputIndex >= this.savedInputs.length) {\n      return;\n    }\n\n    while (duration > 0) {\n      let newPlayedDuration = this._gameLogic.totalDuration + duration;\n      const nextInput = this.savedInputs[this._inputIndex];\n\n      if (newPlayedDuration >= nextInput.eventTime) {\n        newPlayedDuration = nextInput.eventTime;\n      }\n\n      this._gameLogic.advanceTime(\n        newPlayedDuration - this._gameLogic.totalDuration\n      );\n\n      if (this._gameLogic.totalDuration >= nextInput.eventTime) {\n        this._gameLogic.input(nextInput.gameInput);\n        ++this._inputIndex;\n      }\n\n      duration = newPlayedDuration - this._gameLogic.totalDuration;\n    }\n  }\n\n  get state(): IGameState {\n    return this._gameLogic.state;\n  }\n\n  performInput(_input: GameInput): void {\n    // Ignore inputs in playback mode\n  }\n}\n\n/**\n * Manages live gameplay state and input handling.\n * Maintains a record of player inputs for replay functionality\n * while delegating game logic to the GameLogic class.\n *\n * Example: Used during active gameplay to process player movements\n * and track game state changes.\n */\nexport class LiveHandler extends GameHandlerBase {\n  private _gameLogic: GameLogic;\n  savedInputs: IGameEventInput[];\n\n  get gameStage(): IGameStage {\n    return this._gameStage;\n  }\n\n  constructor(\n    private _gameStage: IGameStage,\n    savedInputs?: IGameEventInput[]\n  ) {\n    super();\n\n    this.savedInputs = savedInputs || [];\n    this._gameLogic = new GameLogic(this._gameStage);\n\n    if (this.savedInputs.length > 0) {\n      for (const savedInput of this.savedInputs) {\n        this._gameLogic.advanceTime(\n          savedInput.eventTime - this._gameLogic.totalDuration\n        );\n        this._gameLogic.input(savedInput.gameInput);\n      }\n    }\n\n    this._gameLogic.onInputCallback = (e: IGameEventInput): void =>\n      this._onGameInput(e);\n  }\n\n  advanceTime(duration: number): void {\n    this._gameLogic.advanceTime(duration);\n  }\n\n  get isDone(): boolean {\n    return false;\n  }\n\n  get state(): IGameState {\n    return this._gameLogic.state;\n  }\n\n  private _onGameInput(e: IGameEventInput): void {\n    this.savedInputs.push(e);\n  }\n\n  performInput(input: GameInput): void {\n    this._gameLogic.input(input);\n  }\n}\n", "import { EDirection, GameInput, IGameStage } from './backend/game-logic';\nimport { IActor, HumanActor, AIActor } from './actors/index';\nimport { GameRenderer } from './game-renderer';\nimport { GameState } from './game-state';\nimport {\n  WelcomeRenderer,\n  WelcomeScreenCallbacks,\n  PlayerConfiguration,\n} from './welcome-renderer';\n\nconst MAX_INPUT_ITERATIONS = 10;\nimport {\n  GameHandlerBase,\n  LiveHandler,\n  PlaybackHandler,\n} from './backend/state-handlers';\nimport { Vector } from './backend/utils';\n\n/**\n * Core game engine that coordinates rendering, input handling, and game state.\n * Manages switching between live and playback modes, handles window/canvas\n * setup, and maintains the game loop. Works with GameRenderer for visual output\n * and interfaces with GameHandlerBase implementations for game state management.\n *\n * Example: The main engine instance created by GameApp that runs the entire game\n */\nexport class GameEngine {\n  private _gameRenderer!: GameRenderer; // Will be initialized in start()\n  private _welcomeRenderer!: WelcomeRenderer; // Will be initialized in start()\n  private _handler!: GameHandlerBase; // Will be initialized in start()\n  private _lastEngineTime!: number; // Will be initialized in start()\n  private _isPlaybackMode = false;\n  private _actors: IActor[] = [];\n  private _currentState: GameState = GameState.WELCOME;\n  private _welcomeCallbacks: WelcomeScreenCallbacks;\n\n  constructor(\n    private window: Window,\n    private canvas: HTMLCanvasElement,\n    private ctx: CanvasRenderingContext2D\n  ) {\n    this._welcomeCallbacks = {\n      onStartGame: (config: PlayerConfiguration): void =>\n        this._startGame(config),\n    };\n  }\n\n  start(): void {\n    this._gameRenderer = new GameRenderer();\n    this._welcomeRenderer = new WelcomeRenderer();\n    this._initListeners();\n    this._updateCanvasDimensions();\n    this._timeout();\n  }\n\n  private _initListeners(): void {\n    this.window.addEventListener('resize', () =>\n      this._updateCanvasDimensions()\n    );\n    this.window.addEventListener('keydown', e => this._onKeyDown(e));\n    this.canvas.addEventListener('click', e => this._onCanvasClick(e));\n  }\n\n  private _onKeyDown(event: KeyboardEvent): void {\n    if (event.defaultPrevented) {\n      return;\n    }\n\n    // Handle welcome screen input\n    if (this._currentState === GameState.WELCOME) {\n      this._welcomeRenderer.handleKeyInput(event, this._welcomeCallbacks);\n      event.preventDefault();\n      return;\n    }\n\n    // Handle game over screen input\n    if (this._currentState === GameState.GAME_OVER) {\n      if (\n        event.key.toLowerCase() === 'enter' ||\n        event.key.toLowerCase() === 'n'\n      ) {\n        this._showWelcomeScreen();\n      } else if (event.key.toLowerCase() === 'escape') {\n        this._showWelcomeScreen();\n      }\n      event.preventDefault();\n      return;\n    }\n\n    // Handle playing state input\n    if (this._currentState === GameState.PLAYING) {\n      if (event.key.toLowerCase() === 'p') {\n        if (!this._isPlaybackMode) {\n          this._enterPlaybackMode();\n        } else {\n          this._resumeLiveMode();\n        }\n      } else if (event.key.toLowerCase() === 'n') {\n        this._restartLiveMode();\n      } else if (event.key.toLowerCase() === 'escape') {\n        this._showWelcomeScreen();\n      } else if (event.key === '+') {\n        this._performInput({\n          inputType: 'speed',\n          speedIncrement: 1,\n        });\n      } else if (event.key === '-') {\n        this._performInput({\n          inputType: 'speed',\n          speedIncrement: -1,\n        });\n      } else {\n        // Route key input to the actors\n        for (const actor of this._actors) {\n          if (actor instanceof HumanActor) {\n            actor.handleKeyInput(event);\n          }\n        }\n      }\n    }\n\n    event.preventDefault();\n  }\n\n  private _onCanvasClick(event: MouseEvent): void {\n    if (event.defaultPrevented) {\n      return;\n    }\n\n    // Handle welcome screen click\n    if (this._currentState === GameState.WELCOME) {\n      this._welcomeRenderer.handleClickInput(event, this._welcomeCallbacks);\n    }\n\n    // Handle game over screen click\n    if (this._currentState === GameState.GAME_OVER) {\n      this._showWelcomeScreen();\n    }\n\n    event.preventDefault();\n  }\n\n  private _updateCanvasDimensions(): void {\n    this.canvas.height = this.window.innerHeight;\n    this.canvas.width = this.window.innerWidth;\n\n    // Only update game renderer if we're in playing state and have initialized it\n    if (this._currentState === GameState.PLAYING && this._handler) {\n      this._gameRenderer.onCanvasSizeChanged(\n        this.canvas.width,\n        this.canvas.height\n      );\n    }\n\n    this._welcomeRenderer.onCanvasSizeChanged(\n      this.canvas.width,\n      this.canvas.height\n    );\n    this._draw();\n  }\n\n  private _timeout(): void {\n    this._update();\n    this._draw();\n    requestAnimationFrame(() => this._timeout());\n  }\n\n  private _update(): void {\n    // Only update game logic when in playing state\n    if (this._currentState === GameState.PLAYING) {\n      this._advanceTimeToNow();\n\n      // Let actors respond to state changes\n      let hasInput = false;\n      let iterations = 0;\n      do {\n        for (const actor of this._actors) {\n          const input = actor.onStateUpdate(this._handler.state);\n          if (input) {\n            this._performInput(input);\n            hasInput = true;\n          }\n        }\n        iterations++;\n      } while (hasInput && iterations < MAX_INPUT_ITERATIONS);\n    }\n  }\n\n  private _performInput(input: GameInput): void {\n    this._advanceTimeToNow();\n    this._handler.performInput(input);\n  }\n\n  private _advanceTimeToNow(): void {\n    const now = performance.now();\n    const duration = now - this._lastEngineTime;\n    this._handler.advanceTime(duration);\n    this._lastEngineTime = now;\n\n    if (this._isPlaybackMode && this._handler.isDone) {\n      this._resumeLiveMode();\n    }\n  }\n\n  private _restartLiveMode(playerConfig?: PlayerConfiguration): void {\n    const x = 60,\n      y = 40;\n\n    // Create snakes based on the number of players\n    const totalPlayers = playerConfig\n      ? playerConfig.humanPlayers + playerConfig.aiPlayers\n      : this._actors.length;\n    const snakes = this._generateSnakeStartPositions(totalPlayers, x, y);\n\n    const gameStage: IGameStage = {\n      xTiles: x,\n      yTiles: y,\n      seed: Date.now(),\n      wallHoles: [\n        new Vector(0, y / 2),\n        new Vector(0, y / 2 + 1),\n        new Vector(x - 1, y / 2),\n        new Vector(x - 1, y / 2 + 1),\n      ],\n      blocks: [\n        new Vector(x / 2, y / 2),\n        new Vector(x / 2 - 1, y / 2 - 1),\n        new Vector(x / 2, y / 2 - 1),\n        new Vector(x / 2 - 1, y / 2),\n      ],\n      snakes: snakes,\n    };\n\n    this._isPlaybackMode = false;\n    this._handler = new LiveHandler(gameStage);\n    this._lastEngineTime = performance.now();\n    this._gameRenderer.initRenderer(this._handler.gameStage);\n  }\n\n  private _generateSnakeStartPositions(\n    numPlayers: number,\n    boardWidth: number,\n    boardHeight: number\n  ): Array<{ position: Vector; direction: EDirection }> {\n    const snakes = [];\n    const margin = 4;\n\n    // Define starting positions for up to 6 players (2 human + 4 AI max)\n    const startPositions = [\n      { position: new Vector(margin, margin), direction: EDirection.RIGHT },\n      {\n        position: new Vector(boardWidth - margin, boardHeight - margin),\n        direction: EDirection.LEFT,\n      },\n      {\n        position: new Vector(boardWidth - margin, margin),\n        direction: EDirection.DOWN,\n      },\n      {\n        position: new Vector(margin, boardHeight - margin),\n        direction: EDirection.UP,\n      },\n      {\n        position: new Vector(boardWidth / 2, margin),\n        direction: EDirection.DOWN,\n      },\n      {\n        position: new Vector(boardWidth / 2, boardHeight - margin),\n        direction: EDirection.UP,\n      },\n    ];\n\n    // Take only the number of positions we need\n    for (let i = 0; i < Math.min(numPlayers, startPositions.length); i++) {\n      snakes.push(startPositions[i]);\n    }\n\n    return snakes;\n  }\n\n  private _resumeLiveMode(): void {\n    this._isPlaybackMode = false;\n    this._handler = new LiveHandler(\n      this._handler.gameStage,\n      this._handler.savedInputs\n    );\n  }\n\n  private _enterPlaybackMode(): void {\n    this._isPlaybackMode = true;\n    this._handler = new PlaybackHandler(\n      this._handler.gameStage,\n      this._handler.savedInputs\n    );\n    this._lastEngineTime = performance.now();\n  }\n\n  private _draw(): void {\n    this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\n\n    if (this._currentState === GameState.WELCOME) {\n      this._welcomeRenderer.render(this.ctx);\n    } else if (\n      this._currentState === GameState.PLAYING ||\n      this._currentState === GameState.GAME_OVER\n    ) {\n      this._gameRenderer.render(\n        this.ctx,\n        this._handler.state,\n        this._isPlaybackMode\n      );\n    }\n  }\n\n  /**\n   * Add an actor to the game. Actors will receive state updates\n   * and can provide inputs to control game entities.\n   * @param actor The actor to add\n   */\n  addActor(actor: IActor): void {\n    this._actors.push(actor);\n  }\n\n  /**\n   * Transitions from welcome screen to active gameplay.\n   * Initializes the game state and begins the game loop.\n   */\n  private _startGame(playerConfig: PlayerConfiguration): void {\n    this._currentState = GameState.PLAYING;\n\n    // Create actors based on configuration\n    this._actors = [];\n    let snakeIndex = 0;\n\n    // Add human players\n    for (let i = 0; i < playerConfig.humanPlayers; i++) {\n      const keyMap = this._getKeyMapForPlayer(i);\n      this._actors.push(new HumanActor(snakeIndex, keyMap));\n      snakeIndex++;\n    }\n\n    // Add AI players\n    for (let i = 0; i < playerConfig.aiPlayers; i++) {\n      this._actors.push(new AIActor(snakeIndex));\n      snakeIndex++;\n    }\n\n    this._restartLiveMode(playerConfig);\n\n    // Update canvas dimensions for game renderer now that we have game options\n    this._gameRenderer.onCanvasSizeChanged(\n      this.canvas.width,\n      this.canvas.height\n    );\n  }\n\n  private _getKeyMapForPlayer(playerIndex: number): {\n    up: string;\n    down: string;\n    left: string;\n    right: string;\n  } {\n    if (playerIndex === 0) {\n      return {\n        up: 'arrowup',\n        down: 'arrowdown',\n        left: 'arrowleft',\n        right: 'arrowright',\n      };\n    } else {\n      // Second player uses WASD keys\n      return {\n        up: 'w',\n        down: 's',\n        left: 'a',\n        right: 'd',\n      };\n    }\n  }\n\n  /**\n   * Returns to the welcome screen from any other state.\n   * Resets the game state and clears actors.\n   */\n  private _showWelcomeScreen(): void {\n    this._currentState = GameState.WELCOME;\n    this._actors = [];\n    this._isPlaybackMode = false;\n  }\n\n  /**\n   * Transitions to game over state.\n   * This can be called when the game ends.\n   */\n  private _showGameOver(): void {\n    this._currentState = GameState.GAME_OVER;\n  }\n\n  /**\n   * Gets the current game state.\n   * @returns The current GameState\n   */\n  get currentState(): GameState {\n    return this._currentState;\n  }\n}\n", "import { GameEngine } from './game-engine';\n\n/**\n * Main application entry point that bootstraps the game.\n * Handles canvas initialization and creates the GameEngine instance\n * when the DOM content is loaded. Serves as the primary coordinator\n * between the browser environment and the game engine.\n *\n * Example: The game starts when `new GameApp()` is called, triggering\n * canvas setup and game engine initialization\n */\nclass GameApp {\n  private gameEngine: GameEngine | null = null;\n\n  constructor() {\n    window.addEventListener('DOMContentLoaded', () => this.initialize());\n  }\n\n  private initialize(): void {\n    const canvas = document.querySelector<HTMLCanvasElement>('#canvas');\n\n    if (!canvas) {\n      console.error('Canvas element not found');\n      return;\n    }\n\n    const context = canvas.getContext('2d');\n\n    if (!context) {\n      console.error('Could not get 2D context');\n      return;\n    }\n\n    this.gameEngine = new GameEngine(window, canvas, context);\n    this.gameEngine.start();\n  }\n}\n\n// Initialize the game\nnew GameApp();\n"],
  "mappings": "gqBAAA,IAAAA,GAAAC,EAAA,CAAAC,GAAAC,IAAA,EA2BC,SAASC,EAAQD,EAAQE,EAAQ,CAElC,SAASC,EAAKC,EAAM,CAClB,IAAIC,EAAK,KAAMC,EAAOC,EAAK,EAE3BF,EAAG,KAAO,UAAW,CACnB,IAAIG,EAAI,QAAUH,EAAG,GAAKA,EAAG,EAAI,sBACjC,OAAAA,EAAG,GAAKA,EAAG,GACXA,EAAG,GAAKA,EAAG,GACJA,EAAG,GAAKG,GAAKH,EAAG,EAAIG,EAAI,EACjC,EAGAH,EAAG,EAAI,EACPA,EAAG,GAAKC,EAAK,GAAG,EAChBD,EAAG,GAAKC,EAAK,GAAG,EAChBD,EAAG,GAAKC,EAAK,GAAG,EAChBD,EAAG,IAAMC,EAAKF,CAAI,EACdC,EAAG,GAAK,IAAKA,EAAG,IAAM,GAC1BA,EAAG,IAAMC,EAAKF,CAAI,EACdC,EAAG,GAAK,IAAKA,EAAG,IAAM,GAC1BA,EAAG,IAAMC,EAAKF,CAAI,EACdC,EAAG,GAAK,IAAKA,EAAG,IAAM,GAC1BC,EAAO,IACT,CAEA,SAASG,EAAKC,EAAGF,EAAG,CAClB,OAAAA,EAAE,EAAIE,EAAE,EACRF,EAAE,GAAKE,EAAE,GACTF,EAAE,GAAKE,EAAE,GACTF,EAAE,GAAKE,EAAE,GACFF,CACT,CAEA,SAASG,EAAKP,EAAMQ,EAAM,CACxB,IAAIC,EAAK,IAAIV,EAAKC,CAAI,EAClBU,EAAQF,GAAQA,EAAK,MACrBG,EAAOF,EAAG,KACd,OAAAE,EAAK,MAAQ,UAAW,CAAE,OAAQF,EAAG,KAAK,EAAI,WAAe,CAAG,EAChEE,EAAK,OAAS,UAAW,CACvB,OAAOA,EAAK,GAAKA,EAAK,EAAI,QAAW,GAAK,qBAC5C,EACAA,EAAK,MAAQA,EACTD,IACE,OAAOA,GAAU,UAAUL,EAAKK,EAAOD,CAAE,EAC7CE,EAAK,MAAQ,UAAW,CAAE,OAAON,EAAKI,EAAI,CAAC,CAAC,CAAG,GAE1CE,CACT,CAEA,SAASR,GAAO,CACd,IAAI,EAAI,WAEJD,EAAO,SAASU,EAAM,CACxBA,EAAO,OAAOA,CAAI,EAClB,QAASC,EAAI,EAAGA,EAAID,EAAK,OAAQC,IAAK,CACpC,GAAKD,EAAK,WAAWC,CAAC,EACtB,IAAIC,EAAI,mBAAsB,EAC9B,EAAIA,IAAM,EACVA,GAAK,EACLA,GAAK,EACL,EAAIA,IAAM,EACVA,GAAK,EACL,GAAKA,EAAI,UACX,CACA,OAAQ,IAAM,GAAK,qBACrB,EAEA,OAAOZ,CACT,CAGIN,GAAUA,EAAO,QACnBA,EAAO,QAAUW,EACRT,GAAUA,EAAO,IAC1BA,EAAO,UAAW,CAAE,OAAOS,CAAM,CAAC,EAElC,KAAK,KAAOA,CAGd,GACEZ,GACC,OAAOC,GAAW,UAAYA,EAC9B,OAAO,QAAW,YAAc,MACnC,IC/GA,IAAAmB,GAAAC,EAAA,CAAAC,GAAAC,IAAA,EAGC,SAASC,EAAQD,EAAQE,EAAQ,CAElC,SAASC,EAAOC,EAAM,CACpB,IAAIC,EAAK,KAAMC,EAAU,GAEzBD,EAAG,EAAI,EACPA,EAAG,EAAI,EACPA,EAAG,EAAI,EACPA,EAAG,EAAI,EAGPA,EAAG,KAAO,UAAW,CACnB,IAAIE,EAAIF,EAAG,EAAKA,EAAG,GAAK,GACxB,OAAAA,EAAG,EAAIA,EAAG,EACVA,EAAG,EAAIA,EAAG,EACVA,EAAG,EAAIA,EAAG,EACHA,EAAG,GAAMA,EAAG,IAAM,GAAME,EAAKA,IAAM,CAC5C,EAEIH,KAAUA,EAAO,GAEnBC,EAAG,EAAID,EAGPE,GAAWF,EAIb,QAASI,EAAI,EAAGA,EAAIF,EAAQ,OAAS,GAAIE,IACvCH,EAAG,GAAKC,EAAQ,WAAWE,CAAC,EAAI,EAChCH,EAAG,KAAK,CAEZ,CAEA,SAASI,EAAKC,EAAGH,EAAG,CAClB,OAAAA,EAAE,EAAIG,EAAE,EACRH,EAAE,EAAIG,EAAE,EACRH,EAAE,EAAIG,EAAE,EACRH,EAAE,EAAIG,EAAE,EACDH,CACT,CAEA,SAASI,EAAKP,EAAMQ,EAAM,CACxB,IAAIC,EAAK,IAAIV,EAAOC,CAAI,EACpBU,EAAQF,GAAQA,EAAK,MACrBG,EAAO,UAAW,CAAE,OAAQF,EAAG,KAAK,IAAM,GAAK,UAAa,EAChE,OAAAE,EAAK,OAAS,UAAW,CACvB,EACE,KAAIC,EAAMH,EAAG,KAAK,IAAM,GACpBI,GAAOJ,EAAG,KAAK,IAAM,GAAK,WAC1BK,GAAUF,EAAMC,IAAQ,GAAK,UAC1BC,IAAW,GACpB,OAAOA,CACT,EACAH,EAAK,MAAQF,EAAG,KAChBE,EAAK,MAAQA,EACTD,IACE,OAAOA,GAAU,UAAUL,EAAKK,EAAOD,CAAE,EAC7CE,EAAK,MAAQ,UAAW,CAAE,OAAON,EAAKI,EAAI,CAAC,CAAC,CAAG,GAE1CE,CACT,CAEIf,GAAUA,EAAO,QACnBA,EAAO,QAAUW,EACRT,GAAUA,EAAO,IAC1BA,EAAO,UAAW,CAAE,OAAOS,CAAM,CAAC,EAElC,KAAK,OAASA,CAGhB,GACEZ,GACC,OAAOC,GAAW,UAAYA,EAC9B,OAAO,QAAW,YAAc,MACnC,IC9EA,IAAAmB,GAAAC,EAAA,CAAAC,GAAAC,IAAA,EAGC,SAASC,EAAQD,EAAQE,EAAQ,CAElC,SAASC,EAAOC,EAAM,CACpB,IAAIC,EAAK,KAAMC,EAAU,GAGzBD,EAAG,KAAO,UAAW,CACnB,IAAIE,EAAKF,EAAG,EAAKA,EAAG,IAAM,EAC1B,OAAAA,EAAG,EAAIA,EAAG,EAAGA,EAAG,EAAIA,EAAG,EAAGA,EAAG,EAAIA,EAAG,EAAGA,EAAG,EAAIA,EAAG,GACzCA,EAAG,EAAKA,EAAG,EAAI,OAAS,IAC5BA,EAAG,EAAKA,EAAG,EAAKA,EAAG,GAAK,GAAOE,EAAKA,GAAK,IAAO,CACtD,EAEAF,EAAG,EAAI,EACPA,EAAG,EAAI,EACPA,EAAG,EAAI,EACPA,EAAG,EAAI,EACPA,EAAG,EAAI,EAEHD,KAAUA,EAAO,GAEnBC,EAAG,EAAID,EAGPE,GAAWF,EAIb,QAASI,EAAI,EAAGA,EAAIF,EAAQ,OAAS,GAAIE,IACvCH,EAAG,GAAKC,EAAQ,WAAWE,CAAC,EAAI,EAC5BA,GAAKF,EAAQ,SACfD,EAAG,EAAIA,EAAG,GAAK,GAAKA,EAAG,IAAM,GAE/BA,EAAG,KAAK,CAEZ,CAEA,SAASI,EAAKC,EAAGH,EAAG,CAClB,OAAAA,EAAE,EAAIG,EAAE,EACRH,EAAE,EAAIG,EAAE,EACRH,EAAE,EAAIG,EAAE,EACRH,EAAE,EAAIG,EAAE,EACRH,EAAE,EAAIG,EAAE,EACRH,EAAE,EAAIG,EAAE,EACDH,CACT,CAEA,SAASI,EAAKP,EAAMQ,EAAM,CACxB,IAAIC,EAAK,IAAIV,EAAOC,CAAI,EACpBU,EAAQF,GAAQA,EAAK,MACrBG,EAAO,UAAW,CAAE,OAAQF,EAAG,KAAK,IAAM,GAAK,UAAa,EAChE,OAAAE,EAAK,OAAS,UAAW,CACvB,EACE,KAAIC,EAAMH,EAAG,KAAK,IAAM,GACpBI,GAAOJ,EAAG,KAAK,IAAM,GAAK,WAC1BK,GAAUF,EAAMC,IAAQ,GAAK,UAC1BC,IAAW,GACpB,OAAOA,CACT,EACAH,EAAK,MAAQF,EAAG,KAChBE,EAAK,MAAQA,EACTD,IACE,OAAOA,GAAU,UAAUL,EAAKK,EAAOD,CAAE,EAC7CE,EAAK,MAAQ,UAAW,CAAE,OAAON,EAAKI,EAAI,CAAC,CAAC,CAAG,GAE1CE,CACT,CAEIf,GAAUA,EAAO,QACnBA,EAAO,QAAUW,EACRT,GAAUA,EAAO,IAC1BA,EAAO,UAAW,CAAE,OAAOS,CAAM,CAAC,EAElC,KAAK,OAASA,CAGhB,GACEZ,GACC,OAAOC,GAAW,UAAYA,EAC9B,OAAO,QAAW,YAAc,MACnC,ICnFA,IAAAmB,GAAAC,EAAA,CAAAC,GAAAC,IAAA,EAKC,SAASC,EAAQD,EAAQE,EAAQ,CAElC,SAASC,EAAOC,EAAM,CACpB,IAAIC,EAAK,KAGTA,EAAG,KAAO,UAAW,CAEnB,IAAIC,EAAID,EAAG,EAAGE,EAAIF,EAAG,EAAGG,EAAGC,EAAGC,EAC9B,OAAAF,EAAIF,EAAEC,CAAC,EAAGC,GAAMA,IAAM,EAAIC,EAAID,EAAKA,GAAK,GACxCA,EAAIF,EAAGC,EAAI,EAAK,CAAC,EAAGE,GAAKD,EAAKA,IAAM,GACpCA,EAAIF,EAAGC,EAAI,EAAK,CAAC,EAAGE,GAAKD,EAAKA,IAAM,EACpCA,EAAIF,EAAGC,EAAI,EAAK,CAAC,EAAGE,GAAKD,EAAKA,GAAK,EACnCA,EAAIF,EAAGC,EAAI,EAAK,CAAC,EAAGC,EAAIA,EAAKA,GAAK,GAAKC,GAAKD,EAAKA,GAAK,EACtDF,EAAEC,CAAC,EAAIE,EACPJ,EAAG,EAAKE,EAAI,EAAK,EACVE,CACT,EAEA,SAASE,EAAKN,EAAID,EAAM,CACtB,IAAIQ,EAAGF,EAAGJ,EAAI,CAAC,EAEf,GAAIF,KAAUA,EAAO,GAEnBM,EAAIJ,EAAE,CAAC,EAAIF,MAIX,KADAA,EAAO,GAAKA,EACPQ,EAAI,EAAGA,EAAIR,EAAK,OAAQ,EAAEQ,EAC7BN,EAAEM,EAAI,CAAC,EAAKN,EAAEM,EAAI,CAAC,GAAK,GACnBR,EAAK,WAAWQ,CAAC,EAAIN,EAAGM,EAAI,EAAK,CAAC,GAAK,GAIhD,KAAON,EAAE,OAAS,GAAGA,EAAE,KAAK,CAAC,EAC7B,IAAKM,EAAI,EAAGA,EAAI,GAAKN,EAAEM,CAAC,IAAM,EAAG,EAAEA,EAAE,CAOrC,IANIA,GAAK,EAAGF,EAAIJ,EAAE,CAAC,EAAI,GAASI,EAAIJ,EAAEM,CAAC,EAEvCP,EAAG,EAAIC,EACPD,EAAG,EAAI,EAGFO,EAAI,IAAKA,EAAI,EAAG,EAAEA,EACrBP,EAAG,KAAK,CAEZ,CAEAM,EAAKN,EAAID,CAAI,CACf,CAEA,SAASS,EAAKC,EAAGN,EAAG,CAClB,OAAAA,EAAE,EAAIM,EAAE,EAAE,MAAM,EAChBN,EAAE,EAAIM,EAAE,EACDN,CACT,CAEA,SAASO,EAAKX,EAAMY,EAAM,CACpBZ,GAAQ,OAAMA,EAAO,CAAE,IAAI,MAC/B,IAAIa,EAAK,IAAId,EAAOC,CAAI,EACpBc,EAAQF,GAAQA,EAAK,MACrBG,EAAO,UAAW,CAAE,OAAQF,EAAG,KAAK,IAAM,GAAK,UAAa,EAChE,OAAAE,EAAK,OAAS,UAAW,CACvB,EACE,KAAIC,EAAMH,EAAG,KAAK,IAAM,GACpBI,GAAOJ,EAAG,KAAK,IAAM,GAAK,WAC1BK,GAAUF,EAAMC,IAAQ,GAAK,UAC1BC,IAAW,GACpB,OAAOA,CACT,EACAH,EAAK,MAAQF,EAAG,KAChBE,EAAK,MAAQA,EACTD,IACEA,EAAM,GAAGL,EAAKK,EAAOD,CAAE,EAC3BE,EAAK,MAAQ,UAAW,CAAE,OAAON,EAAKI,EAAI,CAAC,CAAC,CAAG,GAE1CE,CACT,CAEInB,GAAUA,EAAO,QACnBA,EAAO,QAAUe,EACRb,GAAUA,EAAO,IAC1BA,EAAO,UAAW,CAAE,OAAOa,CAAM,CAAC,EAElC,KAAK,UAAYA,CAGnB,GACEhB,GACC,OAAOC,GAAW,UAAYA,EAC9B,OAAO,QAAW,YAAc,MACnC,IC/FA,IAAAuB,GAAAC,EAAA,CAAAC,GAAAC,IAAA,EAyBC,SAASC,EAAQD,EAAQE,EAAQ,CAElC,SAASC,EAAOC,EAAM,CACpB,IAAIC,EAAK,KAGTA,EAAG,KAAO,UAAW,CACnB,IAAIC,EAAID,EAAG,EACPE,EAAIF,EAAG,EAAGG,EAAIH,EAAG,EAAGI,EAAGC,EAE3B,OAAAL,EAAG,EAAIC,EAAKA,EAAI,WAAc,EAE9BI,EAAIH,EAAGC,EAAI,GAAM,GAAG,EACpBC,EAAIF,EAAEC,EAAMA,EAAI,EAAK,GAAI,EACzBE,GAAKA,GAAK,GACVD,GAAKA,GAAK,GACVC,GAAKA,IAAM,GACXD,GAAKA,IAAM,GAEXC,EAAIH,EAAEC,CAAC,EAAIE,EAAID,EACfJ,EAAG,EAAIG,EAECE,GAAKJ,EAAKA,IAAM,IAAQ,CAClC,EAEA,SAASK,EAAKN,EAAID,EAAM,CACtB,IAAIK,EAAGC,EAAGF,EAAGI,EAAG,EAAGL,EAAI,CAAC,EAAGM,EAAQ,IAYnC,IAXIT,KAAUA,EAAO,IAEnBM,EAAIN,EACJA,EAAO,OAGPA,EAAOA,EAAO,KACdM,EAAI,EACJG,EAAQ,KAAK,IAAIA,EAAOT,EAAK,MAAM,GAGhCI,EAAI,EAAGI,EAAI,IAAKA,EAAIC,EAAO,EAAED,EAE5BR,IAAMM,GAAKN,EAAK,YAAYQ,EAAI,IAAMR,EAAK,MAAM,GAEjDQ,IAAM,IAAG,EAAIF,GACjBA,GAAKA,GAAK,GACVA,GAAKA,IAAM,GACXA,GAAKA,GAAK,EACVA,GAAKA,IAAM,GACPE,GAAK,IACP,EAAK,EAAI,WAAc,EACvBH,EAAKF,EAAEK,EAAI,GAAG,GAAMF,EAAI,EACxBF,EAAUC,GAAL,EAAUD,EAAI,EAAI,GAW3B,IAPIA,GAAK,MACPD,GAAGH,GAAQA,EAAK,QAAU,GAAK,GAAG,EAAI,IAKxCI,EAAI,IACCI,EAAI,EAAI,IAAKA,EAAI,EAAG,EAAEA,EACzBF,EAAIH,EAAGC,EAAI,GAAM,GAAG,EACpBC,EAAIF,EAAEC,EAAMA,EAAI,EAAK,GAAI,EACzBE,GAAKA,GAAK,GACVD,GAAKA,GAAK,GACVC,GAAKA,IAAM,GACXD,GAAKA,IAAM,GACXF,EAAEC,CAAC,EAAIE,EAAID,EAGbJ,EAAG,EAAI,EACPA,EAAG,EAAIE,EACPF,EAAG,EAAIG,CACT,CAEAG,EAAKN,EAAID,CAAI,CACf,CAEA,SAASU,EAAKC,EAAGN,EAAG,CAClB,OAAAA,EAAE,EAAIM,EAAE,EACRN,EAAE,EAAIM,EAAE,EACRN,EAAE,EAAIM,EAAE,EAAE,MAAM,EACTN,CACT,CAEA,SAASO,EAAKZ,EAAMa,EAAM,CACpBb,GAAQ,OAAMA,EAAO,CAAE,IAAI,MAC/B,IAAIc,EAAK,IAAIf,EAAOC,CAAI,EACpBe,EAAQF,GAAQA,EAAK,MACrBG,EAAO,UAAW,CAAE,OAAQF,EAAG,KAAK,IAAM,GAAK,UAAa,EAChE,OAAAE,EAAK,OAAS,UAAW,CACvB,EACE,KAAIC,EAAMH,EAAG,KAAK,IAAM,GACpBI,GAAOJ,EAAG,KAAK,IAAM,GAAK,WAC1BK,GAAUF,EAAMC,IAAQ,GAAK,UAC1BC,IAAW,GACpB,OAAOA,CACT,EACAH,EAAK,MAAQF,EAAG,KAChBE,EAAK,MAAQA,EACTD,IACEA,EAAM,GAAGL,EAAKK,EAAOD,CAAE,EAC3BE,EAAK,MAAQ,UAAW,CAAE,OAAON,EAAKI,EAAI,CAAC,CAAC,CAAG,GAE1CE,CACT,CAEIpB,GAAUA,EAAO,QACnBA,EAAO,QAAUgB,EACRd,GAAUA,EAAO,IAC1BA,EAAO,UAAW,CAAE,OAAOc,CAAM,CAAC,EAElC,KAAK,QAAUA,CAGjB,GACEjB,GACC,OAAOC,GAAW,UAAYA,EAC9B,OAAO,QAAW,YAAc,MACnC,ICjJA,IAAAwB,GAAAC,EAAA,CAAAC,GAAAC,IAAA,EAIC,SAASC,EAAQD,EAAQE,EAAQ,CAElC,SAASC,EAAOC,EAAM,CACpB,IAAIC,EAAK,KAAMC,EAAU,GAGzBD,EAAG,KAAO,UAAW,CACnB,IAAIE,EAAIF,EAAG,EAAGG,EAAIH,EAAG,EAAGI,EAAIJ,EAAG,EAAGK,EAAIL,EAAG,EACzC,OAAAE,EAAKA,GAAK,GAAOA,IAAM,EAAKC,EAC5BA,EAAKA,EAAIC,EAAK,EACdA,EAAKA,GAAK,GAAOA,IAAM,EAAKC,EAC5BA,EAAKA,EAAIH,EAAK,EACdF,EAAG,EAAIE,EAAKA,GAAK,GAAOA,IAAM,GAAMC,EACpCH,EAAG,EAAIG,EAAKA,EAAIC,EAAK,EACrBJ,EAAG,EAAKI,GAAK,GAAOD,IAAM,GAAME,EACzBL,EAAG,EAAKK,EAAIH,EAAK,CAC1B,EAkBAF,EAAG,EAAI,EACPA,EAAG,EAAI,EACPA,EAAG,EAAI,YACPA,EAAG,EAAI,WAEHD,IAAS,KAAK,MAAMA,CAAI,GAE1BC,EAAG,EAAKD,EAAO,WAAe,EAC9BC,EAAG,EAAID,EAAO,GAGdE,GAAWF,EAIb,QAASO,EAAI,EAAGA,EAAIL,EAAQ,OAAS,GAAIK,IACvCN,EAAG,GAAKC,EAAQ,WAAWK,CAAC,EAAI,EAChCN,EAAG,KAAK,CAEZ,CAEA,SAASO,EAAKC,EAAGC,EAAG,CAClB,OAAAA,EAAE,EAAID,EAAE,EACRC,EAAE,EAAID,EAAE,EACRC,EAAE,EAAID,EAAE,EACRC,EAAE,EAAID,EAAE,EACDC,CACT,CAEA,SAASC,EAAKX,EAAMY,EAAM,CACxB,IAAIC,EAAK,IAAId,EAAOC,CAAI,EACpBc,EAAQF,GAAQA,EAAK,MACrBG,EAAO,UAAW,CAAE,OAAQF,EAAG,KAAK,IAAM,GAAK,UAAa,EAChE,OAAAE,EAAK,OAAS,UAAW,CACvB,EACE,KAAIC,EAAMH,EAAG,KAAK,IAAM,GACpBI,GAAOJ,EAAG,KAAK,IAAM,GAAK,WAC1BK,GAAUF,EAAMC,IAAQ,GAAK,UAC1BC,IAAW,GACpB,OAAOA,CACT,EACAH,EAAK,MAAQF,EAAG,KAChBE,EAAK,MAAQA,EACTD,IACE,OAAOA,GAAU,UAAUN,EAAKM,EAAOD,CAAE,EAC7CE,EAAK,MAAQ,UAAW,CAAE,OAAOP,EAAKK,EAAI,CAAC,CAAC,CAAG,GAE1CE,CACT,CAEInB,GAAUA,EAAO,QACnBA,EAAO,QAAUe,EACRb,GAAUA,EAAO,IAC1BA,EAAO,UAAW,CAAE,OAAOa,CAAM,CAAC,EAElC,KAAK,OAASA,CAGhB,GACEhB,GACC,OAAOC,GAAW,UAAYA,EAC9B,OAAO,QAAW,YAAc,MACnC,I,iBCpGA,IAAAuB,GAAAC,EAAA,CAAAC,GAAAC,IAAA,EAwBC,SAAUC,EAAQC,EAAMC,EAAM,CAK/B,IAAIC,EAAQ,IACRC,EAAS,EACTC,EAAS,GACTC,EAAU,SACVC,EAAaL,EAAK,IAAIC,EAAOC,CAAM,EACnCI,EAAeN,EAAK,IAAI,EAAGG,CAAM,EACjCI,EAAWD,EAAe,EAC1BE,EAAOP,EAAQ,EACfQ,EAMJ,SAASC,EAAWC,EAAMC,EAASC,EAAU,CAC3C,IAAIC,EAAM,CAAC,EACXF,EAAWA,GAAW,GAAQ,CAAE,QAAS,EAAK,EAAKA,GAAW,CAAC,EAG/D,IAAIG,EAAYC,EAAOC,EACrBL,EAAQ,QAAU,CAACD,EAAMO,EAASnB,CAAI,CAAC,EACtCY,GAAgBQ,EAAS,EAAU,CAAC,EAAGL,CAAG,EAGzCM,EAAO,IAAIC,EAAKP,CAAG,EAInBQ,EAAO,UAAW,CAIpB,QAHIC,EAAIH,EAAK,EAAElB,CAAM,EACjBsB,EAAInB,EACJoB,EAAI,EACDF,EAAIjB,GACTiB,GAAKA,EAAIE,GAAKxB,EACduB,GAAKvB,EACLwB,EAAIL,EAAK,EAAE,CAAC,EAEd,KAAOG,GAAKhB,GACVgB,GAAK,EACLC,GAAK,EACLC,KAAO,EAET,OAAQF,EAAIE,GAAKD,CACnB,EAEA,OAAAF,EAAK,MAAQ,UAAW,CAAE,OAAOF,EAAK,EAAE,CAAC,EAAI,CAAG,EAChDE,EAAK,MAAQ,UAAW,CAAE,OAAOF,EAAK,EAAE,CAAC,EAAI,UAAa,EAC1DE,EAAK,OAASA,EAGdN,EAAOE,EAASE,EAAK,CAAC,EAAGrB,CAAI,GAGrBa,EAAQ,MAAQC,GACpB,SAASS,EAAMX,EAAMe,EAAcC,EAAO,CAUxC,OATIA,IAEEA,EAAM,GAAKC,EAAKD,EAAOP,CAAI,EAE/BE,EAAK,MAAQ,UAAW,CAAE,OAAOM,EAAKR,EAAM,CAAC,CAAC,CAAG,GAK/CM,GAAgB1B,EAAKI,CAAO,EAAIkB,EAAaX,GAIrCW,CACd,GACJA,EACAP,EACA,WAAYH,EAAUA,EAAQ,OAAU,MAAQZ,EAChDY,EAAQ,KAAK,CACf,CAYA,SAASS,EAAKP,EAAK,CACjB,IAAIe,EAAGC,EAAShB,EAAI,OAChBiB,EAAK,KAAMC,EAAI,EAAGC,EAAIF,EAAG,EAAIA,EAAG,EAAI,EAAGG,EAAIH,EAAG,EAAI,CAAC,EAMvD,IAHKD,IAAUhB,EAAM,CAACgB,GAAQ,GAGvBE,EAAI/B,GACTiC,EAAEF,CAAC,EAAIA,IAET,IAAKA,EAAI,EAAGA,EAAI/B,EAAO+B,IACrBE,EAAEF,CAAC,EAAIE,EAAED,EAAIzB,EAAQyB,EAAInB,EAAIkB,EAAIF,CAAM,GAAKD,EAAIK,EAAEF,CAAC,EAAG,EACtDE,EAAED,CAAC,EAAIJ,GAIRE,EAAG,EAAI,SAASI,EAAO,CAItB,QAFIN,EAAGO,EAAI,EACPJ,EAAID,EAAG,EAAGE,EAAIF,EAAG,EAAGG,EAAIH,EAAG,EACxBI,KACLN,EAAIK,EAAEF,EAAIxB,EAAQwB,EAAI,CAAE,EACxBI,EAAIA,EAAInC,EAAQiC,EAAE1B,GAAS0B,EAAEF,CAAC,EAAIE,EAAED,EAAIzB,EAAQyB,EAAIJ,CAAE,IAAMK,EAAED,CAAC,EAAIJ,EAAG,EAExE,OAAAE,EAAG,EAAIC,EAAGD,EAAG,EAAIE,EACVG,CAIT,GAAGnC,CAAK,CACV,CAMA,SAAS2B,EAAKS,EAAGR,EAAG,CAClB,OAAAA,EAAE,EAAIQ,EAAE,EACRR,EAAE,EAAIQ,EAAE,EACRR,EAAE,EAAIQ,EAAE,EAAE,MAAM,EACTR,CACT,CAMA,SAASZ,EAAQqB,EAAKC,EAAO,CAC3B,IAAIC,EAAS,CAAC,EAAGC,EAAO,OAAOH,EAAMI,EACrC,GAAIH,GAASE,GAAO,SAClB,IAAKC,KAAQJ,EACX,GAAI,CAAEE,EAAO,KAAKvB,EAAQqB,EAAII,CAAI,EAAGH,EAAQ,CAAC,CAAC,CAAG,MAAY,CAAC,CAGnE,OAAQC,EAAO,OAASA,EAASC,GAAO,SAAWH,EAAMA,EAAM,IACjE,CAOA,SAAStB,EAAOL,EAAMG,EAAK,CAEzB,QADI6B,EAAahC,EAAO,GAAIiC,EAAOX,EAAI,EAChCA,EAAIU,EAAW,QACpB7B,EAAIN,EAAOyB,CAAC,EACVzB,GAASoC,GAAS9B,EAAIN,EAAOyB,CAAC,EAAI,IAAMU,EAAW,WAAWV,GAAG,EAErE,OAAOf,EAASJ,CAAG,CACrB,CAOA,SAASK,GAAW,CAClB,GAAI,CACF,IAAI0B,EACJ,OAAIpC,IAAeoC,EAAMpC,EAAW,aAElCoC,EAAMA,EAAI5C,CAAK,GAEf4C,EAAM,IAAI,WAAW5C,CAAK,GACzBH,EAAO,QAAUA,EAAO,UAAU,gBAAgB+C,CAAG,GAEjD3B,EAAS2B,CAAG,CACrB,MAAY,CACV,IAAIC,EAAUhD,EAAO,UACjBiD,EAAUD,GAAWA,EAAQ,QACjC,MAAO,CAAC,CAAC,IAAI,KAAMhD,EAAQiD,EAASjD,EAAO,OAAQoB,EAASnB,CAAI,CAAC,CACnE,CACF,CAMA,SAASmB,EAAS8B,EAAG,CACnB,OAAO,OAAO,aAAa,MAAM,EAAGA,CAAC,CACvC,CAeA,GANAhC,EAAOhB,EAAK,OAAO,EAAGD,CAAI,EAMrB,OAAOF,GAAW,UAAYA,EAAO,QAAS,CACjDA,EAAO,QAAUa,EAEjB,GAAI,CACFD,EAAa,IACf,MAAa,CAAC,CAChB,MAAY,OAAO,QAAW,YAAc,OAAO,IACjD,OAAO,UAAW,CAAE,OAAOC,CAAY,CAAC,EAGxCV,EAAK,OAASI,CAAO,EAAIM,CAK3B,GAGG,OAAO,KAAS,IAAe,KAAOd,GACvC,CAAC,EACD,IACF,IC5PA,IAAAqD,GAAAC,EAAA,CAAAC,GAAAC,KAAA,CAYA,IAAIC,GAAO,KAKPC,GAAS,KAKTC,GAAS,KAQTC,GAAY,KASZC,GAAU,KAOVC,GAAS,KAITC,EAAK,KAETA,EAAG,KAAON,GACVM,EAAG,OAASL,GACZK,EAAG,OAASJ,GACZI,EAAG,UAAYH,GACfG,EAAG,QAAUF,GACbE,EAAG,OAASD,GAEZN,GAAO,QAAUO,IChDV,IAAMC,EAAN,MAAMC,CAAO,CAMlB,YAAYC,EAAqBC,EAAY,CAL7CC,EAAA,UACAA,EAAA,UAKMF,aAAcD,GAChB,KAAK,EAAIC,EAAG,EACZ,KAAK,EAAIA,EAAG,IAEZ,KAAK,EAAIA,GAAM,EACf,KAAK,EAAIC,GAAK,EAElB,CAQA,OAAOD,EAAwCC,EAAqB,CAClE,OAAwBD,GAAO,KACtB,GAGLA,aAAcD,EACT,KAAK,IAAMC,EAAG,GAAK,KAAK,IAAMA,EAAG,EAEjC,KAAK,IAAMA,GAAM,KAAK,IAAMC,CAEvC,CAMA,OAAgB,CACd,OAAO,IAAIF,EAAO,IAAI,CACxB,CASA,IAAIC,EAAqBC,EAAoB,CAC3C,OAAID,aAAcD,EACT,IAAIA,EAAO,KAAK,EAAIC,EAAG,EAAG,KAAK,EAAIA,EAAG,CAAC,EAEvC,IAAID,EAAO,KAAK,EAAIC,EAAI,KAAK,GAAKC,GAAK,EAAE,CAEpD,CASA,IAAID,EAAqBC,EAAoB,CAC3C,OAAID,aAAcD,EACT,KAAK,IAAI,IAAIA,EAAO,CAACC,EAAG,EAAG,CAACA,EAAG,CAAC,CAAC,EAEjC,KAAK,IAAI,CAACA,EAAI,EAAEC,GAAK,EAAE,CAElC,CAMA,IAAIE,EAAwB,CAC1B,OAAO,IAAIJ,EAAO,KAAK,EAAII,EAAQ,KAAK,EAAIA,CAAM,CACpD,CAMA,QAAiB,CACf,OAAO,KAAK,IAAI,EAAE,CACpB,CACF,ECjGA,IAAAC,EAAuB,WAEvB,SAASC,GAAYC,EAAiB,CACpC,MAAM,IAAI,MAAM,sBAAwBA,CAAC,CAC3C,CAgHO,IAAMC,EAAN,KAAgB,CAiBrB,YAAoBC,EAAoB,CAApB,YAAAA,EAhBpBC,EAAA,KAAQ,SACRA,EAAA,KAAQ,UACRA,EAAA,KAAQ,mBAA2B,GACnCA,EAAA,KAAQ,iBAAyB,GACjCA,EAAA,wBAaE,KAAK,SAAQ,EAAAC,SAAW,GAAGF,EAAO,IAAI,IAAI,EAC1C,KAAK,OAAS,KAAK,oBAAoB,CACzC,CAbA,IAAI,SAAwB,CAC1B,OAAO,KAAK,MACd,CACA,IAAI,OAAoB,CACtB,OAAO,KAAK,MACd,CACA,IAAI,eAAwB,CAC1B,OAAO,KAAK,cACd,CAOQ,qBAAkC,CACxC,IAAIG,EAAmB,CAAC,EACxB,QAASC,EAAI,EAAGA,EAAI,KAAK,OAAO,OAAQ,EAAEA,EACxCD,EAAO,KAAK,IAAIE,EAAOD,EAAG,CAAC,EAAG,IAAIC,EAAOD,EAAG,KAAK,OAAO,OAAS,CAAC,CAAC,EAGrE,QAASE,EAAI,EAAGA,EAAI,KAAK,OAAO,OAAS,EAAG,EAAEA,EAC5CH,EAAO,KAAK,IAAIE,EAAO,EAAGC,CAAC,EAAG,IAAID,EAAO,KAAK,OAAO,OAAS,EAAGC,CAAC,CAAC,EAErE,OAAAH,EAASA,EAAO,OAAOI,GACd,CAAC,KAAK,OAAO,UAAU,KAAKC,GAAQA,EAAK,OAAOD,CAAK,CAAC,CAC9D,EACDJ,EAAO,KAAK,GAAG,KAAK,OAAO,MAAM,EAE1B,CACL,OAAAA,EACA,MAAO,GACP,SAAU,KACV,OAAQ,KAAK,OAAO,OAAO,IAAIM,IAAU,CACvC,SAAUA,EAAM,SAChB,OAAQ,EACR,MAAO,CAAC,EACR,IAAKA,EAAM,UACX,YAAa,CAAC,CAChB,EAAE,EACF,SAAU,EACZ,CACF,CAEQ,aAAoB,CAC1B,KAAK,iBAAmB,EACxB,KAAK,eAAiB,EACtB,KAAK,SAAQ,EAAAP,SAAW,GAAG,KAAK,QAAQ,IAAI,IAAI,EAChD,KAAK,OAAS,KAAK,oBAAoB,CACzC,CAEQ,aAAuB,CAC7B,IAAMQ,EAAQ,KAAK,OAEnB,GAAIA,EAAM,SACR,MAAO,GAGT,QAASC,EAAI,EAAGA,EAAID,EAAM,OAAO,OAAQC,IAAK,CAC5C,IAAMF,EAAQC,EAAM,OAAOC,CAAC,EACxBF,EAAM,YAAY,OAAS,IAC7BA,EAAM,IAAMA,EAAM,YAAY,CAAC,EAC/BA,EAAM,YAAY,OAAO,EAAG,CAAC,GAG/B,IAAIG,EACJ,OAAQH,EAAM,IAAK,CACjB,IAAK,GACHG,EAAY,IAAIP,EAAO,EAAG,CAAC,EAC3B,MACF,IAAK,GACHO,EAAY,IAAIP,EAAO,EAAG,EAAE,EAC5B,MACF,IAAK,GACHO,EAAY,IAAIP,EAAO,GAAI,CAAC,EAC5B,MACF,IAAK,GACHO,EAAY,IAAIP,EAAO,EAAG,CAAC,EAC3B,MACF,QACE,OAAOQ,GAAYJ,EAAM,GAAG,CAChC,CAEA,IAAMK,EAAcL,EAAM,SAAS,IAAIG,CAAS,EAGhD,QAASG,EAAI,EAAGA,EAAIL,EAAM,OAAO,OAAQK,IACvC,GAAIJ,IAAMI,GACWL,EAAM,OAAOK,CAAC,EAClB,MAAM,KAAKC,GAAKA,EAAE,OAAOF,CAAW,CAAC,EAClD,OAAAJ,EAAM,SAAW,GACV,GAYb,GANIA,EAAM,OAAO,KAAKM,GAAKA,EAAE,OAAOF,CAAW,CAAC,GAM5CL,EAAM,MAAM,KAAKO,GAAKA,EAAE,OAAOF,CAAW,CAAC,EAC7C,OAAAJ,EAAM,SAAW,GACV,GAyBT,IAtBII,EAAY,EAAI,IAClBA,EAAY,EAAI,KAAK,QAAQ,OAAS,GAEpCA,EAAY,EAAI,IAClBA,EAAY,EAAI,KAAK,QAAQ,OAAS,GAEpCA,EAAY,EAAI,KAAK,QAAQ,OAAS,IACxCA,EAAY,EAAI,GAEdA,EAAY,EAAI,KAAK,QAAQ,OAAS,IACxCA,EAAY,EAAI,GAGlBL,EAAM,SAAWK,EACjBL,EAAM,MAAM,KAAKK,CAAW,EAGxBL,EAAM,SAAS,OAAOC,EAAM,QAAQ,IACtCA,EAAM,SAAW,KACjBD,EAAM,QAAU,GAGXA,EAAM,MAAM,OAASA,EAAM,QAChCA,EAAM,MAAM,OAAO,EAAG,CAAC,EAGzB,QAASM,EAAI,EAAGA,EAAIL,EAAM,OAAO,OAAQK,IACvC,GAAIJ,IAAMI,GACWL,EAAM,OAAOK,CAAC,EAClB,MAAM,KAAKC,GAAKA,EAAE,OAAOF,CAAW,CAAC,EAClD,OAAAJ,EAAM,SAAW,GACV,GAKbD,EAAM,SAAWK,EACjBL,EAAM,MAAM,KAAKK,CAAW,CAC9B,CAEA,OAAKJ,EAAM,UACT,KAAK,gBAAgB,EAGhB,EACT,CAEQ,iBAAwB,CAC9B,IAAIO,EACJ,KACEA,EAAS,IAAIZ,EACX,KAAK,MAAM,KAAK,MAAM,EAAI,KAAK,QAAQ,MAAM,EAC7C,KAAK,MAAM,KAAK,MAAM,EAAI,KAAK,QAAQ,MAAM,CAC/C,EAEI,QAAK,OAAO,OAAO,KAAKW,GAAKA,EAAE,OAAOC,CAAM,CAAC,GAK/C,MAAK,OAAO,OAAO,KACjBR,GAAS,CAAC,CAACA,EAAM,MAAM,KAAKO,GAAKA,EAAE,OAAOC,CAAM,CAAC,CACnD,IAPF,CAcF,KAAK,OAAO,SAAWA,CACzB,CAEQ,cAAcC,EAAkBC,EAA6B,CACnE,IAAMC,EAAa,KAAK,OAAO,OAAOF,CAAQ,EAC9C,GAAIE,EAAW,YAAY,QAAU,EACnC,MAAO,GAGT,IAAIC,EAASD,EAAW,IAKxB,OAJIA,EAAW,YAAY,OAAS,IAClCC,EAASD,EAAW,YAAYA,EAAW,YAAY,OAAS,CAAC,GAG/DC,IAAWF,GAAUE,EAASF,IAAW,EACpC,IAGTC,EAAW,YAAY,KAAKD,CAAM,EAC3B,GACT,CAEQ,mBAAmBG,EAAiC,CAC1D,IAAIC,EAAW,KAAK,OAAO,MAAQD,EACnC,OAAAC,EAAW,KAAK,IAAI,EAAG,KAAK,IAAI,IAAMA,CAAQ,CAAC,EAC/C,KAAK,OAAO,MAAQA,EACb,EACT,CAEA,MAAMC,EAAwB,CAC5B,IAAIC,EAAU,GACd,OAAQD,EAAM,UAAW,CACvB,IAAK,YACHC,EAAU,KAAK,cAAcD,EAAM,SAAUA,EAAM,GAAG,EACtD,MACF,IAAK,QACHC,EAAU,KAAK,mBAAmBD,EAAM,cAAc,EACtD,MACF,QACEX,GAAYW,CAAK,CACrB,CAEI,KAAK,iBAAmBC,GAC1B,KAAK,gBAAgB,CACnB,UAAW,KAAK,eAChB,UAAWD,CACb,CAAC,CAEL,CAEA,YAAYE,EAAwB,CAClC,KAAK,gBAAkBA,EACvB,KAAK,kBAAoBA,EAEzB,IAAMC,EAAW,IAAO,KAAK,OAAO,MAC9BC,EAAa,KAAK,MAAM,KAAK,iBAAmBD,CAAQ,EAC9D,QAAShB,EAAI,EAAGA,EAAIiB,EAAY,EAAEjB,EAChC,KAAK,YAAY,EAEnB,KAAK,kBAAoBiB,EAAaD,CACxC,CACF,ECnWO,IAAME,EAAN,KAAmC,CAGxC,YACUC,EACAC,EAMR,CAPQ,cAAAD,EACA,YAAAC,EAJVC,EAAA,KAAQ,eAAiC,KAUtC,CAQH,eAAeC,EAA4B,CACzC,IAAIC,EAEJ,OAAQD,EAAM,IAAI,YAAY,EAAG,CAC/B,KAAK,KAAK,OAAO,KACfC,EAAY,GACZ,MACF,KAAK,KAAK,OAAO,GACfA,EAAY,EACZ,MACF,KAAK,KAAK,OAAO,KACfA,EAAY,GACZ,MACF,KAAK,KAAK,OAAO,MACfA,EAAY,EACZ,MACF,QACE,MACJ,CAEA,KAAK,aAAe,CAClB,UAAW,YACX,IAAKA,EACL,SAAU,KAAK,QACjB,CACF,CAEA,cAAcC,EAAsC,CAElD,IAAMC,EAAQ,KAAK,aACnB,YAAK,aAAe,KACbA,CACT,CACF,ECnDO,IAAMC,EAAN,KAAgC,CACrC,YACUC,EACSC,EAAuB,EACxC,CAFQ,cAAAD,EACS,kBAAAC,CAChB,CAEK,iBACNC,EACAC,EACAC,EACS,CACT,IAAMC,EAAcF,EAAM,OAAO,OAAO,CAACG,EAAGC,IAAQA,IAAQ,KAAK,QAAQ,EACzE,QAAWC,KAASH,EAClB,QAAWI,KAAQD,EAAM,MAAO,CAC9B,IAAME,EAAK,KAAK,IAAIR,EAAI,EAAIO,EAAK,CAAC,EAC5BE,EAAK,KAAK,IAAIT,EAAI,EAAIO,EAAK,CAAC,EAClC,GAAIC,GAAMN,GAAUO,GAAMP,EACxB,MAAO,EAEX,CAEF,MAAO,EACT,CAEQ,qBAAqBF,EAAaC,EAA4B,CAGpE,OAFqBA,EAAM,OAAO,KAAK,QAAQ,EAChB,MAAM,MAAM,CAAC,EAC3B,KAAKM,GAAQA,EAAK,IAAMP,EAAI,GAAKO,EAAK,IAAMP,EAAI,CAAC,CACpE,CAEQ,kBACNA,EACAC,EACAC,EACS,CACT,IAAMQ,EAAYT,EAAM,OAAO,OAAS,EACxC,OACED,EAAI,EAAIE,GACRF,EAAI,EAAIE,GACRF,EAAI,EAAIU,EAAYR,EAAS,GAC7BF,EAAI,EAAIU,EAAYR,EAAS,CAEjC,CAEQ,iBACNS,EACAV,EACAC,EACS,CACT,IAAMQ,EAAYT,EAAM,OAAO,OAAS,EACxC,OACEU,EAAM,EAAIT,GACVS,EAAM,EAAIT,GACVS,EAAM,EAAID,EAAYR,EAAS,GAC/BS,EAAM,EAAID,EAAYR,EAAS,CAEnC,CAEA,cAAcD,EAAqC,CACjD,IAAMK,EAAQL,EAAM,OAAO,KAAK,QAAQ,EAClCU,EAAQV,EAAM,SAGpB,GAAI,CAACU,GAASV,EAAM,SAClB,OAAO,KAIT,IAAMW,EAAY,IAAI,IACtBX,EAAM,OAAO,QAAQY,GAASD,EAAU,IAAI,GAAGC,EAAM,CAAC,IAAIA,EAAM,CAAC,EAAE,CAAC,EACpEZ,EAAM,OAAO,QAAQa,GAAK,CACxBA,EAAE,MAAM,QAAQP,GAAQK,EAAU,IAAI,GAAGL,EAAK,CAAC,IAAIA,EAAK,CAAC,EAAE,CAAC,CAC9D,CAAC,EAGD,IAAMC,EAAKG,EAAM,EAAIL,EAAM,SAAS,EAC9BG,EAAKE,EAAM,EAAIL,EAAM,SAAS,EAG9BS,EAAsB,CAAC,EAGzB,KAAK,IAAIP,CAAE,EAAI,KAAK,IAAIC,CAAE,GAExBD,EAAK,EAAGO,EAAM,MAAqB,EAClCA,EAAM,OAAoB,EAC3BN,EAAK,EAAGM,EAAM,MAAkB,EAC/BA,EAAM,OAAoB,IAG3BN,EAAK,EAAGM,EAAM,MAAkB,EAC/BA,EAAM,OAAoB,EAC3BP,EAAK,EAAGO,EAAM,MAAqB,EAClCA,EAAM,OAAoB,GAIjC,IAAMC,EAAiB,KAAK,iBAAiBL,EAAOV,EAAO,CAAC,EAG5D,QAAWgB,KAAOF,EAAO,CACvB,IAAMG,EAAU,KAAK,gBAAgBZ,EAAM,SAAUW,EAAKhB,CAAK,EAI/D,GACE,CAACW,EAAU,IAAI,GAAGM,EAAQ,CAAC,IAAIA,EAAQ,CAAC,EAAE,GAC1C,CAAC,KAAK,iBAAiBA,EAASjB,EAAO,KAAK,YAAY,IACvDe,GAAkB,CAAC,KAAK,kBAAkBE,EAASjB,EAAO,CAAC,IAC5D,CAAC,KAAK,qBAAqBiB,EAASjB,CAAK,EAEzC,MAAO,CACL,UAAW,YACX,IAAAgB,EACA,SAAU,KAAK,QACjB,CAEJ,CAGA,IAAME,EAAgB,UAKtB,EACA,QAAWF,KAAOE,EAAe,CAC/B,IAAMD,EAAU,KAAK,gBAAgBZ,EAAM,SAAUW,EAAKhB,CAAK,EAC/D,GACE,CAACW,EAAU,IAAI,GAAGM,EAAQ,CAAC,IAAIA,EAAQ,CAAC,EAAE,GAC1C,CAAC,KAAK,iBAAiBA,EAASjB,EAAO,CAAC,IACvCe,GAAkB,CAAC,KAAK,kBAAkBE,EAASjB,EAAO,CAAC,IAC5D,CAAC,KAAK,qBAAqBiB,EAASjB,CAAK,EAEzC,MAAO,CACL,UAAW,YACX,IAAAgB,EACA,SAAU,KAAK,QACjB,CAEJ,CAGA,OAAO,IACT,CAEQ,gBACNjB,EACAiB,EACAhB,EACQ,CACR,IAAImB,EAAIpB,EAAI,EACRqB,EAAIrB,EAAI,EAEZ,OAAQiB,EAAK,CACX,OACEI,GAAK,EACL,MACF,OACEA,GAAK,EACL,MACF,OACED,GAAK,EACL,MACF,OACEA,GAAK,EACL,KACJ,CAGA,OAAIA,EAAI,IAAGA,EAAInB,EAAM,OAAO,OAAS,GACjCoB,EAAI,IAAGA,EAAIpB,EAAM,OAAO,OAAS,GACjCmB,EAAInB,EAAM,OAAO,OAAS,IAAGmB,EAAI,GACjCC,EAAIpB,EAAM,OAAO,OAAS,IAAGoB,EAAI,GAE9B,IAAIC,EAAOF,EAAGC,CAAC,CACxB,CACF,EC9JO,IAAME,EAAN,KAAmB,CAAnB,cACLC,EAAA,KAAQ,YAAoB,GAC5BA,EAAA,KAAQ,YAAoB,GAC5BA,EAAA,KAAQ,aAAqB,GAC7BA,EAAA,KAAQ,cAAsB,GAC9BA,EAAA,KAAQ,eAAuB,GAC/BA,EAAA,KAAQ,cAAsB,GAC9BA,EAAA,KAAQ,gBAAwB,GAChCA,EAAA,KAAQ,eAAuB,GAC/BA,EAAA,KAAQ,gBAER,aAAaC,EAAiC,CAC5C,KAAK,aAAeA,CACtB,CAEA,oBAAoBC,EAAWC,EAAiB,CAC9C,IAAMC,EAAa,KAAK,IACtBF,EAAI,KAAK,aAAa,OACtBC,EAAI,KAAK,aAAa,MACxB,EAEA,KAAK,WAAaC,EAClB,KAAK,YAAcA,EACnB,KAAK,YAAc,KAAK,aAAa,OAAS,KAAK,WACnD,KAAK,aAAe,KAAK,aAAa,OAAS,KAAK,YACpD,KAAK,WAAaF,EAAI,KAAK,aAAe,EAC1C,KAAK,WAAaC,EAAI,KAAK,cAAgB,EAC3C,KAAK,aAAeD,EACpB,KAAK,cAAgBC,CACvB,CAEQ,UACNE,EACAC,EACAC,EACM,CACN,GAAM,CAAE,UAAAC,EAAW,YAAAC,CAAY,EAC7B,OAAOF,GAAU,SACb,CAAE,UAAWA,EAAO,YAAaA,CAAM,EACvCA,EAENF,EAAI,UAAYG,EAChBH,EAAI,SACF,KAAK,UAAYC,EAAE,EAAI,KAAK,WAC5B,KAAK,UACH,KAAK,aACLA,EAAE,EAAI,KAAK,YACX,KAAK,YACP,KAAK,WACL,KAAK,WACP,EAEIG,IACFJ,EAAI,YAAcI,EAClBJ,EAAI,WACF,KAAK,UAAYC,EAAE,EAAI,KAAK,WAC5B,KAAK,UACH,KAAK,aACLA,EAAE,EAAI,KAAK,YACX,KAAK,YACP,KAAK,WACL,KAAK,WACP,EAEJ,CAEA,OACED,EACAK,EACAC,EACM,CAENN,EAAI,UAAY,QAChBA,EAAI,SACF,KAAK,UACL,KAAK,UACL,KAAK,YACL,KAAK,YACP,EAGAK,EAAU,OAAO,QAAQE,GAAS,CAChC,KAAK,UAAUP,EAAKO,EAAO,OAAO,CACpC,CAAC,EAGGF,EAAU,UACZ,KAAK,UAAUL,EAAKK,EAAU,SAAU,KAAK,EAI/C,IAAMG,EAAc,CAClB,UACA,UACA,UACA,UACA,UACA,SACF,EACMC,EAAsBD,EAAY,IAAIE,GAAS,CACnD,IAAMC,EAAM,SAASD,EAAM,MAAM,CAAC,EAAG,EAAE,EACjCE,EAAI,KAAK,KAAKD,GAAO,IAAM,GAAI,CAAC,EAChCE,EAAI,KAAK,KAAMF,GAAO,EAAK,KAAU,GAAI,CAAC,EAC1CG,EAAI,KAAK,KAAKH,EAAM,KAAY,GAAI,CAAC,EAC3C,MAAO,KAAMC,GAAK,GAAOC,GAAK,EAAKC,GAAG,SAAS,EAAE,EAAE,SAAS,EAAG,GAAG,CAAC,EACrE,CAAC,EAuBD,GArBAT,EAAU,OAAO,QAAQ,CAACU,EAAOC,IAAU,CACzC,IAAMC,EAAYT,EAAYQ,EAAQR,EAAY,MAAM,EAClDU,EAAYT,EAAoBO,EAAQP,EAAoB,MAAM,EACxEM,EAAM,MAAM,QAAQI,GAAQ,CAC1B,KAAK,UAAUnB,EAAKmB,EAAMF,CAAS,CACrC,CAAC,EACD,KAAK,UAAUjB,EAAKe,EAAM,SAAUG,CAAS,CAC/C,CAAC,EAGGZ,IACFN,EAAI,UAAU,EACdA,EAAI,OAAO,GAAI,EAAE,EACjBA,EAAI,OAAO,GAAI,EAAE,EACjBA,EAAI,OAAO,GAAI,EAAE,EACjBA,EAAI,UAAU,EACdA,EAAI,UAAY,UAChBA,EAAI,KAAK,GAIPK,EAAU,SAAU,CACtB,IAAMe,EAAW,KAAK,aAAe,GACrCpB,EAAI,KAAO,QAAQoB,CAAQ,aAC3B,IAAMC,EAAO,aACPC,EAActB,EAAI,YAAYqB,CAAI,EAClCE,GAAK,KAAK,aAAeD,EAAY,OAAS,EAC9CE,EAAI,KAAK,cAAgB,EAAIJ,EAAW,EAE9CpB,EAAI,UAAY,QAChBA,EAAI,SAASqB,EAAME,EAAGC,CAAC,EACvBxB,EAAI,YAAc,QAClBA,EAAI,WAAWqB,EAAME,EAAGC,CAAC,CAC3B,CACF,CACF,EC3IO,IAAMC,EAAN,KAAsB,CAAtB,cACLC,EAAA,KAAQ,eAAuB,GAC/BA,EAAA,KAAQ,gBAAwB,GAChCA,EAAA,KAAQ,gBAAqC,CAC3C,aAAc,EACd,UAAW,CACb,GACAA,EAAA,KAAQ,oBAAqC,GAM7C,oBAAoBC,EAAeC,EAAsB,CACvD,KAAK,aAAeD,EACpB,KAAK,cAAgBC,CACvB,CAOA,eACEC,EACAC,EACM,CAGN,OAFYD,EAAM,IAAI,YAAY,EAErB,CACX,IAAK,UACH,KAAK,kBAAoB,KAAK,IAAI,EAAG,KAAK,kBAAoB,CAAC,EAC/D,MACF,IAAK,YACH,KAAK,kBAAoB,KAAK,IAC5B,EACA,KAAK,kBAAoB,CAC3B,EACA,MACF,IAAK,YACH,KAAK,mBAAmB,EAAE,EAC1B,MACF,IAAK,aACH,KAAK,mBAAmB,CAAC,EACzB,MACF,IAAK,QACC,KAAK,oBAAsB,GAC7B,KAAK,WAAWC,CAAS,EAE3B,KACJ,CACF,CAOA,iBACEC,EACAD,EACM,CAEF,KAAK,oBAAsB,GAC7B,KAAK,WAAWA,CAAS,CAE7B,CAEQ,mBAAmBE,EAAqB,CAC1C,KAAK,oBAAsB,EAC7B,KAAK,cAAc,aAAe,KAAK,IACrC,EACA,KAAK,IAAI,EAAG,KAAK,cAAc,aAAeA,CAAK,CACrD,EACS,KAAK,oBAAsB,IACpC,KAAK,cAAc,UAAY,KAAK,IAClC,EACA,KAAK,IAAI,EAAG,KAAK,cAAc,UAAYA,CAAK,CAClD,EAEJ,CAEQ,WAAWF,EAAyC,CAEtD,KAAK,cAAc,aAAe,KAAK,cAAc,YAAc,GAIvEA,EAAU,YAAY,KAAK,aAAa,CAC1C,CAMA,OAAOG,EAAqC,CAE1C,IAAMC,EAAc,KAAK,cAAgBD,EAAI,OAAO,MAC9CE,EAAe,KAAK,eAAiBF,EAAI,OAAO,OAGtDA,EAAI,UAAY,UAChBA,EAAI,SAAS,EAAG,EAAGC,EAAaC,CAAY,EAG5C,IAAMC,EAAgB,KAAK,IAAIF,EAAaC,CAAY,EAAI,GACtDE,EAAmB,KAAK,IAAIH,EAAaC,CAAY,EAAI,GACzDG,EAAe,KAAK,IAAIJ,EAAaC,CAAY,EAAI,GAG3DF,EAAI,UAAY,SAChBA,EAAI,aAAe,SAGnBA,EAAI,KAAO,QAAQG,CAAa,WAChCH,EAAI,UAAY,UAChBA,EAAI,SAAS,cAAeC,EAAc,EAAGC,EAAe,CAAC,EAG7DF,EAAI,KAAO,GAAGI,CAAgB,WAC9BJ,EAAI,UAAY,UAChBA,EAAI,SACF,oBACAC,EAAc,EACdC,EAAe,EAAIC,EAAgB,EACrC,EAGA,IAAMG,EAAaJ,EAAe,GAC5BK,EAAiBF,EAAe,EACtCL,EAAI,KAAO,GAAGK,CAAY,WAG1B,IAAMG,EAAY,CAChB,CACE,KAAM,kBAAkB,KAAK,cAAc,YAAY,GACvD,SAAU,CACZ,EACA,CACE,KAAM,eAAe,KAAK,cAAc,SAAS,GACjD,SAAU,CACZ,EACA,CAAE,KAAM,QAAS,SAAU,CAAsB,CACnD,EAGAA,EAAU,QAAQ,CAACC,EAAMC,IAAU,CACjC,IAAMC,EAAIL,EAAaI,EAAQH,EACzBK,EAAa,KAAK,oBAAsBH,EAAK,SAkBnD,GAfIG,IACFZ,EAAI,UAAY,UAChBA,EAAI,SACFC,EAAc,EAAI,IAClBU,EAAIN,EAAe,GACnB,IACAA,EAAe,GACjB,GAIFL,EAAI,UAAYY,EAAa,UAAY,UACzCZ,EAAI,SAASS,EAAK,KAAMR,EAAc,EAAGU,CAAC,EAIxCF,EAAK,WAAa,GAClBA,EAAK,WAAa,EAClB,CACAT,EAAI,UAAYY,EAAa,UAAY,UAGzC,IAAMC,EAAYb,EAAI,YAAYS,EAAK,IAAI,EAAE,MACvCK,EAAcT,EAAe,GAC7BU,EAAad,EAAc,EAAIY,EAAY,EAAIC,EAC/CE,EAAcf,EAAc,EAAIY,EAAY,EAAIC,EAEtDd,EAAI,SAAS,SAAKe,EAAYJ,CAAC,EAC/BX,EAAI,SAAS,SAAKgB,EAAaL,CAAC,CAClC,CACF,CAAC,EAGD,IAAMM,EACJX,EAAaE,EAAU,OAASD,EAAiBF,EAAe,EAC5Da,EAAsB,KAAK,IAAIjB,EAAaC,CAAY,EAAI,GAClEF,EAAI,KAAO,GAAGkB,CAAmB,WACjClB,EAAI,UAAY,UAEK,CACnB,wFACA,GACA,8DACA,mEACF,EAEa,QAAQ,CAACmB,EAAaT,IAAU,CAC3C,IAAMC,EAAIM,EAAeP,EAAQQ,EAAsB,IACvDlB,EAAI,SAASmB,EAAalB,EAAc,EAAGU,CAAC,CAC9C,CAAC,EAIC,KAAK,cAAc,aAAe,KAAK,cAAc,YAClC,IACnBX,EAAI,KAAO,QAAQK,EAAe,EAAG,WACrCL,EAAI,UAAY,UAChBA,EAAI,SACF,6CACAC,EAAc,EACdgB,EAAeZ,CACjB,EAEJ,CACF,ECvOO,IAAee,EAAf,KAA+B,CAoCtC,EASaC,EAAN,cAA8BD,CAAgB,CAQnD,YACUE,EACDC,EACP,CACA,MAAM,EAHE,gBAAAD,EACD,iBAAAC,EATTC,EAAA,KAAQ,cACRA,EAAA,KAAQ,eAYN,KAAK,WAAa,IAAIC,EAAU,KAAK,UAAU,EAC/C,KAAK,YAAc,CACrB,CAZA,IAAI,WAAwB,CAC1B,OAAO,KAAK,UACd,CAYA,IAAI,QAAkB,CACpB,OAAO,KAAK,aAAe,KAAK,YAAY,MAC9C,CAEA,YAAYC,EAAwB,CAClC,GAAI,OAAK,aAAe,KAAK,YAAY,QAIzC,KAAOA,EAAW,GAAG,CACnB,IAAIC,EAAoB,KAAK,WAAW,cAAgBD,EAClDE,EAAY,KAAK,YAAY,KAAK,WAAW,EAE/CD,GAAqBC,EAAU,YACjCD,EAAoBC,EAAU,WAGhC,KAAK,WAAW,YACdD,EAAoB,KAAK,WAAW,aACtC,EAEI,KAAK,WAAW,eAAiBC,EAAU,YAC7C,KAAK,WAAW,MAAMA,EAAU,SAAS,EACzC,EAAE,KAAK,aAGTF,EAAWC,EAAoB,KAAK,WAAW,aACjD,CACF,CAEA,IAAI,OAAoB,CACtB,OAAO,KAAK,WAAW,KACzB,CAEA,aAAaE,EAAyB,CAEtC,CACF,EAUaC,EAAN,cAA0BV,CAAgB,CAQ/C,YACUE,EACRC,EACA,CACA,MAAM,EAHE,gBAAAD,EARVE,EAAA,KAAQ,cACRA,EAAA,oBAYE,QAAK,YAAcD,GAAe,CAAC,EACnC,KAAK,WAAa,IAAIE,EAAU,KAAK,UAAU,EAE3C,KAAK,YAAY,OAAS,EAC5B,QAAWM,KAAc,KAAK,YAC5B,KAAK,WAAW,YACdA,EAAW,UAAY,KAAK,WAAW,aACzC,EACA,KAAK,WAAW,MAAMA,EAAW,SAAS,EAI9C,KAAK,WAAW,gBAAmBC,GACjC,KAAK,aAAaA,CAAC,CACvB,CAxBA,IAAI,WAAwB,CAC1B,OAAO,KAAK,UACd,CAwBA,YAAYN,EAAwB,CAClC,KAAK,WAAW,YAAYA,CAAQ,CACtC,CAEA,IAAI,QAAkB,CACpB,MAAO,EACT,CAEA,IAAI,OAAoB,CACtB,OAAO,KAAK,WAAW,KACzB,CAEQ,aAAaM,EAA0B,CAC7C,KAAK,YAAY,KAAKA,CAAC,CACzB,CAEA,aAAaC,EAAwB,CACnC,KAAK,WAAW,MAAMA,CAAK,CAC7B,CACF,ECnKA,IAAMC,GAAuB,GAgBhBC,EAAN,KAAiB,CAUtB,YACUC,EACAC,EACAC,EACR,CAHQ,YAAAF,EACA,YAAAC,EACA,SAAAC,EAZVC,EAAA,KAAQ,iBACRA,EAAA,KAAQ,oBACRA,EAAA,KAAQ,YACRA,EAAA,KAAQ,mBACRA,EAAA,KAAQ,kBAAkB,IAC1BA,EAAA,KAAQ,UAAoB,CAAC,GAC7BA,EAAA,KAAQ,2BACRA,EAAA,KAAQ,qBAON,KAAK,kBAAoB,CACvB,YAAcC,GACZ,KAAK,WAAWA,CAAM,CAC1B,CACF,CAEA,OAAc,CACZ,KAAK,cAAgB,IAAIC,EACzB,KAAK,iBAAmB,IAAIC,EAC5B,KAAK,eAAe,EACpB,KAAK,wBAAwB,EAC7B,KAAK,SAAS,CAChB,CAEQ,gBAAuB,CAC7B,KAAK,OAAO,iBAAiB,SAAU,IACrC,KAAK,wBAAwB,CAC/B,EACA,KAAK,OAAO,iBAAiB,UAAW,GAAK,KAAK,WAAW,CAAC,CAAC,EAC/D,KAAK,OAAO,iBAAiB,QAAS,GAAK,KAAK,eAAe,CAAC,CAAC,CACnE,CAEQ,WAAWC,EAA4B,CAC7C,GAAI,CAAAA,EAAM,iBAKV,IAAI,KAAK,gBAAkB,UAAmB,CAC5C,KAAK,iBAAiB,eAAeA,EAAO,KAAK,iBAAiB,EAClEA,EAAM,eAAe,EACrB,MACF,CAGA,GAAI,KAAK,gBAAkB,YAAqB,CAE5CA,EAAM,IAAI,YAAY,IAAM,SAC5BA,EAAM,IAAI,YAAY,IAAM,IAE5B,KAAK,mBAAmB,EACfA,EAAM,IAAI,YAAY,IAAM,UACrC,KAAK,mBAAmB,EAE1BA,EAAM,eAAe,EACrB,MACF,CAGA,GAAI,KAAK,gBAAkB,UACzB,GAAIA,EAAM,IAAI,YAAY,IAAM,IACzB,KAAK,gBAGR,KAAK,gBAAgB,EAFrB,KAAK,mBAAmB,UAIjBA,EAAM,IAAI,YAAY,IAAM,IACrC,KAAK,iBAAiB,UACbA,EAAM,IAAI,YAAY,IAAM,SACrC,KAAK,mBAAmB,UACfA,EAAM,MAAQ,IACvB,KAAK,cAAc,CACjB,UAAW,QACX,eAAgB,CAClB,CAAC,UACQA,EAAM,MAAQ,IACvB,KAAK,cAAc,CACjB,UAAW,QACX,eAAgB,EAClB,CAAC,MAGD,SAAWC,KAAS,KAAK,QACnBA,aAAiBC,GACnBD,EAAM,eAAeD,CAAK,EAMlCA,EAAM,eAAe,EACvB,CAEQ,eAAeA,EAAyB,CAC1CA,EAAM,mBAKN,KAAK,gBAAkB,WACzB,KAAK,iBAAiB,iBAAiBA,EAAO,KAAK,iBAAiB,EAIlE,KAAK,gBAAkB,aACzB,KAAK,mBAAmB,EAG1BA,EAAM,eAAe,EACvB,CAEQ,yBAAgC,CACtC,KAAK,OAAO,OAAS,KAAK,OAAO,YACjC,KAAK,OAAO,MAAQ,KAAK,OAAO,WAG5B,KAAK,gBAAkB,WAAqB,KAAK,UACnD,KAAK,cAAc,oBACjB,KAAK,OAAO,MACZ,KAAK,OAAO,MACd,EAGF,KAAK,iBAAiB,oBACpB,KAAK,OAAO,MACZ,KAAK,OAAO,MACd,EACA,KAAK,MAAM,CACb,CAEQ,UAAiB,CACvB,KAAK,QAAQ,EACb,KAAK,MAAM,EACX,sBAAsB,IAAM,KAAK,SAAS,CAAC,CAC7C,CAEQ,SAAgB,CAEtB,GAAI,KAAK,gBAAkB,UAAmB,CAC5C,KAAK,kBAAkB,EAGvB,IAAIG,EAAW,GACXC,EAAa,EACjB,EAAG,CACD,QAAWH,KAAS,KAAK,QAAS,CAChC,IAAMI,EAAQJ,EAAM,cAAc,KAAK,SAAS,KAAK,EACjDI,IACF,KAAK,cAAcA,CAAK,EACxBF,EAAW,GAEf,CACAC,GACF,OAASD,GAAYC,EAAab,GACpC,CACF,CAEQ,cAAcc,EAAwB,CAC5C,KAAK,kBAAkB,EACvB,KAAK,SAAS,aAAaA,CAAK,CAClC,CAEQ,mBAA0B,CAChC,IAAMC,EAAM,YAAY,IAAI,EACtBC,EAAWD,EAAM,KAAK,gBAC5B,KAAK,SAAS,YAAYC,CAAQ,EAClC,KAAK,gBAAkBD,EAEnB,KAAK,iBAAmB,KAAK,SAAS,QACxC,KAAK,gBAAgB,CAEzB,CAEQ,iBAAiBE,EAA0C,CAKjE,IAAMC,EAAeD,EACjBA,EAAa,aAAeA,EAAa,UACzC,KAAK,QAAQ,OACXE,EAAS,KAAK,6BAA6BD,EAAc,GAAG,EAAC,EAE7DE,EAAwB,CAC5B,OAAQ,GACR,OAAQ,GACR,KAAM,KAAK,IAAI,EACf,UAAW,CACT,IAAIC,EAAO,EAAG,GAAI,CAAC,EACnB,IAAIA,EAAO,EAAG,GAAI,EAAI,CAAC,EACvB,IAAIA,EAAO,GAAO,GAAI,CAAC,EACvB,IAAIA,EAAO,GAAO,GAAI,EAAI,CAAC,CAC7B,EACA,OAAQ,CACN,IAAIA,EAAO,GAAI,EAAG,GAAI,CAAC,EACvB,IAAIA,EAAO,GAAI,EAAI,EAAG,GAAI,EAAI,CAAC,EAC/B,IAAIA,EAAO,GAAI,EAAG,GAAI,EAAI,CAAC,EAC3B,IAAIA,EAAO,GAAI,EAAI,EAAG,GAAI,CAAC,CAC7B,EACA,OAAQF,CACV,EAEA,KAAK,gBAAkB,GACvB,KAAK,SAAW,IAAIG,EAAYF,CAAS,EACzC,KAAK,gBAAkB,YAAY,IAAI,EACvC,KAAK,cAAc,aAAa,KAAK,SAAS,SAAS,CACzD,CAEQ,6BACNG,EACAC,EACAC,EACoD,CACpD,IAAMN,EAAS,CAAC,EAIVO,EAAiB,CACrB,CAAE,SAAU,IAAIL,EAAO,EAAQ,CAAM,EAAG,WAA4B,EACpE,CACE,SAAU,IAAIA,EAAOG,EAAa,EAAQC,EAAc,CAAM,EAC9D,YACF,EACA,CACE,SAAU,IAAIJ,EAAOG,EAAa,EAAQ,CAAM,EAChD,YACF,EACA,CACE,SAAU,IAAIH,EAAO,EAAQI,EAAc,CAAM,EACjD,WACF,EACA,CACE,SAAU,IAAIJ,EAAOG,EAAa,EAAG,CAAM,EAC3C,YACF,EACA,CACE,SAAU,IAAIH,EAAOG,EAAa,EAAGC,EAAc,CAAM,EACzD,WACF,CACF,EAGA,QAASE,EAAI,EAAGA,EAAI,KAAK,IAAIJ,EAAYG,EAAe,MAAM,EAAGC,IAC/DR,EAAO,KAAKO,EAAeC,CAAC,CAAC,EAG/B,OAAOR,CACT,CAEQ,iBAAwB,CAC9B,KAAK,gBAAkB,GACvB,KAAK,SAAW,IAAIG,EAClB,KAAK,SAAS,UACd,KAAK,SAAS,WAChB,CACF,CAEQ,oBAA2B,CACjC,KAAK,gBAAkB,GACvB,KAAK,SAAW,IAAIM,EAClB,KAAK,SAAS,UACd,KAAK,SAAS,WAChB,EACA,KAAK,gBAAkB,YAAY,IAAI,CACzC,CAEQ,OAAc,CACpB,KAAK,IAAI,UAAU,EAAG,EAAG,KAAK,IAAI,OAAO,MAAO,KAAK,IAAI,OAAO,MAAM,EAElE,KAAK,gBAAkB,UACzB,KAAK,iBAAiB,OAAO,KAAK,GAAG,GAErC,KAAK,gBAAkB,WACvB,KAAK,gBAAkB,cAEvB,KAAK,cAAc,OACjB,KAAK,IACL,KAAK,SAAS,MACd,KAAK,eACP,CAEJ,CAOA,SAASlB,EAAqB,CAC5B,KAAK,QAAQ,KAAKA,CAAK,CACzB,CAMQ,WAAWO,EAAyC,CAC1D,KAAK,cAAgB,UAGrB,KAAK,QAAU,CAAC,EAChB,IAAIY,EAAa,EAGjB,QAAS,EAAI,EAAG,EAAIZ,EAAa,aAAc,IAAK,CAClD,IAAMa,EAAS,KAAK,oBAAoB,CAAC,EACzC,KAAK,QAAQ,KAAK,IAAInB,EAAWkB,EAAYC,CAAM,CAAC,EACpDD,GACF,CAGA,QAAS,EAAI,EAAG,EAAIZ,EAAa,UAAW,IAC1C,KAAK,QAAQ,KAAK,IAAIc,EAAQF,CAAU,CAAC,EACzCA,IAGF,KAAK,iBAAiBZ,CAAY,EAGlC,KAAK,cAAc,oBACjB,KAAK,OAAO,MACZ,KAAK,OAAO,MACd,CACF,CAEQ,oBAAoBe,EAK1B,CACA,OAAIA,IAAgB,EACX,CACL,GAAI,UACJ,KAAM,YACN,KAAM,YACN,MAAO,YACT,EAGO,CACL,GAAI,IACJ,KAAM,IACN,KAAM,IACN,MAAO,GACT,CAEJ,CAMQ,oBAA2B,CACjC,KAAK,cAAgB,UACrB,KAAK,QAAU,CAAC,EAChB,KAAK,gBAAkB,EACzB,CAMQ,eAAsB,CAC5B,KAAK,cAAgB,WACvB,CAMA,IAAI,cAA0B,CAC5B,OAAO,KAAK,aACd,CACF,EC1YA,IAAMC,GAAN,KAAc,CAGZ,aAAc,CAFdC,EAAA,KAAQ,aAAgC,MAGtC,OAAO,iBAAiB,mBAAoB,IAAM,KAAK,WAAW,CAAC,CACrE,CAEQ,YAAmB,CACzB,IAAMC,EAAS,SAAS,cAAiC,SAAS,EAElE,GAAI,CAACA,EAAQ,CACX,QAAQ,MAAM,0BAA0B,EACxC,MACF,CAEA,IAAMC,EAAUD,EAAO,WAAW,IAAI,EAEtC,GAAI,CAACC,EAAS,CACZ,QAAQ,MAAM,0BAA0B,EACxC,MACF,CAEA,KAAK,WAAa,IAAIC,EAAW,OAAQF,EAAQC,CAAO,EACxD,KAAK,WAAW,MAAM,CACxB,CACF,EAGA,IAAIH",
  "names": ["require_alea", "__commonJSMin", "exports", "module", "global", "define", "Alea", "seed", "me", "mash", "Mash", "t", "copy", "f", "impl", "opts", "xg", "state", "prng", "data", "i", "h", "require_xor128", "__commonJSMin", "exports", "module", "global", "define", "XorGen", "seed", "me", "strseed", "t", "k", "copy", "f", "impl", "opts", "xg", "state", "prng", "top", "bot", "result", "require_xorwow", "__commonJSMin", "exports", "module", "global", "define", "XorGen", "seed", "me", "strseed", "t", "k", "copy", "f", "impl", "opts", "xg", "state", "prng", "top", "bot", "result", "require_xorshift7", "__commonJSMin", "exports", "module", "global", "define", "XorGen", "seed", "me", "X", "i", "t", "v", "w", "init", "j", "copy", "f", "impl", "opts", "xg", "state", "prng", "top", "bot", "result", "require_xor4096", "__commonJSMin", "exports", "module", "global", "define", "XorGen", "seed", "me", "w", "X", "i", "t", "v", "init", "j", "limit", "copy", "f", "impl", "opts", "xg", "state", "prng", "top", "bot", "result", "require_tychei", "__commonJSMin", "exports", "module", "global", "define", "XorGen", "seed", "me", "strseed", "b", "c", "d", "a", "k", "copy", "f", "t", "impl", "opts", "xg", "state", "prng", "top", "bot", "result", "require_seedrandom", "__commonJSMin", "exports", "module", "global", "pool", "math", "width", "chunks", "digits", "rngname", "startdenom", "significance", "overflow", "mask", "nodecrypto", "seedrandom", "seed", "options", "callback", "key", "shortseed", "mixkey", "flatten", "tostring", "autoseed", "arc4", "ARC4", "prng", "n", "d", "x", "is_math_call", "state", "copy", "t", "keylen", "me", "i", "j", "s", "count", "r", "f", "obj", "depth", "result", "typ", "prop", "stringseed", "smear", "out", "browser", "plugins", "a", "require_seedrandom", "__commonJSMin", "exports", "module", "alea", "xor128", "xorwow", "xorshift7", "xor4096", "tychei", "sr", "Vector", "_Vector", "vx", "y", "__publicField", "scalar", "import_seedrandom", "assertNever", "x", "GameLogic", "_stage", "__publicField", "seedrandom", "blocks", "x", "Vector", "y", "block", "hole", "snake", "state", "i", "direction", "assertNever", "newPosition", "j", "v", "newPos", "snakeIdx", "newDir", "snakeState", "curDir", "speedIncrement", "newSpeed", "input", "handled", "duration", "stepSize", "totalSteps", "HumanActor", "snakeIdx", "keyMap", "__publicField", "event", "direction", "_state", "input", "AIActor", "snakeIdx", "safetyRadius", "pos", "state", "radius", "otherSnakes", "_", "idx", "snake", "tile", "dx", "dy", "boardSize", "apple", "obstacles", "block", "s", "moves", "appleNearWalls", "dir", "nextPos", "allDirections", "x", "y", "Vector", "GameRenderer", "__publicField", "gameOptions", "w", "h", "tileLength", "ctx", "v", "style", "fillStyle", "strokeStyle", "gameState", "playbackMode", "block", "snakeColors", "darkenedSnakeColors", "color", "num", "r", "g", "b", "snake", "index", "bodyColor", "headColor", "tile", "fontSize", "text", "measurement", "x", "y", "WelcomeRenderer", "__publicField", "width", "height", "event", "callbacks", "_event", "delta", "ctx", "canvasWidth", "canvasHeight", "titleFontSize", "subtitleFontSize", "menuFontSize", "menuStartY", "menuItemHeight", "menuItems", "item", "index", "y", "isSelected", "textWidth", "arrowMargin", "leftArrowX", "rightArrowX", "instructionY", "instructionFontSize", "instruction", "GameHandlerBase", "PlaybackHandler", "_gameStage", "savedInputs", "__publicField", "GameLogic", "duration", "newPlayedDuration", "nextInput", "_input", "LiveHandler", "savedInput", "e", "input", "MAX_INPUT_ITERATIONS", "GameEngine", "window", "canvas", "ctx", "__publicField", "config", "GameRenderer", "WelcomeRenderer", "event", "actor", "HumanActor", "hasInput", "iterations", "input", "now", "duration", "playerConfig", "totalPlayers", "snakes", "gameStage", "Vector", "LiveHandler", "numPlayers", "boardWidth", "boardHeight", "startPositions", "i", "PlaybackHandler", "snakeIndex", "keyMap", "AIActor", "playerIndex", "GameApp", "__publicField", "canvas", "context", "GameEngine"]
}
